"use strict";(self.webpackChunkrealsee_developer_github_com=self.webpackChunkrealsee_developer_github_com||[]).push([[2008],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>v});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=a,v=p["".concat(l,".").concat(m)]||p[m]||u[m]||o;return n?r.createElement(v,i(i({ref:t},d),{},{components:n})):r.createElement(v,i({ref:t},d))}));function v(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(67294),a=n(86010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,i),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(87462),a=n(67294),o=n(86010),i=n(72389),s=n(67392),l=n(7094),c=n(12466);const d={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function p(e){const{lazy:t,block:n,defaultValue:i,values:p,groupId:u,className:m}=e,v=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),g=p??v.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),h=(0,s.l)(g,((e,t)=>e.value===t.value));if(h.length>0)throw new Error(`Docusaurus error: Duplicate values "${h.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const f=null===i?i:i??v.find((e=>e.props.default))?.props.value??v[0].props.value;if(null!==f&&!g.some((e=>e.value===f)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${f}" but none of its children has the corresponding value. Available values are: ${g.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:b,setTabGroupChoices:k}=(0,l.U)(),[w,y]=(0,a.useState)(f),N=[],{blockElementScrollPositionUntilNextRender:S}=(0,c.o5)();if(null!=u){const e=b[u];null!=e&&e!==w&&g.some((t=>t.value===e))&&y(e)}const C=e=>{const t=e.currentTarget,n=N.indexOf(t),r=g[n].value;r!==w&&(S(t),y(r),null!=u&&k(u,String(r)))},R=e=>{let t=null;switch(e.key){case"Enter":C(e);break;case"ArrowRight":{const n=N.indexOf(e.currentTarget)+1;t=N[n]??N[0];break}case"ArrowLeft":{const n=N.indexOf(e.currentTarget)-1;t=N[n]??N[N.length-1];break}}t?.focus()};return a.createElement("div",{className:(0,o.Z)("tabs-container",d.tabList)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},m)},g.map((e=>{let{value:t,label:n,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>N.push(e),onKeyDown:R,onClick:C},i,{className:(0,o.Z)("tabs__item",d.tabItem,i?.className,{"tabs__item--active":w===t})}),n??t)}))),t?(0,a.cloneElement)(v.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},v.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function u(e){const t=(0,i.Z)();return a.createElement(p,(0,r.Z)({key:String(t)},e))}},11256:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>v,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var r=n(87462),a=(n(67294),n(3905)),o=n(65488),i=n(85162);const s={title:"Status Recording"},l=void 0,c={unversionedId:"front/3d-space/handbook/vue/recording-state",id:"front/3d-space/handbook/vue/recording-state",title:"Status Recording",description:"Previous chapter recalls: Change the perspective",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/front/3d-space/handbook/vue/3.recording-state.md",sourceDirName:"front/3d-space/handbook/vue",slug:"/front/3d-space/handbook/vue/recording-state",permalink:"/en/docs/front/3d-space/handbook/vue/recording-state",draft:!1,tags:[],version:"current",lastUpdatedBy:"sansi.lcj",lastUpdatedAt:1669717185,formattedLastUpdatedAt:"Nov 29, 2022",sidebarPosition:3,frontMatter:{title:"Status Recording"},sidebar:"\u4e09\u7ef4\u7a7a\u95f4",previous:{title:"Change View",permalink:"/en/docs/front/3d-space/handbook/vue/knowing-state"},next:{title:"Points in 3D space",permalink:"/en/docs/front/3d-space/handbook/vue/points-in-3d"}},d={},p=[{value:"Preparatory work",id:"preparatory-work",level:2},{value:"Recording / Playback",id:"recording--playback",level:2},{value:"Write <strong>Recorder</strong>",id:"write-recorder",level:3},{value:"Write Recording Component",id:"write-recording-component",level:3},{value:"Use Status Recording Component",id:"use-status-recording-component",level:3},{value:"The next section will be completed by you",id:"the-next-section-will-be-completed-by-you",level:2}],u={toc:p},m="wrapper";function v(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("strong",{parentName:"p"},"Previous chapter recalls: Change the perspective")," ",(0,a.kt)("br",null)),(0,a.kt)("ul",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ul"},"You know what is ",(0,a.kt)("strong",{parentName:"li"},"State"),", and how to get and modify.",(0,a.kt)("br",null)),(0,a.kt)("li",{parentName:"ul"},"Autoring features via ",(0,a.kt)("strong",{parentName:"li"},"State"),"."))),(0,a.kt)("admonition",{title:"This chapter can learn to",type:"tip"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Record user operations via ",(0,a.kt)("strong",{parentName:"li"},"State"),"."),(0,a.kt)("li",{parentName:"ul"},"Restore the user action picture with ",(0,a.kt)("strong",{parentName:"li"},"State"),"."))),(0,a.kt)("h2",{id:"preparatory-work"},"Preparatory work"),(0,a.kt)("p",null,"Like the previous section, we create a new directory (",(0,a.kt)("inlineCode",{parentName:"p"},"src/3.recording-state"),"and corresponding ",(0,a.kt)("strong",{parentName:"p"},"html")," and ",(0,a.kt)("strong",{parentName:"p"},"js")," or ",(0,a.kt)("strong",{parentName:"p"},"ts")," files."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"js")," or ",(0,a.kt)("strong",{parentName:"p"},"ts")," files can first copy the previous chapter."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="src/3.recording-state/index.html"',title:'"src/3.recording-state/index.html"'},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>\u72b6\u6001\u5f55\u5236 | Recording state</title>\n    <style>\n      * {\n        margin: 0;\n        padding: 0;\n      }\n      html,\n      body #app {\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n      }\n    </style>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="module" src="./index"><\/script>\n  </body>\n</html>\n')),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/3.recording-state/useWindowDimensions.js"',title:'"src/3.recording-state/useWindowDimensions.js"'},'import { ref, onBeforeUnmount } from "vue";\n\nfunction useWindowDimensions() {\n  const width = ref(window.innerWidth);\n  const height = ref(window.innerHeight);\n\n  const listener = () => {\n    width.value = window.innerWidth;\n    height.value = window.innerHeight;\n  };\n\n  window.addEventListener("resize", listener, false);\n  onBeforeUnmount(() => {\n    window.removeEventListener("resize", listener, false);\n  });\n  return { width, height };\n}\nexport { useWindowDimensions };\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/ModeController.vue"',title:'"src/3.recording-state/ModeController.vue"'},'<template>\n  <nav class="navbar fixed-bottom navbar-light bg-light">\n    <div class="container-fluid justify-content-center">\n      <div class="btn-group">\n        <button\n          :class="\n            state.mode == \'Panorama\'\n              ? \'btn btn-primary active\'\n              : \'btn btn-primary\'\n          "\n          @click="() => setState({ mode: Five.Mode.Panorama })"\n        >\n          Panorama roaming\n        </button>\n        <button\n          :class="\n            state.mode == \'Panorama\'\n              ? \'btn btn-primary\'\n              : \'btn btn-primary active\'\n          "\n          @click="() => setState({ mode: Five.Mode.Floorplan })"\n        >\n          Space overview\n        </button>\n      </div>\n    </div>\n  </nav>\n</template>\n\n<script setup>\nimport { useFiveCurrentState } from "@realsee/five/vue";\nimport { Five } from "@realsee/five";\n\nconst [state, setState] = useFiveCurrentState();\n<\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/LookAroundController.vue"',title:'"src/3.recording-state/LookAroundController.vue"'},'<template>\n  <div class="card position-fixed m-2 top-0 end-0">\n    <button class="btn btn-light" v-show="isShow" @click="startFunc">\n      <i class="bi bi-arrow-repeat"></i>\n    </button>\n    <button class="btn btn-light" v-show="!isShow" @click="stopFunc">\n      <i class="bi bi-pause"></i>\n    </button>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from "vue";\nimport { useFiveCurrentState } from "@realsee/five/vue";\n\nconst [currentState, setState] = useFiveCurrentState();\nconst isShow = ref(true);\nlet timer;\n\nconst startFunc = () => {\n  window.clearInterval(timer);\n  isShow.value = false;\n  timer = window.setInterval(() => {\n    setState({ longitude: currentState.value.longitude + Math.PI / 360 });\n  }, 16);\n};\n\nconst stopFunc = () => {\n  window.clearInterval(timer);\n  isShow.value = true;\n};\n<\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/App.vue"',title:'"src/3.recording-state/App.vue"'},'<template>\n  <FiveProvider :work="work">\n    <FiveCanvas :width="width" :height="height" />\n    <ModeController />\n    <LookAroundController />\n  </FiveProvider>\n</template>\n\n<script setup lang="ts">\nimport { FiveProvider, FiveCanvas } from "@realsee/five/vue";\nimport { parseWork } from "@realsee/five";\nimport { ref } from "vue";\nimport { useWindowDimensions } from "./useWindowDimensions";\nimport ModeController from "./ModeController.vue";\nimport LookAroundController from "./LookAroundController.vue";\n\nconst work = ref();\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nfetch(workURL)\n  .then((response) => response.text())\n  .then((text) => (work.value = parseWork(text)));\nconst { width, height } = useWindowDimensions();\n<\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/3.recording-state/index.js"',title:'"src/3.recording-state/index.js"'},'import { createApp, h } from "vue";\nimport App from "./App.vue";\n\ncreateApp(App).mount("#app");\n'))),(0,a.kt)(i.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/3.recording-state/useWindowDimensions.ts"',title:'"src/3.recording-state/useWindowDimensions.ts"'},'import { ref, onBeforeUnmount } from "vue";\n\nfunction useWindowDimensions() {\n  const width = ref(window.innerWidth);\n  const height = ref(window.innerHeight);\n\n  const listener = () => {\n    width.value = window.innerWidth;\n    height.value = window.innerHeight;\n  };\n\n  window.addEventListener("resize", listener, false);\n  onBeforeUnmount(() => {\n    window.removeEventListener("resize", listener, false);\n  });\n  return { width, height };\n}\nexport { useWindowDimensions };\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/ModeController.vue"',title:'"src/3.recording-state/ModeController.vue"'},'<template>\n  <nav class="navbar fixed-bottom navbar-light bg-light">\n    <div class="container-fluid justify-content-center">\n      <div class="btn-group">\n        <button\n          :class="\n            state.mode == \'Panorama\'\n              ? \'btn btn-primary active\'\n              : \'btn btn-primary\'\n          "\n          @click="() => setState({ mode: Five.Mode.Panorama })"\n        >\n          Panorama roaming\n        </button>\n        <button\n          :class="\n            state.mode == \'Panorama\'\n              ? \'btn btn-primary\'\n              : \'btn btn-primary active\'\n          "\n          @click="() => setState({ mode: Five.Mode.Floorplan })"\n        >\n          Space overview\n        </button>\n      </div>\n    </div>\n  </nav>\n</template>\n\n<script setup lang="ts">\nimport { useFiveCurrentState } from "@realsee/five/vue";\nimport { Five } from "@realsee/five";\n\nconst [state, setState] = useFiveCurrentState();\n<\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/LookAroundController.vue"',title:'"src/3.recording-state/LookAroundController.vue"'},'<template>\n  <div class="card position-fixed m-2 top-0 end-0">\n    <button class="btn btn-light" v-show="isShow" @click="startFunc">\n      <i class="bi bi-arrow-repeat"></i>\n    </button>\n    <button class="btn btn-light" v-show="!isShow" @click="stopFunc">\n      <i class="bi bi-pause"></i>\n    </button>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from "vue";\nimport { useFiveCurrentState } from "@realsee/five/vue";\n\nconst [currentState, setState] = useFiveCurrentState();\nconst isShow = ref(true);\nlet timer: number | undefined;\n\nconst startFunc = () => {\n  window.clearInterval(timer);\n  isShow.value = false;\n  timer = window.setInterval(() => {\n    setState({ longitude: currentState.value.longitude + Math.PI / 360 });\n  }, 16);\n};\n\nconst stopFunc = () => {\n  window.clearInterval(timer);\n  isShow.value = true;\n};\n<\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/App.vue"',title:'"src/3.recording-state/App.vue"'},'<template>\n  <FiveProvider :work="work">\n    <FiveCanvas :width="width" :height="height" />\n    <ModeController />\n    <LookAroundController />\n  </FiveProvider>\n</template>\n\n<script setup lang="ts">\nimport { FiveProvider, FiveCanvas } from "@realsee/five/vue";\nimport { parseWork } from "@realsee/five";\nimport { ref } from "vue";\nimport { useWindowDimensions } from "./useWindowDimensions";\nimport ModeController from "./ModeController.vue";\nimport LookAroundController from "./LookAroundController.vue";\n\nconst work = ref();\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nfetch(workURL)\n  .then((response) => response.text())\n  .then((text) => (work.value = parseWork(text)));\nconst { width, height } = useWindowDimensions();\n<\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/3.recording-state/index.ts"',title:'"src/3.recording-state/index.ts"'},'import { createApp, h } from "vue";\nimport App from "./App.vue";\n\ncreateApp(App).mount("#app");\n')))),(0,a.kt)("p",null,"Start service ",(0,a.kt)("inlineCode",{parentName:"p"},"npm run dev"),' and jump to the current page "http://localhost:3000/src/3.recording-state/index.html".'),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Please see your console. The port number will change due to your configuration and current port occupancy, please check the console output.\nIf you use another development build tool, please start the service as required by your own development build tool.")),(0,a.kt)("h2",{id:"recording--playback"},"Recording / Playback"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This chapter continues to complete an interesting app with ",(0,a.kt)("strong",{parentName:"p"},"State"),".\nThis chapter will complete such an app, log users into ",(0,a.kt)("strong",{parentName:"p"},"State"),"on the page and can replay these actions.",(0,a.kt)("br",null))),(0,a.kt)("h3",{id:"write-recorder"},"Write ",(0,a.kt)("strong",{parentName:"h3"},"Recorder")),(0,a.kt)("p",null,"First, we need to write ",(0,a.kt)("strong",{parentName:"p"},"Recorder")," to support records and playbacks.\n",(0,a.kt)("strong",{parentName:"p"},"Recorder")," category is not the content of ",(0,a.kt)("strong",{parentName:"p"},"Five")," , it is only written to achieve the effect of this chapter."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Implement the ",(0,a.kt)("strong",{parentName:"li"},"startRecording / endRecording")," method to start recording and end recording."),(0,a.kt)("li",{parentName:"ol"},"Implementing ",(0,a.kt)("strong",{parentName:"li"},"record(state: State)")," method, recording content.Record between ",(0,a.kt)("strong",{parentName:"li"},"startRecording / endRecording"),"."),(0,a.kt)("li",{parentName:"ol"},"Implement ",(0,a.kt)("strong",{parentName:"li"},"play(callback)")," method, for playbacks, after calling play, install ",(0,a.kt)("strong",{parentName:"li"},"record")," content, call ",(0,a.kt)("strong",{parentName:"li"},"callback")," method,play ",(0,a.kt)("strong",{parentName:"li"},"State"),".")),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/3.recording-state/recorder.js"',title:'"src/3.recording-state/recorder.js"'},"/**\n * Recording class\n */\nclass Recorder {\n  constructor() {\n    this.startTime = 0;\n    this.records = null;\n  }\n  /**\n   * Whether\n   has been recorded */\n  hasRecords() {\n    return this.records !== null;\n  }\n  /**\n   * Record keyframe\n   * @param state five of state\n   * @returns\n   */\n  record(state) {\n    if (this.records === null) return;\n    this.records.push({\n      state: Object.assign({}, state),\n      time: Date.now() - this.startTime,\n    });\n  }\n  /**\n   * start recording\n   */\n  startRecording() {\n    this.startTime = Date.now();\n    this.records = [];\n  }\n  /**\n   * End recording\n   */\n  endRecording() {\n    this.startTime = 0;\n  }\n  /**\n   * Playback recording\n   * @param callback key frame callback\n   * @returns whether the current There are records\n   */\n  play(callback) {\n    if (this.records === null || this.records.length === 0) return false;\n    const records = this.records.slice();\n    const keyframe = (keyIndex) => {\n      const current = records[keyIndex];\n      const next = records[keyIndex + 1];\n      callback(current.state, next === undefined);\n      if (next) {\n        const delay = next.time - current.time;\n        setTimeout(() => keyframe(keyIndex + 1), delay);\n      }\n    };\n    keyframe(0);\n    return true;\n  }\n}\n\nexport { Recorder };\n"))),(0,a.kt)(i.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/3.recording-state/recorder.ts"',title:'"src/3.recording-state/recorder.ts"'},'import { State } from "@realsee/five";\n\n/**\n * Recording class\n */\nclass Recorder {\n  private records: { state: State; time: number }[] | null = null;\n  private startTime: number;\n  constructor() {\n    this.startTime = 0;\n    this.records = null;\n  }\n  /**\n   * Whether\n   has been recorded */\n  hasRecords() {\n    return this.records !== null;\n  }\n  /**\n   * record key frame\n   * @param state five\'s state\n   * @returns\n   */\n  record(state: State) {\n    if (this.records === null) return;\n    this.records.push({\n      state: Object.assign({}, state),\n      time: Date.now() - this.startTime,\n    });\n  }\n  /* *\n   * start recording\n   */\n  startRecording() {\n    this.startTime = Date.now();\n    this.records = [];\n  }\n  /**\n   * end recording\n   */\n  endRecording() {\n    this.startTime = 0;\n  }\n  /**\n   * Playback recording\n   * @param callback Keyframe callback\n   * @returns Whether there is a recording currently\n   */\n  play(callback: (state: State, isFinal: boolean) => void) {\n    if (this.records === null || this.records.length === 0) return false;\n    const records = this.records.slice();\n    const keyframe = (keyIndex: number) => {\n      const current = records[keyIndex];\n      const next = records[keyIndex + 1];\n      callback(current.state, next === undefined);\n      if (next) {\n        const delay = next.time - current.time;\n        setTimeout(() => keyframe(keyIndex + 1), delay);\n      }\n    };\n    keyframe(0);\n    return true;\n  }\n}\n\nexport { Recorder };\n')))),(0,a.kt)("h3",{id:"write-recording-component"},"Write Recording Component"),(0,a.kt)("p",null,"Put ",(0,a.kt)("strong",{parentName:"p"},"Recorder")," into a Vue component."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Add a ",(0,a.kt)("strong",{parentName:"li"},"RecorderController")," file to write components."),(0,a.kt)("li",{parentName:"ol"},"Component has status ",(0,a.kt)("strong",{parentName:"li"},"recording")," and ",(0,a.kt)("strong",{parentName:"li"},"playing"),".Separate status in recording/playback."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("a",{parentName:"li",href:"https://unpkg.com/@realsee/five/docs/modules/vue.html#useFiveEventCallback"},(0,a.kt)("inlineCode",{parentName:"a"},"useFiveEventCallback"))," Gets the Built-in method callback.",(0,a.kt)("br",null),"\nhere we call ",(0,a.kt)("strong",{parentName:"li"},"stateChange")," event, when ",(0,a.kt)("strong",{parentName:"li"},"state")," changes, this event will be triggered, and then ",(0,a.kt)("strong",{parentName:"li"},"State")," calls ",(0,a.kt)("inlineCode",{parentName:"li"},"recorder.record(state)")," method to record.",(0,a.kt)("br",null),(0,a.kt)("blockquote",{parentName:"li"},(0,a.kt)("p",{parentName:"blockquote"},"More event descriptions see ",(0,a.kt)("a",{parentName:"p",href:"https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html"},(0,a.kt)("strong",{parentName:"a"},"Five")," events list")))),(0,a.kt)("li",{parentName:"ol"},"When the playback button is pressed, call the ",(0,a.kt)("inlineCode",{parentName:"li"},"recorder.play(callback)")," method, then call the previously recorded ",(0,a.kt)("strong",{parentName:"li"},"state")," arc call ",(0,a.kt)("strong",{parentName:"li"},"callback")," method."),(0,a.kt)("li",{parentName:"ol"},"The ",(0,a.kt)("strong",{parentName:"li"},"setState")," method to call the record and apply the replay content to change the picture.")),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/RecorderController.vue"',title:'"src/3.recording-state/RecorderController.vue"'},'<template>\n  <div class="card position-fixed m-2 top-0 start-0">\n    <div class="btn-group align-items-center">\n      <button class="btn btn-light " v-show="recordStart" @click="startRecord">\n        <i class="bi bi-record-fill"></i>\n      </button>\n      <button class="btn btn-light " v-show="recordEnd" @click="stopRecord">\n        <i class="bi bi-stop-fill"></i>\n      </button>\n      <button class="btn btn-light " v-show="playingStart" @click="playRecord">\n        <i class="bi bi-play-fill"></i>\n      </button>\n      <p class="badge bg-primary m-2 " v-show="recording" @click="">\n        Recording\n      </p>\n      <p class="badge bg-primary m-2 " v-show="playing" @click="">Playing</p>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref } from "vue";\nimport { Recorder } from "./recorder";\nimport { useFiveState, useFiveEventCallback } from "@realsee/five/vue";\nconst recorder = new Recorder();\nconst [state, setState] = useFiveState();\n\nconst recordStart = ref(true);\nconst recordEnd = ref(false);\nconst playingStart = ref(true);\nconst recording = ref(false);\nconst playing = ref(false);\n\nuseFiveEventCallback("stateChange", (state) => {\n  if (recording.value === true) {\n    recorder.record(state);\n  }\n});\n\nconst startRecord = () => {\n  recorder.startRecording();\n  recordStart.value = false;\n  recordEnd.value = true;\n  recording.value = true;\n  playingStart.value = false;\n};\n\nconst stopRecord = () => {\n  recorder.endRecording();\n  recordStart.value = true;\n  recordEnd.value = false;\n  recording.value = false;\n  playingStart.value = true;\n};\n\nconst playRecord = () => {\n  recordStart.value = false;\n  recordEnd.value = false;\n  recording.value = false;\n  playingStart.value = false;\n  playing.value = true;\n  const hasRecrod = recorder.play((state, isFinal) => {\n    setState(state);\n    if (isFinal) {\n      recordStart.value = true;\n      recordEnd.value = false;\n      recording.value = false;\n      playingStart.value = true;\n      playing.value = false;\n    }\n  });\n  if (!hasRecrod) {\n    recordStart.value = true;\n    recordEnd.value = false;\n    recording.value = false;\n    playingStart.value = true;\n    playing.value = false;\n  }\n};\n<\/script>\n'))),(0,a.kt)(i.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/RecorderController.vue"',title:'"src/3.recording-state/RecorderController.vue"'},'<template>\n  <div class="card position-fixed m-2 top-0 start-0">\n    <div class="btn-group align-items-center">\n      <button class="btn btn-light " v-show="recordStart" @click="startRecord">\n        <i class="bi bi-record-fill"></i>\n      </button>\n      <button class="btn btn-light " v-show="recordEnd" @click="stopRecord">\n        <i class="bi bi-stop-fill"></i>\n      </button>\n      <button class="btn btn-light " v-show="playingStart" @click="playRecord">\n        <i class="bi bi-play-fill"></i>\n      </button>\n      <p class="badge bg-primary m-2 " v-show="recording" @click="">\n        Recording\n      </p>\n      <p class="badge bg-primary m-2 " v-show="playing" @click="">Playing</p>\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { ref } from "vue";\nimport { Recorder } from "./recorder";\nimport { useFiveState, useFiveEventCallback } from "@realsee/five/vue";\nconst recorder = new Recorder();\nconst [state, setState] = useFiveState();\n\nconst recordStart = ref(true);\nconst recordEnd = ref(false);\nconst playingStart = ref(true);\nconst recording = ref(false);\nconst playing = ref(false);\n\nuseFiveEventCallback("stateChange", (state) => {\n  if (recording.value === true) {\n    recorder.record(state);\n  }\n});\n\nconst startRecord = () => {\n  recorder.startRecording();\n  recordStart.value = false;\n  recordEnd.value = true;\n  recording.value = true;\n  playingStart.value = false;\n};\n\nconst stopRecord = () => {\n  recorder.endRecording();\n  recordStart.value = true;\n  recordEnd.value = false;\n  recording.value = false;\n  playingStart.value = true;\n};\n\nconst playRecord = () => {\n  recordStart.value = false;\n  recordEnd.value = false;\n  recording.value = false;\n  playingStart.value = false;\n  playing.value = true;\n  const hasRecrod = recorder.play((state, isFinal) => {\n    setState(state);\n    if (isFinal) {\n      recordStart.value = true;\n      recordEnd.value = false;\n      recording.value = false;\n      playingStart.value = true;\n      playing.value = false;\n    }\n  });\n  if (!hasRecrod) {\n    recordStart.value = true;\n    recordEnd.value = false;\n    recording.value = false;\n    playingStart.value = true;\n    playing.value = false;\n  }\n};\n<\/script>\n')))),(0,a.kt)("h3",{id:"use-status-recording-component"},"Use Status Recording Component"),(0,a.kt)("p",null,"Insert into ",(0,a.kt)("strong",{parentName:"p"},"App")," file ",(0,a.kt)("strong",{parentName:"p"},"GiveProvider")),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/App.vue"',title:'"src/3.recording-state/App.vue"'},'<template>\n  <FiveProvider :work="work">\n    <FiveCanvas :width="width" :height="height" />\n    <ModeController />\n    <LookAroundController />\n    // highlight-start\n    <RecorderController />\n    // highlight-end\n  </FiveProvider>\n</template>\n\n<script setup>\nimport { FiveProvider, FiveCanvas } from "@realsee/five/vue";\nimport { parseWork } from "@realsee/five";\nimport { ref } from "vue";\nimport { useWindowDimensions } from "./useWindowDimensions";\nimport ModeController from "./ModeController.vue";\nimport LookAroundController from "./LookAroundController.vue";\n// highlight-start\nimport RecorderController from "./RecorderController.vue";\n// highlight-end\nconst work = ref();\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nfetch(workURL)\n  .then((response) => response.text())\n  .then((text) => (work.value = parseWork(text)));\nconst { width, height } = useWindowDimensions();\n<\/script>\n'))),(0,a.kt)(i.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue",metastring:'title="src/3.recording-state/App.vue"',title:'"src/3.recording-state/App.vue"'},'<template>\n  <FiveProvider :work="work">\n    <FiveCanvas :width="width" :height="height" />\n    <ModeController />\n    <LookAroundController />\n    // highlight-start\n    <RecorderController />\n    // highlight-end\n  </FiveProvider>\n</template>\n\n<script setup lang="ts">\nimport { FiveProvider, FiveCanvas } from "@realsee/five/vue";\nimport { parseWork } from "@realsee/five";\nimport { ref } from "vue";\nimport { useWindowDimensions } from "./useWindowDimensions";\nimport ModeController from "./ModeController.vue";\nimport LookAroundController from "./LookAroundController.vue";\n// highlight-start\nimport RecorderController from "./RecorderController.vue";\n// highlight-end\nconst work = ref();\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nfetch(workURL)\n  .then((response) => response.text())\n  .then((text) => (work.value = parseWork(text)));\nconst { width, height } = useWindowDimensions();\n<\/script>\n')))),(0,a.kt)("p",null,"Back to your browser to view will find a record and play button in the upper left corner of your page.Try whether the trial function meets expectations."),(0,a.kt)("p",null,"Yes, you\u2019re and can write what complex programs are\ud83e\udd73"),(0,a.kt)("h2",{id:"the-next-section-will-be-completed-by-you"},"The next section will be completed by you"),(0,a.kt)("admonition",{title:"Next chapter we need to deal with the three-dimensional spatial model.",type:"tip"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Learn about the Live SDK gesture interaction."),(0,a.kt)("li",{parentName:"ul"},"Gets a three-dimensional position to a point."))))}v.isMDXComponent=!0}}]);