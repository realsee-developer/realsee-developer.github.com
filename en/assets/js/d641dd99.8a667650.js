"use strict";(self.webpackChunkrealsee_developer_github_com=self.webpackChunkrealsee_developer_github_com||[]).push([[8473],{49613:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var r=n(59496);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=o,h=d["".concat(c,".").concat(u)]||d[u]||m[u]||i;return n?r.createElement(h,a(a({ref:t},p),{},{components:n})):r.createElement(h,a({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var l=2;l<i;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},45558:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(59496),o=n(45924);const i="tabItem_IPoj";function a(e){let{children:t,hidden:n,className:a}=e;return r.createElement("div",{role:"tabpanel",className:(0,o.Z)(i,a),hidden:n},t)}},38637:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(2962),o=n(59496),i=n(45924),a=n(26709),s=n(33548),c=n(14714),l=n(60411);const p="tabList_xr86",m="tabItem_r4_W";function d(e){var t;const{lazy:n,block:a,defaultValue:d,values:u,groupId:h,className:g}=e,k=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=u??k.map((e=>{let{props:{value:t,label:n,attributes:r}}=e;return{value:t,label:n,attributes:r}})),v=(0,s.l)(f,((e,t)=>e.value===t.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const w=null===d?d:d??(null==(t=k.find((e=>e.props.default)))?void 0:t.props.value)??k[0].props.value;if(null!==w&&!f.some((e=>e.value===w)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${w}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:b,setTabGroupChoices:y}=(0,c.U)(),[C,x]=(0,o.useState)(w),R=[],{blockElementScrollPositionUntilNextRender:F}=(0,l.o5)();if(null!=h){const e=b[h];null!=e&&e!==C&&f.some((t=>t.value===e))&&x(e)}const N=e=>{const t=e.currentTarget,n=R.indexOf(t),r=f[n].value;r!==C&&(F(t),x(r),null!=h&&y(h,String(r)))},P=e=>{var t;let n=null;switch(e.key){case"Enter":N(e);break;case"ArrowRight":{const t=R.indexOf(e.currentTarget)+1;n=R[t]??R[0];break}case"ArrowLeft":{const t=R.indexOf(e.currentTarget)-1;n=R[t]??R[R.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,i.Z)("tabs-container",p)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},g)},f.map((e=>{let{value:t,label:n,attributes:a}=e;return o.createElement("li",(0,r.Z)({role:"tab",tabIndex:C===t?0:-1,"aria-selected":C===t,key:t,ref:e=>R.push(e),onKeyDown:P,onClick:N},a,{className:(0,i.Z)("tabs__item",m,null==a?void 0:a.className,{"tabs__item--active":C===t})}),n??t)}))),n?(0,o.cloneElement)(k.filter((e=>e.props.value===C))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==C})))))}function u(e){const t=(0,a.Z)();return o.createElement(d,(0,r.Z)({key:String(t)},e))}},57470:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>m});var r=n(2962),o=(n(59496),n(49613)),i=n(38637),a=n(45558);const s={title:"Status Recording"},c=void 0,l={unversionedId:"front/3d-space/handbook/react-hoc/recording-state",id:"front/3d-space/handbook/react-hoc/recording-state",title:"Status Recording",description:"Previous chapter recalls: Change the perspective",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/front/3d-space/handbook/react-hoc/3.recording-state.md",sourceDirName:"front/3d-space/handbook/react-hoc",slug:"/front/3d-space/handbook/react-hoc/recording-state",permalink:"/en/docs/front/3d-space/handbook/react-hoc/recording-state",draft:!1,tags:[],version:"current",lastUpdatedBy:"sansi.lcj",lastUpdatedAt:1669717185,formattedLastUpdatedAt:"Nov 29, 2022",sidebarPosition:3,frontMatter:{title:"Status Recording"},sidebar:"\u4e09\u7ef4\u7a7a\u95f4",previous:{title:"Change View",permalink:"/en/docs/front/3d-space/handbook/react-hoc/knowing-state"},next:{title:"Points in 3D space",permalink:"/en/docs/front/3d-space/handbook/react-hoc/points-in-3d"}},p={},m=[{value:"Preparatory work",id:"preparatory-work",level:2},{value:"Recording / Playback",id:"recording--playback",level:2},{value:"Write <strong>Recorder</strong>",id:"write-recorder",level:3},{value:"Write Recording Component",id:"write-recording-component",level:3},{value:"Use Status Recording Component",id:"use-status-recording-component",level:3},{value:"The next section will be completed by you",id:"the-next-section-will-be-completed-by-you",level:2}],d={toc:m};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Previous chapter recalls: Change the perspective")," ",(0,o.kt)("br",null),"\nYou know what is ",(0,o.kt)("strong",{parentName:"p"},"State"),", and how to get and modify auto-ring features via ",(0,o.kt)("strong",{parentName:"p"},"State"),".")),(0,o.kt)("admonition",{title:"This chapter can learn to",type:"tip"},(0,o.kt)("ol",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ol"},"Record user operations via ",(0,o.kt)("strong",{parentName:"li"},"State"),"."),(0,o.kt)("li",{parentName:"ol"},"Restore the user action picture with ",(0,o.kt)("strong",{parentName:"li"},"State"),"."))),(0,o.kt)("h2",{id:"preparatory-work"},"Preparatory work"),(0,o.kt)("p",null,"Like the previous section, we create a new directory (",(0,o.kt)("inlineCode",{parentName:"p"},"src/3.recording-state"),"and corresponding ",(0,o.kt)("strong",{parentName:"p"},"html")," and ",(0,o.kt)("strong",{parentName:"p"},"jsx")," or ",(0,o.kt)("strong",{parentName:"p"},"tsx")," files."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"jsx")," or ",(0,o.kt)("strong",{parentName:"p"},"tsx")," files can first copy the previous chapter."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="src/3.recording-state/index.html"',title:'"src/3.recording-state/index.html"'},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="UTF-8" />\n    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n    <title>state recording | Recording state</title>\n    <style>\n      * {\n        margin: 0;\n        padding: 0;\n      }\n      html,\n      body #app {\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n      }\n    </style>\n  </head>\n  <body>\n    <div id="app"></div>\n    <script type="module" src="./index"><\/script>\n  </body>\n</html>\n')),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/withFetchWork.jsx"',title:'"src/3.recording-state/withFetchWork.jsx"'},'import React, { Component } from "react";\nimport { parseWork } from "@realsee/five";\n\n/**\n * React HOC fetch work\n * @param url address of work.json\n */\nfunction withFetchWork(url) {\n  return function (Compnent) {\n    return class extends Component {\n      state = { work: null };\n      componentDidMount() {\n        fetch(url)\n          .then((res) => res.json())\n          .then((json) => {\n            this.setState({ work: parseWork(json) });\n          });\n      }\n      render() {\n        if (this.state.work === null) return null;\n        return <Compnent work={this.state.work} {...this.props} />;\n      }\n    };\n  };\n}\n\nexport { withFetchWork };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/withWindowDimensions.jsx"',title:'"src/3.recording-state/withWindowDimensions.jsx"'},'import React, { Component } from "react";\n\n/**\n * React HOC: Get the size of the current window\n */\nfunction withWindowDimensions() {\n  return function (Compnent) {\n    return class extends Component {\n      state = this.getWindowDimensions();\n      resizeListener = () => {\n        this.setState(this.getWindowDimensions());\n      };\n      getWindowDimensions() {\n        return { width: window.innerWidth, height: window.innerHeight };\n      }\n      componentDidMount() {\n        window.addEventListener("resize", this.resizeListener, false);\n      }\n      componentWillUnmount() {\n        window.removeEventListener("resize", this.resizeListener, false);\n      }\n      render() {\n        const dimensions = {\n          width: this.state.width,\n          height: this.state.height,\n        };\n        return <Compnent windowDimensions={dimensions} {...this.props} />;\n      }\n    };\n  };\n}\n\nexport { withWindowDimensions };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/ModeController.jsx"',title:'"src/3.recording-state/ModeController.jsx"'},'import React, { Component } from "react";\nimport { Five } from "@realsee/five";\nimport { withFive, createFiveFeature } from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport BottomNavigation from "@mui/material/BottomNavigation";\nimport BottomNavigationAction from "@mui/material/BottomNavigationAction";\nimport Paper from "@mui/material/Paper";\nimport DirectionsWalkIcon from "@mui/icons-material/DirectionsWalk";\nimport ViewInArIcon from "@mui/icons-material/ViewInAr";\n\nconst FEATURES = createFiveFeature("currentState", "setState");\n\n/**\n * React Component: Modal Control\n */\nconst ModeController = compose(withFive(FEATURES))(\n  class extends Component {\n    render() {\n      return (\n        <Paper sx={{ position: "fixed", bottom: 0, left: 0, right: 0 }}>\n          <BottomNavigation\n            showLabels\n            value={this.props.$five.currentState.mode}\n            onChange={(_, newValue) => {\n              this.props.$five.setState({ mode: newValue });\n            }}\n          >\n            <BottomNavigationAction\n              label="Panorama roaming"\n              icon={<DirectionsWalkIcon />}\n              value={Five.Mode.Panorama}\n            />\n            <BottomNavigationAction\n              label="Space overview"\n              icon={<ViewInArIcon />}\n              value={Five.Mode.Floorplan}\n            />\n          </BottomNavigation>\n        </Paper>\n      );\n    }\n  }\n);\n\nexport { ModeController };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/LookAroundController.jsx"',title:'"src/3.recording-state/LookAroundController.jsx"'},'import React, { Component } from "react";\nimport { withFive, createFiveFeature } from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport IconButton from "@mui/material/IconButton";\nimport Paper from "@mui/material/Paper";\nimport FlipCameraAndroidIcon from "@mui/icons-material/FlipCameraAndroid";\nimport PauseIcon from "@mui/icons-material/Pause";\n\nconst FEATURES = createFiveFeature("currentState", "setState");\n\n/**\n * ReactComponent: Automatic Ring Button\n */\nconst LookAroundController = compose(withFive(FEATURES))(\n  class extends Component {\n    timer;\n    state = { active: false };\n\n    toggleActive(active) {\n      window.clearInterval(this.timer);\n      this.setState({ active });\n      if (active === true) {\n        this.timer = window.setInterval(() => {\n          this.props.$five.setState({\n            longitude: this.props.$five.currentState.longitude + Math.PI / 360,\n          });\n        }, 16);\n      } else {\n        delete this.timer;\n      }\n    }\n    render() {\n      return (\n        <Paper sx={{ position: "fixed", top: 10, right: 10 }}>\n          {this.state.active ? (\n            <IconButton onClick={() => this.toggleActive(false)}>\n              <PauseIcon />\n            </IconButton>\n          ) : (\n            <IconButton onClick={() => this.toggleActive(true)}>\n              <FlipCameraAndroidIcon />\n            </IconButton>\n          )}\n        </Paper>\n      );\n    }\n  }\n);\n\nexport { LookAroundController };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="rc/3.recording-state/App.jsx"',title:'"rc/3.recording-state/App.jsx"'},'import React, { Component } from "react";\nimport { compose } from "@wordpress/compose";\nimport { createFiveProvider, FiveCanvas } from "@realsee/five/react";\nimport { withFetchWork } from "./withFetchWork";\nimport { withWindowDimensions } from "./withWindowDimensions";\nimport { ModeController } from "./ModeController";\nimport { LookAroundController } from "./LookAroundController";\n\n/** Data URL of work.json */\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nconst FiveProvider = createFiveProvider();\n\nconst App = compose(\n  withFetchWork(workURL),\n  withWindowDimensions()\n)(\n  class extends Component {\n    render() {\n      const { work, windowDimensions } = this.props;\n      return (\n        <FiveProvider initialWork={work}>\n          <FiveCanvas\n            width={windowDimensions.width}\n            height={windowDimensions.height}\n          />\n          <ModeController />;\n          <LookAroundController />;\n        </FiveProvider>\n      );\n    }\n  }\n);\n\nexport { App };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/index.jsx"',title:'"src/3.recording-state/index.jsx"'},'import React from "react";\nimport ReactDOM from "react-dom";\nimport { App } from "./App";\n\nReactDOM.render(<App />, document.querySelector("#app"));\n\nexport {};\n'))),(0,o.kt)(a.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/useFetchWork.tsx"',title:'"src/3.recording-state/useFetchWork.tsx"'},'import React, { Component, ComponentClass } from "react";\nimport { Work, parseWork } from "@realsee/five";\n\n/**\n * React HOC for work\n * @param url work. The address of the son\n */\nfunction withFetchWork<P extends Record<string, any>>(url: string) {\n  return function (\n    Compnent: ComponentClass<P & { work: Work }>\n  ): ComponentClass<P> {\n    return class extends Component<P, { work: Work | null }> {\n      state = { work: null };\n      componentDidMount() {\n        fetch(url)\n          .then((res) => res.json())\n          .then((json) => {\n            this.setState({ work: parseWork(json) });\n          });\n      }\n      render() {\n        if (this.state.work === null) return null;\n        return <Compnent work={this.state.work} {...this.props} />;\n      }\n    };\n  };\n}\n\nexport { withFetchWork };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/useWindowDimensions.tsx"',title:'"src/3.recording-state/useWindowDimensions.tsx"'},'import React, { Component, ComponentClass } from "react";\n\n/**\n * React HOC: Get the current window size\n */\nfunction withWindowDimensions<P extends Record<string, any>>() {\n  return function (\n    Compnent: ComponentClass<\n      P & { windowDimensions: { width: number; height: number } }\n    >\n  ): ComponentClass<P> {\n    return class extends Component<P, { width: number; height: number }> {\n      state = this.getWindowDimensions();\n      resizeListener = () => {\n        this.setState(this.getWindowDimensions());\n      };\n      getWindowDimensions() {\n        return { width: window.innerWidth, height: window.innerHeight };\n      }\n      componentDidMount() {\n        window.addEventListener("resize", this.resizeListener, false);\n      }\n      componentWillUnmount() {\n        window.removeEventListener("resize", this.resizeListener, false);\n      }\n      render() {\n        const dimensions = {\n          width: this.state.width,\n          height: this.state.height,\n        };\n        return <Compnent windowDimensions={dimensions} {...this.props} />;\n      }\n    };\n  };\n}\n\nexport { withWindowDimensions };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/ModeController.tsx"',title:'"src/3.recording-state/ModeController.tsx"'},'import React, { Component } from "react";\nimport { Five, Mode } from "@realsee/five";\nimport {\n  withFive,\n  createFiveFeature,\n  PropTypeOfFiveFeatures,\n} from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport BottomNavigation from "@mui/material/BottomNavigation";\nimport BottomNavigationAction from "@mui/material/BottomNavigationAction";\nimport Paper from "@mui/material/Paper";\nimport DirectionsWalkIcon from "@mui/icons-material/DirectionsWalk";\nimport ViewInArIcon from "@mui/icons-material/ViewInAr";\n\nconst FEATURES = createFiveFeature("currentState", "setState");\ntype Props = PropTypeOfFiveFeatures<typeof FEATURES>;\n\n/**\n * React Component: Model Control\n */\nconst ModeController = compose(withFive(FEATURES))(\n  class extends Component<Props> {\n    render() {\n      return (\n        <Paper sx={{ position: "fixed", bottom: 0, left: 0, right: 0 }}>\n          <BottomNavigation\n            showLabels\n            value={this.props.$five.currentState.mode}\n            onChange={(_, newValue: Mode) => {\n              this.props.$five.setState({ mode: newValue });\n            }}\n          >\n            <BottomNavigationAction\n              label="Panorama roaming"\n              icon={<DirectionsWalkIcon />}\n              value={Five.Mode.Panorama}\n            />\n            <BottomNavigationAction\n              label="Space overview"\n              icon={<ViewInArIcon />}\n              value={Five.Mode.Floorplan}\n            />\n          </BottomNavigation>\n        </Paper>\n      );\n    }\n  }\n);\n\nexport { ModeController };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/LookAroundController.tsx"',title:'"src/3.recording-state/LookAroundController.tsx"'},'import React, { Component } from "react";\nimport {\n  withFive,\n  createFiveFeature,\n  PropTypeOfFiveFeatures,\n} from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport IconButton from "@mui/material/IconButton";\nimport Paper from "@mui/material/Paper";\nimport FlipCameraAndroidIcon from "@mui/icons-material/FlipCameraAndroid";\nimport PauseIcon from "@mui/icons-material/Pause";\n\nconst FEATURES = createFiveFeature("currentState", "setState");\ntype Props = PropTypeOfFiveFeatures<typeof FEATURES>;\ntype State = { active: boolean };\n\n/**\n * ReactComponent: Automatic lookaround button\n */\nconst LookAroundController = compose(withFive(FEATURES))(\n  class extends Component<Props, State> {\n    timer?: number;\n    state = { active: false };\n\n    toggleActive(active: boolean) {\n      window.clearInterval(this.timer);\n      this.setState({ active });\n      if (active === true) {\n        this.timer = window.setInterval(() => {\n          this.props.$five.setState({\n            longitude: this.props.$five.currentState.longitude + Math.PI / 360,\n          });\n        }, 16);\n      } else {\n        delete this.timer;\n      }\n    }\n    render() {\n      return (\n        <Paper sx={{ position: "fixed", top: 10, right: 10 }}>\n          {this.state.active ? (\n            <IconButton onClick={() => this.toggleActive(false)}>\n              <PauseIcon />\n            </IconButton>\n          ) : (\n            <IconButton onClick={() => this.toggleActive(true)}>\n              <FlipCameraAndroidIcon />\n            </IconButton>\n          )}\n        </Paper>\n      );\n    }\n  }\n);\n\nexport { LookAroundController };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/App.tsx"',title:'"src/3.recording-state/App.tsx"'},'import React, { Component } from "react";\nimport { Work } from "@realsee/five";\nimport { createFiveProvider, FiveCanvas } from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport { withFetchWork } from "./withFetchWork";\nimport { withWindowDimensions } from "./withWindowDimensions";\nimport { ModeController } from "./ModeController";\nimport { LookAroundController } from "./LookAroundController";\n\n/** work.json data URL */\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nconst FiveProvider = createFiveProvider();\n\nconst App = compose(\n  withFetchWork(workURL),\n  withWindowDimensions()\n)(\n  class extends Component<{\n    work: Work;\n    windowDimensions: { width: number; height: number };\n  }> {\n    render() {\n      const { work, windowDimensions } = this.props;\n      return (\n        <FiveProvider initialWork={work}>\n          <FiveCanvas\n            width={windowDimensions.width}\n            height={windowDimensions.height}\n          />\n          <ModeController />\n          <LookAroundController />\n        </FiveProvider>\n      );\n    }\n  }\n);\n\nexport { App };\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/index.tsx"',title:'"src/3.recording-state/index.tsx"'},'import React from "react";\nimport ReactDOM from "react-dom";\nimport { App } from "./App";\n\nReactDOM.render(<App />, document.querySelector("#app"));\n\nexport {};\n')))),(0,o.kt)("p",null,"Start service ",(0,o.kt)("inlineCode",{parentName:"p"},"npm run dev"),' and jump to the current page "http://localhost:3000/src/3.recording-state/index.html".'),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Please see your console. The port number will change due to your configuration and current port occupancy, please check the console output.\nIf you use another development build tool, please start the service as required by your own development build tool.")),(0,o.kt)("h2",{id:"recording--playback"},"Recording / Playback"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"This chapter continues to complete an interesting app with ",(0,o.kt)("strong",{parentName:"p"},"State"),".\nThis chapter will complete such an app, log users into ",(0,o.kt)("strong",{parentName:"p"},"State"),"on the page and can replay these actions.",(0,o.kt)("br",null))),(0,o.kt)("h3",{id:"write-recorder"},"Write ",(0,o.kt)("strong",{parentName:"h3"},"Recorder")),(0,o.kt)("p",null,"First, we need to write ",(0,o.kt)("strong",{parentName:"p"},"Recorder")," to support records and playbacks. ",(0,o.kt)("strong",{parentName:"p"},"Recorder")," category is not the content of ",(0,o.kt)("strong",{parentName:"p"},"Five")," , it is only written to achieve the effect of this chapter."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Implement the ",(0,o.kt)("strong",{parentName:"li"},"startRecording / endRecording")," method to start recording and end recording."),(0,o.kt)("li",{parentName:"ol"},"Implementing ",(0,o.kt)("strong",{parentName:"li"},"record(state: State)")," method, recording content.Record between ",(0,o.kt)("strong",{parentName:"li"},"startRecording / endRecording"),"."),(0,o.kt)("li",{parentName:"ol"},"Implement ",(0,o.kt)("strong",{parentName:"li"},"play(callback)")," method, for playbacks, after calling play, install ",(0,o.kt)("strong",{parentName:"li"},"record")," content, call ",(0,o.kt)("strong",{parentName:"li"},"callback")," method,play ",(0,o.kt)("strong",{parentName:"li"},"State"),".")),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="src/3.recording-state/recorder.js"',title:'"src/3.recording-state/recorder.js"'},"/**\n * Recording class\n */\nclass Recorder {\n  constructor() {\n    this.startTime = 0;\n    this.records = null;\n  }\n  /**\n   * Whether\n   has been recorded */\n  hasRecords() {\n    return this.records !== null;\n  }\n  /**\n   * Record keyframe\n   * @param state five of state\n   * @returns\n   */\n  record(state) {\n    if (this.records === null) return;\n    this.records.push({\n      state: Object.assign({}, state),\n      time: Date.now() - this.startTime,\n    });\n  }\n  /**\n   * start recording\n   */\n  startRecording() {\n    this.startTime = Date.now();\n    this.records = [];\n  }\n  /**\n   * End recording\n   */\n  endRecording() {\n    this.startTime = 0;\n  }\n  /**\n   * Playback recording\n   * @param callback key frame callback\n   * @returns whether the current There are records\n   */\n  play(callback) {\n    if (this.records === null || this.records.length === 0) return false;\n    const records = this.records.slice();\n    const keyframe = (keyIndex) => {\n      const current = records[keyIndex];\n      const next = records[keyIndex + 1];\n      callback(current.state, next === undefined);\n      if (next) {\n        const delay = next.time - current.time;\n        setTimeout(() => keyframe(keyIndex + 1), delay);\n      }\n    };\n    keyframe(0);\n    return true;\n  }\n}\n\nexport { Recorder };\n"))),(0,o.kt)(a.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="src/3.recording-state/recorder.ts"',title:'"src/3.recording-state/recorder.ts"'},'import { State } from "@realsee/five";\n\n/**\n * Recording class\n */\nclass Recorder {\n  private records: { state: State; time: number }[] | null = null;\n  private startTime: number;\n  constructor() {\n    this.startTime = 0;\n    this.records = null;\n  }\n  /**\n   * Whether\n   has been recorded */\n  hasRecords() {\n    return this.records !== null;\n  }\n  /**\n   * record key frame\n   * @param state five\'s state\n   * @returns\n   */\n  record(state: State) {\n    if (this.records === null) return;\n    this.records.push({\n      state: Object.assign({}, state),\n      time: Date.now() - this.startTime,\n    });\n  }\n  /* *\n   * start recording\n   */\n  startRecording() {\n    this.startTime = Date.now();\n    this.records = [];\n  }\n  /**\n   * end recording\n   */\n  endRecording() {\n    this.startTime = 0;\n  }\n  /**\n   * Playback recording\n   * @param callback Keyframe callback\n   * @returns Whether there is a recording currently\n   */\n  play(callback: (state: State, isFinal: boolean) => void) {\n    if (this.records === null || this.records.length === 0) return false;\n    const records = this.records.slice();\n    const keyframe = (keyIndex: number) => {\n      const current = records[keyIndex];\n      const next = records[keyIndex + 1];\n      callback(current.state, next === undefined);\n      if (next) {\n        const delay = next.time - current.time;\n        setTimeout(() => keyframe(keyIndex + 1), delay);\n      }\n    };\n    keyframe(0);\n    return true;\n  }\n}\n\nexport { Recorder };\n')))),(0,o.kt)("h3",{id:"write-recording-component"},"Write Recording Component"),(0,o.kt)("p",null,"Put ",(0,o.kt)("strong",{parentName:"p"},"Recorder")," into React components."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add a ",(0,o.kt)("strong",{parentName:"p"},"RecorderController")," file to write components.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Two React state states in the component ",(0,o.kt)("strong",{parentName:"p"},"recording")," and ",(0,o.kt)("strong",{parentName:"p"},"playing"),".Separate status in recording/playback.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://unpkg.com/@realsee/five/docs/modules/react.html#useFiveEventCallback"},(0,o.kt)("inlineCode",{parentName:"a"},"useFiveEventCallback"))," Gets the Built-in method callback.",(0,o.kt)("br",null)," here we call ",(0,o.kt)("strong",{parentName:"p"},"stateChange")," event, when ",(0,o.kt)("strong",{parentName:"p"},"state")," changes, this event will be triggered, and then ",(0,o.kt)("strong",{parentName:"p"},"State")," calls ",(0,o.kt)("inlineCode",{parentName:"p"},"recorder.record(state)")," method to record.",(0,o.kt)("br",null)),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"More event descriptions see ",(0,o.kt)("a",{parentName:"p",href:"https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html"},(0,o.kt)("strong",{parentName:"a"},"Five")," events list")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"When the playback button is pressed, call the ",(0,o.kt)("inlineCode",{parentName:"p"},"recorder.play(callback)")," method, then call the previously recorded ",(0,o.kt)("strong",{parentName:"p"},"state")," arc call ",(0,o.kt)("strong",{parentName:"p"},"callback")," method.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("strong",{parentName:"p"},"setState")," method to call the record and apply the replay content to change the picture."))),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/RecorderController.jsx"',title:'"src/3.recording-state/RecorderController.jsx"'},'import React, { Component } from "react";\nimport { withFive, createFiveFeature } from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport Button from "@mui/material/Button";\nimport IconButton from "@mui/material/IconButton";\nimport Paper from "@mui/material/Paper";\nimport FiberManualRecordIcon from "@mui/icons-material/FiberManualRecord";\nimport StopIcon from "@mui/icons-material/Stop";\nimport PlayArrowIcon from "@mui/icons-material/PlayArrow";\nimport { Recorder } from "./recorder";\n\nconst FEATURES = createFiveFeature("state", "setState", "on", "off");\n\n/**\n * ReactComponent: State Recorder\n */\nconst RecorderController = compose(withFive(FEATURES))(\n  class extends Component {\n    recorder = new Recorder();\n    state = { recording: false, playing: false };\n\n    startRecording = () => {\n      this.recorder.startRecording();\n      this.setState({ recording: true });\n    };\n\n    endRecording = () => {\n      this.recorder.endRecording();\n      this.setState({ recording: false });\n    };\n\n    play = () => {\n      const hasRecord = this.recorder.play((state, isFinal) => {\n        this.props.$five.setState(state);\n        this.setState({ playing: !isFinal });\n      });\n      this.setState({ playing: hasRecord });\n    };\n\n    record = (state) => {\n      this.recorder.record(state);\n    };\n\n    componentDidMount() {\n      this.props.$five.on("stateChange", this.record);\n    }\n\n    componentWillUnmount() {\n      this.props.$five.off("stateChange", this.record);\n    }\n\n    render() {\n      if (this.state.recording) {\n        return (\n          <Paper sx={{ position: "fixed", top: 10, left: 10 }}>\n            <IconButton onClick={this.endRecording}>\n              <StopIcon />\n            </IconButton>\n            <Button disabled>Recording</Button>\n          </Paper>\n        );\n      }\n      if (this.state.playing) {\n        return (\n          <Paper sx={{ position: "fixed", top: 10, left: 10 }}>\n            <Button disabled>Playing</Button>\n          </Paper>\n        );\n      }\n      return (\n        <Paper sx={{ position: "fixed", top: 10, left: 10 }}>\n          <IconButton onClick={this.startRecording}>\n            <FiberManualRecordIcon />\n          </IconButton>\n          <IconButton onClick={this.play}>\n            <PlayArrowIcon />\n          </IconButton>\n        </Paper>\n      );\n    }\n  }\n);\n\nexport { RecorderController };\n'))),(0,o.kt)(a.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/RecorderController.tsx"',title:'"src/3.recording-state/RecorderController.tsx"'},'import React, { Component } from "react";\nimport { State } from "@realsee/five";\nimport {\n  withFive,\n  createFiveFeature,\n  PropTypeOfFiveFeatures,\n} from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport Button from "@mui/material/Button";\nimport IconButton from "@mui/material/IconButton";\nimport Paper from "@mui/material/Paper";\nimport FiberManualRecordIcon from "@mui/icons-material/FiberManualRecord";\nimport StopIcon from "@mui/icons-material/Stop";\nimport PlayArrowIcon from "@mui/icons-material/PlayArrow";\nimport { Recorder } from "./recorder";\n\nconst FEATURES = createFiveFeature("state", "setState", "on", "off");\ntype Props = PropTypeOfFiveFeatures<typeof FEATURES>;\n\n/**\n * ReactComponent: state recording\n */\nconst RecorderController = compose(withFive(FEATURES))(\n  class extends Component<Props, { recording: boolean; playing: boolean }> {\n    recorder = new Recorder();\n    state = { recording: false, playing: false };\n\n    startRecording = () => {\n      this.recorder.startRecording();\n      this.setState({ recording: true });\n    };\n\n    endRecording = () => {\n      this.recorder.endRecording();\n      this.setState({ recording: false });\n    };\n\n    play = () => {\n      const hasRecord = this.recorder.play((state, isFinal) => {\n        this.props.$five.setState(state);\n        this.setState({ playing: !isFinal });\n      });\n      this.setState({ playing: hasRecord });\n    };\n\n    record = (state: State) => {\n      this.recorder.record(state);\n    };\n\n    componentDidMount() {\n      this.props.$five.on("stateChange", this.record);\n    }\n\n    componentWillUnmount() {\n      this.props.$five.off("stateChange", this.record);\n    }\n\n    render() {\n      if (this.state.recording) {\n        return (\n          <Paper sx={{ position: "fixed", top: 10, left: 10 }}>\n            <IconButton onClick={this.endRecording}>\n              <StopIcon />\n            </IconButton>\n            <Button disabled>Recording</Button>\n          </Paper>\n        );\n      }\n      if (this.state.playing) {\n        return (\n          <Paper sx={{ position: "fixed", top: 10, left: 10 }}>\n            <Button disabled>Playing</Button>\n          </Paper>\n        );\n      }\n      return (\n        <Paper sx={{ position: "fixed", top: 10, left: 10 }}>\n          <IconButton onClick={this.startRecording}>\n            <FiberManualRecordIcon />\n          </IconButton>\n          <IconButton onClick={this.play}>\n            <PlayArrowIcon />\n          </IconButton>\n        </Paper>\n      );\n    }\n  }\n);\n\nexport { RecorderController };\n')))),(0,o.kt)("h3",{id:"use-status-recording-component"},"Use Status Recording Component"),(0,o.kt)("p",null,"Insert into ",(0,o.kt)("strong",{parentName:"p"},"App")," file ",(0,o.kt)("strong",{parentName:"p"},"GiveProvider")),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="src/3.recording-state/App.jsx"',title:'"src/3.recording-state/App.jsx"'},'import React, { Component } from "react";\nimport { compose } from "@wordpress/compose";\nimport { createFiveProvider, FiveCanvas } from "@realsee/five/react";\nimport { withFetchWork } from "./withFetchWork";\nimport { withWindowDimensions } from "./withWindowDimensions";\nimport { ModeController } from "./ModeController";\nimport { LookAroundController } from "./LookAroundController";\n// highlight-start\nimport { RecorderController } from "./RecorderController";\n// highlight-end\n\n/** Data URL of work.json */\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nconst FiveProvider = createFiveProvider();\n\nconst App = compose(\n  withFetchWork(workURL),\n  withWindowDimensions()\n)(\n  class extends Component {\n    render() {\n      const { work, windowDimensions } = this.props;\n      return (\n        <FiveProvider initialWork={work}>\n          <FiveCanvas\n            width={windowDimensions.width}\n            height={windowDimensions.height}\n          />\n          <ModeController />;\n          <LookAroundController />; // highlight-start\n          <RecorderController />; // highlight-end\n        </FiveProvider>\n      );\n    }\n  }\n);\n\nexport { App };\n'))),(0,o.kt)(a.Z,{value:"TypeScript",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/3.recording-state/App.tsx"',title:'"src/3.recording-state/App.tsx"'},'import React, { Component } from "react";\nimport { Work } from "@realsee/five";\nimport { createFiveProvider, FiveCanvas } from "@realsee/five/react";\nimport { compose } from "@wordpress/compose";\nimport { withFetchWork } from "./withFetchWork";\nimport { withWindowDimensions } from "./withWindowDimensions";\nimport { ModeController } from "./ModeController";\nimport { LookAroundController } from "./LookAroundController";\n// highlight-start\nimport { RecorderController } from "./RecorderController";\n// highlight-end\n\n/** data URL of work.json */\nconst workURL =\n  "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";\n\nconst FiveProvider = createFiveProvider();\n\nconst App = compose(\n  withFetchWork(workURL),\n  withWindowDimensions()\n)(\n  class extends Component<{\n    work: Work;\n    windowDimensions: { width: number; height: number };\n  }> {\n    render() {\n      const { work, windowDimensions } = this.props;\n      return (\n        <FiveProvider initialWork={work}>\n          <FiveCanvas\n            width={windowDimensions.width}\n            height={windowDimensions.height}\n          />\n          <ModeController />\n          <LookAroundController />\n          // highlight-start\n          <RecorderController />\n          // highlight-end\n        </FiveProvider>\n      );\n    }\n  }\n);\n\nexport { App };\n')))),(0,o.kt)("p",null,"Back to your browser to view will find a record and play button in the upper left corner of your page.Try whether the trial function meets expectations."),(0,o.kt)("p",null,"Yes, you\u2019re and can write what complex programs are\ud83e\udd73"),(0,o.kt)("h2",{id:"the-next-section-will-be-completed-by-you"},"The next section will be completed by you"),(0,o.kt)("admonition",{title:"Next chapter we need to deal with the three-dimensional model",type:"tip"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"Learn about the Live SDK gesture interaction."),(0,o.kt)("li",{parentName:"ul"},"Gets a three-dimensional position to a point."))))}u.isMDXComponent=!0}}]);