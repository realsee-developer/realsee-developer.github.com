(this["webpackJsonpsparrow-js"]=this["webpackJsonpsparrow-js"]||[]).push([[0],{138:function(e,t,n){},139:function(e,t,n){},156:function(e,t,n){},158:function(e,t,n){},195:function(e,t,n){},196:function(e,t,n){},197:function(e,t,n){},198:function(e,t,n){},200:function(e,t,n){},207:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){},210:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(21),a=n.n(i),o=(n(138),n(6)),s=(n(139),n(32)),u=n(44),l=n(61),d=n(58),f=n(30),j=n(89),v=(n(156),n(26)),b=n.n(v),p=n(112),h=n(1),m=r.createContext(null);var x=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).initFive=function(e){if(!r.state.five){var t={imageOptions:{size:1024},textureOptions:{size:512},maxFps:70,play:!0,poweredByRealsee:!0,onlyRenderIfNeeds:!0,floorplan:{defaultFov:80,minFov:60,maxFov:120,defaultLatitude:0,defaultLongitude:0,minLatitude:0,maxLatitude:Math.PI/2},plugins:[[p.a,"minimodel"]]},n=new j.Five(t),c=document.querySelector("#".concat(r.props.spaceRootId));n.appendTo(c),n.load(Object(j.parseWork)(e)),n.once("modelLoaded",(function(){r.setState({five:n})})),n.on("stateChange",(function(e,t){t&&r.props.onStateChange(JSON.parse(JSON.stringify(e)))})),window.addEventListener("resize",(function(){return n.refresh()}),!1)}},r.state={five:null,work:e.work},r}return Object(u.a)(n,[{key:"componentDidMount",value:function(){this.initFive(this.state.work)}},{key:"componentDidUpdate",value:function(e,t,n){t.work!==this.state.work&&this.initFive(this.state.work),e.state!==this.props.state&&this.state.five&&this.state.five.setState(this.props.state,!1,!1),e.isSplit!==this.props.isSplit&&this.state.five&&this.state.five.refresh()}},{key:"componentWillUnmount",value:function(){this.state.five.dispose()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.spaceRootId,r=e.isMain,c=e.isSplit,i=b()("vr-container",{main:r},{split:c});return Object(h.jsx)("div",{id:n,className:i,children:Object(h.jsx)(m.Provider,{value:this.state.five,children:t})})}}]),n}(r.Component);x.defaultProps={spaceRootId:"",work:null},x.withSpace=function(e){return function(t){var n=Object.assign({},t);return Object(h.jsx)(m.Consumer,{children:function(t){return t?Object(h.jsx)(e,Object(f.a)({five:t},n)):Object(h.jsx)("div",{className:"null"})}})}};var O=x;n(158);var g=function(e){var t=c.a.useState(!1),n=Object(o.a)(t,2),r=n[0],i=n[1],a=e.five,s=c.a.useRef(null);return c.a.useEffect((function(){if(s.current){var e=a.plugins.minimodel,t=s.current.clientHeight,n=s.current.clientWidth;e.appendTo(s.current,{height:t,width:n})}}),[a.plugins.minimodel]),a.on("modeChange",(function(e,t){if("Floorplan"===e)return i(!0);i(!1)})),Object(h.jsx)("div",{className:b()("minimodel-wrap",{"minimodel-wrap__hidden":r}),children:Object(h.jsx)("div",{onClick:function(){return a.setState({mode:"Floorplan"})},style:Object(f.a)({},{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:"40px",right:"20px",padding:"10px",width:"75px",height:"100px",background:"linear-gradient(transparent, rgba(0, 0, 0, .2))"}),ref:s})})},w=n(9),k=n.n(w),y=n(20),C=function(e,t){var n,r,c,i;if(!(i=t?null===(c=t.split("?")[1])||void 0===c?void 0:c.split("&"):null===(n=window.location.search)||void 0===n||null===(r=n.slice(1))||void 0===r?void 0:r.split("&")))return"";var a=i.find((function(t){return t.split("=")[0]===e}));return(null===a||void 0===a?void 0:a.split("=")[1])||""},N=n(113),_=n(165),S={getUserId:"get:/demo/auth/login",getRoomDetail:"post:/demo/live/room/detail",roomCreate:"post:/demo/live/room/create",getTicket:"post:/demo/live/apply/ticket",getRtcSign:"post:/demo/live/voice/sign"};var E,R=function(e,t){2===arguments.length&&"function"===typeof t&&(t=void 0);var n=e;if(_(S[n]))throw new Error("requestName is not defined");var r=(S[n]||n).split(":"),c=Object(o.a)(r,2),i=c[0],a=c[1],s="https://ka-vr-demo-developer.realsee.com".concat(a),u=fetch(s,{body:JSON.stringify(t),method:null===i||void 0===i?void 0:i.toUpperCase()}).then((function(e){return e.json()})).then((function(e){if(0!==e.code||!Object.keys(e.data).length)throw Error(e.status);return e.data}));return u},I=window.navigator.userAgent,L=/micromessenger/i.test(I)&&/miniprogram/i.test(I),B=/iphone|ipad/i.test(I),T=/android/i.test(I),A=B||T,F=n(70),U=n(90),M=n(114),J=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"closeWebView",value:function(){return window.history.back()}},{key:"openWebView",value:function(e,t){return window.location.href(e)}},{key:"actionShare",value:function(e){return function(){}}},{key:"getUserInfo",value:function(){var e=Object(y.a)(k.a.mark((function e(){var t,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R("getUserId").then((function(e){return e.user_id})).catch((function(e){return e.message}));case 2:return t=e.sent,n={userId:t},e.abrupt("return",[n]);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(y.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R("getUserId").then((function(e){return e.user_id})).catch((function(e){return e.message}));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(y.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"closeLoading",value:function(){var e=Object(y.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getBangsHeight",value:function(){var e=Object(y.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),V=n(71),z=function(){var e=Object(y.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R("getRtcSign",{voice_id:t.voiceId,room_id:t.roomId,user_id:t.userId}).then((function(e){return{sdkAppId:Number(e.voice_app_id),userId:e.user_identifier,userSig:e.sign}})).catch((function(e){throw Error(e.message)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();E=L?new U.VRWebViewRTC({jsBridge:new V.JSBridgeMiniprogram,getVoiceSign:z}):A?new U.VRWebViewRTC({jsBridge:new F.JSBridgeApp,getVoiceSign:z}):new M.BrowserRTC({jsBridge:new J,getVoiceSign:z});var P=Object(N.createLiveReact)({__debug__:!0,rtc:E}),W=n(33),K=n(47),D=Object(K.b)({name:"live",initialState:{state:{roomCode:""}},reducers:{setLiveStateToStore:function(e,t){e.state=Object.assign({},e.state,t.payload)}},extraReducers:function(e){}}),H=D.actions.setLiveStateToStore,q=function(e){return e.live.state},$=D.reducer,G=n(27),Q=Object(K.b)({name:"space",initialState:{state:{type:"default",mode:"user",split:!1}},reducers:{setSpaceStateToStore:function(e,t){e.state=Object.assign({},e.state,t.payload)}},extraReducers:function(e){}}),X=Q.actions.setSpaceStateToStore,Y=function(e){return e.space.state},Z=Q.reducer,ee=P.useConnect,te=P.useLiveAction;function ne(){var e=te().exit,t=ee(),n=Object(W.useJSBridgeAction)(),r=n.login,c=n.getUserInfo,i=Object(G.b)(),a=function(){var e=Object(y.a)(k.a.mark((function e(){var t,n,i,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!A){e.next=3;break}return e.next=3,r();case 3:return e.next=5,c();case 5:if(t=e.sent,n=Object(o.a)(t,2),i=n[0],a=n[1],i){e.next=11;break}throw Error((null===a||void 0===a?void 0:a.message)||"\u8eab\u4efd\u4fe1\u606f\u83b7\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 11:return e.abrupt("return",i.userId);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{liveConnect:function(){var e=Object(y.a)(k.a.mark((function e(){var n,r,c,s,u,l,d,f;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.location.search.includes("userRole=audience")?"audience":"anchor",e.next=3,a();case 3:if(r=e.sent,"anchor"!==n){e.next=15;break}return e.next=7,re(r,n);case 7:u=e.sent,l=Object(o.a)(u,2),d=l[0],f=l[1],c=d,s=f,e.next=19;break;case 15:return s=C("roomCode"),e.next=18,ce(s);case 18:c=e.sent;case 19:return e.abrupt("return",Promise.resolve().then((function(){i(H({roomCode:s})),t({force:!0,url:c,getTicket:function(){var e=Object(y.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie({roomCode:s,userId:r,userRole:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})})).catch((function(e){return console.error(e.message)})));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),liveExit:function(){return Promise.resolve().then((function(){return e()})).then((function(e){if(!e)throw Error("\u9000\u51fa\u5e26\u770b\u5931\u8d25");i(X({mode:"user"})),i(H({roomCode:""}))})).catch((function(e){console.error(e.message||"\u9000\u51fa\u5e26\u770b\u5931\u8d25")}))},liveConnectFromUrl:function(){var e=Object(y.a)(k.a.mark((function e(n){var r,c,o,s;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=C("userRole",n),c=C("roomCode",n),C("enterLive",n)&&c){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,a();case 7:return o=e.sent,e.next=10,ce(c);case 10:return s=e.sent,e.abrupt("return",Promise.resolve().then((function(){i(H({roomCode:c})),t({force:!0,url:s,getTicket:function(){var e=Object(y.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ie({roomCode:c,userId:o,userRole:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})})).catch((function(e){return console.error(e.message)})));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}var re=function(){var e=Object(y.a)(k.a.mark((function e(t,n){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",R("roomCreate",{create_user_role:n,create_user_id:t}).then((function(e){return[e.room_link,e.room_id]})).catch((function(e){throw Error(e.message||"\u8bf7\u6c42\u5e26\u770b\u623f\u95f4\u4fe1\u606f\u5931\u8d25")})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ce=function(){var e=Object(y.a)(k.a.mark((function e(t){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",R("getRoomDetail",{room_id:t}).then((function(e){return e.room_link})).catch((function(e){throw Error(e.message||"\u67e5\u8be2\u5e26\u770b\u623f\u95f4\u4fe1\u606f\u5931\u8d25")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=Object(y.a)(k.a.mark((function e(t){var n,r,c;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomCode,r=t.userId,c=t.userRole,e.abrupt("return",R("getTicket",{room_id:n,user_id:r,user_role:c}).then((function(e){return e.ticket})).catch((function(e){throw Error(e.message||"\u83b7\u53d6\u5e26\u770b\u95e8\u7968\u5931\u8d25")})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=P.useKeyframe,oe=P.useSelfInfo;function se(){var e=Object(G.c)(Y),t=Object(G.b)(),n=c.a.useState(e),r=Object(o.a)(n,2),i=r[0],a=r[1],s=ae("SpaceState"),u=Object(o.a)(s,2)[1],l=oe(),d=Object(o.a)(l,1)[0],f=c.a.useCallback((function(n){var r,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i="function"===typeof n?n():n;c&&"live"===e.mode&&(null===d||void 0===d||null===(r=d.permission)||void 0===r?void 0:r.sync_frame)&&u(i),t(X(i))}),[t,u,e.mode,d]);return c.a.useEffect((function(){return a(e)}),[e]),[i,f]}var ue=n(76);n(195);function le(){}var de=[],fe=-1,je=function(e){var t=b()("realsee-design-barrage",e.className),n=Math.floor(100*Math.random());return(n<20||80<n)&&(n=50),Object(h.jsx)("div",{className:t,style:{top:"".concat(n,"%")},children:Object(h.jsx)("div",{className:"react-barrage-contain",children:e.children})})},ve=function(e){var t=e.content,n=e.duration,r=void 0===n?1:n,c=e.onClose,i=void 0===c?le:c,o=Object(ue.a)(e,["content","duration","onClose"]),s=++fe,u=document.createElement("div");document.body.appendChild(u);var l=function(){l=le,de[s]=null,a.a.unmountComponentAtNode(u),u.parentNode.removeChild(u),i()};if(de[s]=l,a.a.render(Object(h.jsx)(je,Object(f.a)(Object(f.a)({},o),{},{children:t})),u),0!==r){var d=window.innerWidth>768?2:r;setTimeout(l,1e4*d)}return l};je.message=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-barrage"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),ve(e)},je.unmount=function(){de.forEach((function(e){e&&e()}))};var be=je,pe=P.useSelfInfo,he=P.useLiveAction,me=P.useLiveEventCallback;var xe=P.useRTCEventCallback;n(196),n(197);var Oe=n(244),ge=n(249),we=n(250),ke=n(118),ye=n.n(ke);n(198);var Ce,Ne,_e=function(e){return Object(h.jsx)("div",{className:"btn-wrap",onClick:e.onClick,children:e.text})},Se=window.location.search.includes("userRole=audience"),Ee=function(){var e=ne(),t=e.liveConnect,n=e.liveConnectFromUrl,c=(Object(W.useJSBridgeAction)().closeWebView,r.createRef());return Object(h.jsxs)("div",{className:"default__user",children:[Object(h.jsx)("div",{className:"gui__top",children:Object(h.jsx)("div",{className:"gui__top--bar",children:Object(h.jsx)(Oe.a,{className:"title btn",sx:{color:"white",fontSize:"16px"},children:"\u5982\u89c6\u5f00\u53d1\u8005\u4e2d\u5fc3\u793a\u4f8b--user\u6001"})})}),Object(h.jsx)("div",{className:"gui__overlay",children:Object(h.jsx)("div",{className:"scene-overlay"})}),Object(h.jsx)("div",{className:"gui__bottom",children:Object(h.jsx)("div",{className:"controls",children:Object(h.jsx)("div",{className:"collapsible-list",children:Object(h.jsx)("div",{className:"collapsible-item",children:Se?Object(h.jsxs)(ge.a,{children:[Object(h.jsx)(we.a,{type:"text",placeholder:"\u8bf7\u8f93\u5165\u5e26\u770b\u94fe\u63a5",inputRef:c}),Object(h.jsx)(Oe.a,{sx:{color:"white"},onClick:function(){c.current.value?n(c.current.value):console.log("\u8f93\u5165\u6709\u8bef")},children:Object(h.jsx)(ye.a,{})})]}):Object(h.jsx)(ge.a,{className:"live--open",onClick:function(){return t()},sx:{display:"flex",justifyContent:"center"},children:Object(h.jsx)(_e,{text:"\u8fdb\u5165\u5e26\u770b"})})})})})})]})},Re=(n(200),n(124)),Ie=n.n(Re),Le=n(125),Be=n.n(Le),Te=n(126),Ae=n.n(Te),Fe=n(57),Ue=n.n(Fe),Me=n(75),Je=n.n(Me),Ve=n(127),ze=n.n(Ve),Pe=n(246),We=n(36),Ke=n(60),De=n(251),He=n(120),qe=n.n(He),$e=n(119),Ge=n.n($e),Qe=Ke.a.div(Ce||(Ce=Object(We.a)(["\n  max-height: 200px;\n  display: flex;\n  flex-flow: column;\n  overflow-y: auto;\n  font-size: 12px;\n  pointer-events: auto;\n"]))),Xe=Ke.a.div(Ne||(Ne=Object(We.a)(["\n  display: flex;\n  flex-flow: row wrap;\n  align-items: center;\n  padding: 4px 0;\n  pointer-events: auto;\n  \n  > span {\n    display: flex;\n  }\n  \n  & > .role {\n    padding-left: 4px;\n    padding-right: 4px;\n    border-radius: 2px;\n    background-color: #5a6268;\n    color: white;\n  }\n\n  & > .self-tag {\n    color: darkorange;\n  }\n  \n  & > .nickname {\n    color: white;\n  }\n\n  & > .nickname.self-name {\n    color: greenyellow;\n  }\n\n  & > .btn {\n    color: darkorange;\n    cursor: pointer;\n  }\n\n  & > .edit-btn-groups {\n    display: inline-flex;\n  }\n\n  & > .status {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background-color: #5a6268;\n\n    &.online {\n      background-color: aquamarine;\n    }\n  }\n"]))),Ye=function(e){var t=c.a.useState(!1),n=Object(o.a)(t,2),r=n[0],i=n[1],a=c.a.createRef();return Object(h.jsx)("div",{className:"user-info",children:Object(h.jsx)(Qe,{className:"user-list-panel",children:e.list&&e.list.map((function(t,n){return function(t,n){var c=t.id,o=t.micro_status,s=t.current_ws_online,u=t.permission,l=t.extension,d=t.user_role,f=c===e.selfInfo.id,j=!f&&s&&(null===u||void 0===u?void 0:u.change_other_status),v=e.volumeLists.find((function(e){return c===e.id})),p=!!(v&&v.audioVolume>=10),m="";return"anchor"===d?m="\u4e3b\u6301\u4eba":"audience"===d&&(m="\u89c2\u4f17"),Object(h.jsxs)(Xe,{className:"user-list-item",children:[Object(h.jsx)("span",{onClick:function(){return e.onForbiddenMicro(c)},children:Object(h.jsx)(De.a,{sx:{display:"flex",marginRight:"2px"},children:p?Object(h.jsx)(Ue.a,{fontSize:"small",color:"primary"}):o?Object(h.jsx)(Ge.a,{fontSize:"small"}):Object(h.jsx)(Je.a,{fontSize:"small"})})}),Object(h.jsx)("span",{className:"role",children:m}),f&&Object(h.jsx)("span",{className:"self-tag",children:"[\u81ea\u5df1]"}),f&&r?Object(h.jsx)(we.a,{className:"nickname",autoFocus:!0,defaultValue:"",type:"text",inputRef:a}):Object(h.jsx)("span",{className:b()("nickname",{"self-name":f}),children:(null===l||void 0===l?void 0:l.nickname)||c}),Object(h.jsx)("span",{className:b()("status",{online:s})}),f&&!r&&Object(h.jsx)("span",{onClick:function(){return i(!0)},className:"edit-nickname btn",children:"[\u4fee\u6539\u6635\u79f0]"}),f&&r&&Object(h.jsxs)("span",{className:"edit-btn-groups btn",children:[Object(h.jsx)("span",{onClick:function(){var t;i(!1),e.onNickNameChange(null===(t=a.current)||void 0===t?void 0:t.value)},className:"submit-nickname btn",children:"[\u63d0\u4ea4\u4fee\u6539]"}),Object(h.jsx)("span",{onClick:function(){return i(!1)},className:"exit-edit-nickname btn",children:"[\u9000\u51fa]"})]}),j&&Object(h.jsx)("span",{onClick:function(){return e.onKickUser(c)},children:Object(h.jsx)(De.a,{sx:{display:"flex",marginLeft:"2px"},children:Object(h.jsx)(qe.a,{fontSize:"small"})})})]},n)}(t,n)}))})})},Ze=n(46),et=n.n(Ze),tt=n(245),nt=n(248),rt=n(252),ct=n(62),it=n(123),at=n.n(it),ot=n(121),st=n.n(ot),ut=n(122),lt=n.n(ut);n(207);function dt(){}var ft=[],jt=-1,vt=function(e){var t=b()("realsee-design-toast",e.className);return Object(h.jsx)("div",{className:t,children:Object(h.jsx)("div",{className:"react-toast-contain",children:e.children})})},bt=function(e){var t=e.content,n=e.duration,r=void 0===n?1.5:n,c=e.onClose,i=void 0===c?dt:c,o=Object(ue.a)(e,["content","duration","onClose"]),s=++jt,u=document.createElement("div");document.body.appendChild(u);var l=function(){l=dt,ft[s]=null,a.a.unmountComponentAtNode(u),u.parentNode.removeChild(u),i()};return ft[s]=l,a.a.render(Object(h.jsx)(vt,Object(f.a)(Object(f.a)({},o),{},{children:t})),u),0!==r&&setTimeout(l,1e3*r),l};vt.error=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-toast-error"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),bt(e)},vt.success=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-toast-success"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),bt(e)},vt.unmount=function(){ft.forEach((function(e){e&&e()}))};var pt=vt;var ht=function(e){var t=c.a.useState(null),n=Object(o.a)(t,2),r=n[0],i=n[1],a=c.a.useState(null),s=Object(o.a)(a,2);return s[0],s[1],Object(W.useJSBridgeAction)().actionShare,Object(h.jsx)(tt.a,{open:e.open,children:Object(h.jsxs)("div",{className:"modal__wrap",children:[Object(h.jsxs)("div",{className:"modal__header",children:[Object(h.jsx)("div",{className:"share",children:"\u5206\u4eab"}),Object(h.jsx)(Oe.a,{onClick:function(){e.onClose()},className:"close",sx:{color:"black"},children:Object(h.jsx)(et.a,{fontSize:"small"})})]}),Object(h.jsxs)("div",{className:"modal__body",children:[Object(h.jsx)("div",{className:"link-icon-list",children:Object(h.jsxs)(ge.a,{children:[Object(h.jsx)(Oe.a,{onClick:function(e){i(e.currentTarget)},sx:{backgroundColor:"#f1f3f4",color:"black"},children:Object(h.jsx)(at.a,{})}),Object(h.jsx)(nt.a,{open:Boolean(r),anchorEl:r,onClose:function(){i(null)},anchorOrigin:{vertical:"center",horizontal:"center"},children:Object(h.jsx)(rt.a,{sx:{p:2},children:Object(h.jsx)(st.a,{value:e.shareConfig.shareLink,level:"H",includeMargin:!0})})})]})}),Object(h.jsxs)(ge.a,{className:"link-copy link-content",children:[Object(h.jsx)(ct.c,{disabled:!0,className:"link",value:e.shareConfig.shareLink,sx:{padding:"0 4px"}}),Object(h.jsx)(Oe.a,{onClick:function(){lt()(e.shareConfig.shareLink),pt.success("\u64cd\u4f5c\u6210\u529f")},className:"copy",sx:{fontSize:"16px",color:"black"},children:"\u590d\u5236"})]})]}),Object(h.jsx)("div",{className:"modal__footer"})]})})},mt=n(128),xt=n.n(mt),Ot=P.useSelfInfo,gt=P.useUserList,wt=P.useLiveAction,kt=P.useRTCEventCallback,yt=function(){var e=ne().liveExit,t=Object(G.c)(q),n=gt(),i=r.useState(!0),a=Object(o.a)(i,2),s=a[0],u=a[1],l=r.createRef(),d=function(e){var t=pe(),n=Object(o.a)(t,1)[0],r=he().broadcast;return me("broadcast",(function(e){switch(e.event_id){case"greet":be.message(e.data.message);break;default:console.log("___broadcast__bug__")}})),c.a.useCallback((function(e){var t;r({event_id:e.event_id,data:{message:"".concat((null===n||void 0===n||null===(t=n.extension)||void 0===t?void 0:t.nickname)||(null===n||void 0===n?void 0:n.id),"\u8bf4\uff1a").concat(e.message)}},[],0)}),[e,n])}(),f=Ot(),j=Object(o.a)(f,2),v=j[0],b=j[1],p=r.useState(!1),m=Object(o.a)(p,2),x=m[0],O=m[1],g=wt(),w=g.kick,k=g.toggleMicro,y=g.forbidMicro,C=function(e){var t=c.a.useState([]),n=Object(o.a)(t,2),r=n[0],i=n[1];return xe("userVolumes",(function(e){i(e)})),r}(),N=r.useState(!1),_=Object(o.a)(N,2),S=_[0],E=_[1],R=r.useState(!1),I=Object(o.a)(R,2),L=I[0],B=I[1];r.useEffect((function(){if(v&&C.length){var e=C.find((function(e){return v.id===e.userId})),t=!!(e&&e.audioVolume>=10);E(t)}}),[C]),kt("joined",(function(){console.log("rtc -- joined")})),kt("error",(function(e){console.log("rtc -- error: ",e.message)}));var T=function(){e().then((function(){pt.success("\u9000\u51fa\u5e26\u770b")}))};return Object(h.jsxs)("div",{className:"default__live",children:[Object(h.jsx)("div",{className:"gui__top",children:Object(h.jsxs)("div",{className:"gui__top--bar",children:[Object(h.jsx)(Oe.a,{className:"close btn",sx:{color:"white"},onClick:T,children:Object(h.jsx)(et.a,{})}),Object(h.jsx)(Oe.a,{className:"title btn",sx:{color:"white",fontSize:"16px"},children:"\u5982\u89c6\u5f00\u53d1\u8005\u4e2d\u5fc3\u793a\u4f8b--live\u6001"}),Object(h.jsx)(Oe.a,{className:"share btn",sx:{color:"white"},onClick:function(){B(!0)},children:Object(h.jsx)(Ie.a,{})})]})}),Object(h.jsx)("div",{className:"gui__overlay",children:Object(h.jsxs)("div",{className:"scene-overlay",children:[Object(h.jsx)(ht,{open:L,onClose:function(){return B(!1)},shareConfig:{shareLink:"".concat(window.location.href.split("?")[0],"?userRole=audience&roomCode=").concat(t.roomCode,"&enterLive=true")}}),x&&Object(h.jsxs)("div",{className:"overlay-modal",children:[Object(h.jsx)(Oe.a,{className:"icon-close",onClick:function(){return O(!1)},children:Object(h.jsx)(et.a,{})}),Object(h.jsx)(Ye,{list:n,selfInfo:v,volumeLists:C,onForbiddenMicro:function(e){return y("CLOSE",e)},onKickUser:function(e){return w(e)},onNickNameChange:function(e){return b({nickname:e})}})]})]})}),Object(h.jsx)("div",{className:"gui__bottom",children:Object(h.jsx)("div",{className:"controls",children:Object(h.jsx)("div",{className:"collapsible-list",children:Object(h.jsxs)("div",{className:"collapsible-item",children:[Object(h.jsx)(Oe.a,{sx:{color:"white"},className:"members",onClick:function(){return O(!0)},children:Object(h.jsx)(Pe.a,{color:"primary",badgeContent:n&&n.length,children:Object(h.jsx)(Be.a,{})})}),s?Object(h.jsx)(Oe.a,{sx:{color:"white"},className:"greet",onClick:function(){return u(!1)},children:Object(h.jsx)(Ae.a,{})}):Object(h.jsxs)("div",{className:"greet",children:[Object(h.jsx)(we.a,{type:"text",placeholder:"\u8bf4\u70b9\u4ec0\u4e48\u5427",inputRef:l}),Object(h.jsx)(Oe.a,{sx:{color:"white"},onClick:function(){var e;d({event_id:"greet",message:null===(e=l.current)||void 0===e?void 0:e.value}),u(!0)},children:Object(h.jsx)(ze.a,{})})]}),Object(h.jsx)(Oe.a,{sx:{color:"white"},className:"micro",onClick:function(){return k(!v.micro_status)},children:(null===v||void 0===v?void 0:v.micro_status)?S?Object(h.jsx)(Ue.a,{color:"primary"}):Object(h.jsx)(Ue.a,{}):Object(h.jsx)(Je.a,{})}),Object(h.jsx)(Oe.a,{sx:{color:"white"},className:"close",onClick:T,children:Object(h.jsx)(xt.a,{})})]})})})})]})},Ct=(n(208),function(){var e=se()[1];return Object(h.jsx)("div",{className:"panel decoration-space-panel__bottom-user",children:Object(h.jsx)("div",{className:"bottom",children:Object(h.jsx)("div",{className:"controls",children:Object(h.jsx)("div",{className:"collapsible-list",children:Object(h.jsxs)("div",{className:"collapsible-item",children:[Object(h.jsx)("span",{children:"decoration -- user"}),Object(h.jsx)("button",{onClick:function(){return e({type:"default"})},children:"switch to default space"})]})})})})})}),Nt=(n(209),function(){var e=ne().liveExit,t=se()[1];return Object(h.jsx)("div",{className:"panel decoration-space-panel__bottom--live",children:Object(h.jsx)("div",{className:"bottom",children:Object(h.jsx)("div",{className:"controls",children:Object(h.jsx)("div",{className:"collapsible-list",children:Object(h.jsxs)("div",{className:"collapsible-item",children:[Object(h.jsx)("span",{children:"decoration -- live"}),Object(h.jsx)("button",{onClick:function(){return t({type:"default"})},children:"switch to default space"}),Object(h.jsx)("button",{onClick:function(){return e()},children:"exit live"})]})})})})})}),_t=function(){var e=se(),t=Object(o.a)(e,1)[0];switch(t.type){case"default":return function(){switch(t.mode){case"user":return Object(h.jsx)(Ee,{});case"live":return Object(h.jsx)(yt,{});case"tour":return Object(h.jsx)("div",{className:"panel default-space-panel__bottom--tour",children:"default -- tour"});default:return null}}();case"decoration":return function(){switch(t.mode){case"user":return Object(h.jsx)(Ct,{});case"live":return Object(h.jsx)(Nt,{});case"tour":return Object(h.jsx)("div",{className:"panel decoration-space-panel__bottom--tour",children:"decoration -- tour"});default:return null}}();default:return null}},St=n(42),Et=n(129),Rt=O.withSpace(g),It=P.useKeyframe,Lt=(P.useReadyState,P.useLiveEventCallback),Bt=P.useWebSocketEventCallback;var Tt=function(){var e=Math.ceil(Object(W.useBangsHeightState)()/window.devicePixelRatio),t=c.a.useState(),n=Object(o.a)(t,2),r=n[0],i=n[1],a=It("FiveState"),s=Object(o.a)(a,2),u=s[0],l=s[1],d=se(),f=Object(o.a)(d,2),j=f[0],v=f[1],b=Object(W.useJSBridgeAction)().closeLoading,p=ne().liveConnectFromUrl,m=ne().liveExit,x={position:"absolute",left:0,top:"".concat(e,"px"),width:"100%",height:"100%",pointerEvents:"none"};c.a.useEffect((function(){A?Promise.resolve().then(b).then((function(){return p(window.location.href)})).catch((function(e){pt.error(e.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")})):Promise.resolve().then((function(){return p(window.location.href)})).catch((function(e){pt.error(e.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")}))}),[]);var g=It("SpaceState"),w=Object(o.a)(g,1)[0],k=Object(G.b)();return c.a.useEffect((function(){w&&"live"===j.mode&&k(X(w))}),[w,k,j.mode]),Lt("readyKeyframeSync",(function(e){if(v({mode:"live"},!1),pt.success("\u8fdb\u5165\u5e26\u770b"),"{}"!==JSON.stringify(e))for(var t in e)if(e.hasOwnProperty(t))switch(t){case"FiveState":i(e[t]);break;default:return}})),Lt("kickOut",(function(){m().then((function(){be.message("\u4f60\u88ab\u8e22\u51fa\u5e26\u770b\u623f\u95f4")}))})),Lt("builtinEvent",(function(e){switch(e.action){case St.BuiltinActionType.RoomClose:console.log("__\u623f\u95f4\u5173\u95ed__"),v({mode:"user"}),pt.success("\u623f\u95f4\u5173\u95ed");break;case St.BuiltinActionType.UserStatus:console.log(e.data),console.log("builtinEvent: user state change");break;case St.BuiltinActionType.UserInfo:console.log("builtinEven: user info change");break;case St.BuiltinActionType.UserMicroStatus:console.log("builtinEvent: user micro change");break;case St.BuiltinActionType.UserPermission:console.log("builtinEvent: user permission change");break;default:console.log("builtinEvent: \u5176\u4ed6\u4e0d\u5728\u679a\u4e3e\u5185\u7684\u53d8\u66f4\uff01")}})),Bt("ws.error",(function(e){pt.error(e.error.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01"),console.log(e.error.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")})),c.a.useEffect((function(){"live"===j.mode&&u&&i(u)}),[u,j.mode]),Object(h.jsx)("section",{id:"app-container",children:Object(h.jsxs)("main",{children:[Object(h.jsx)("div",{id:"canvas-container",children:Object(h.jsx)(O,{spaceRootId:"default-canvas",work:Et.a,isMain:"default"===j.type,isSplit:j.split,state:r,onStateChange:function(e){"live"===j.mode&&l(e)},children:Object(h.jsx)(ge.a,{sx:x,children:Object(h.jsx)(Rt,{})})})}),Object(h.jsx)("div",{id:"gui",style:{paddingTop:"".concat(e,"px")},children:Object(h.jsx)(_t,{})})]})})},At=Object(K.a)({reducer:{space:Z,live:$}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ft,Ut=n(86);Ft=L?new V.JSBridgeMiniprogram:A?new F.JSBridgeApp:new J,a.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(Ut.JSBridgeContext.Provider,{value:Ft,children:Object(h.jsx)(G.a,{store:At,children:Object(h.jsx)(P.LiveProvider,{children:Object(h.jsx)(Tt,{})})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[210,1,2]]]);
//# sourceMappingURL=main.6bd68fdd.chunk.js.map