{"version":3,"sources":["gui/_ui/Toast/index.js","spaces/Space.jsx","attachments/Minimodel.jsx","utils/getQueryValueByName.js","utils/request.js","liveController/createLiveInstance.js","utils/deviceDetect.js","utils/browser.js","slices/liveSlice.js","slices/spaceSlice/index.js","userHooks/useLiveOperation.js","userHooks/useSpaceState.js","gui/_ui/Barrage/index.js","userHooks/useLiveBroadcast.js","userHooks/useVolumes.js","gui/_ui/EntryButton/index.js","gui/DefaultSpaceUserModeLayout/index.jsx","gui/DefaultSpaceLiveModeLayout/UserInfoPanel.js","gui/DefaultSpaceLiveModeLayout/LiveShareModal.js","gui/DefaultSpaceLiveModeLayout/index.jsx","gui/DecorationSpaceUserModeLayout/index.jsx","gui/DecorationSpaceLiveModeLayout/index.jsx","gui/index.jsx","App.js","app/store.js","serviceWorker.js","index.js"],"names":["noop","unmountStacks","__stackIndex","Toast","props","cls","classNames","className","children","__toastCreater","content","duration","onClose","restProps","stackIndex","container","document","createElement","body","appendChild","unmount","ReactDOM","unmountComponentAtNode","parentNode","removeChild","render","setTimeout","error","config","undefined","success","forEach","FiveContext","React","Space","initFive","data","state","five","initOptions","imageOptions","size","textureOptions","maxFps","play","poweredByRealsee","onlyRenderIfNeeds","floorplan","defaultFov","minFov","maxFov","defaultLatitude","defaultLongitude","minLatitude","maxLatitude","Math","PI","plugins","ModelViewPlugin","Five","fiveWrapDom","querySelector","spaceRootId","appendTo","console","log","load","parseWork","once","setState","on","userAction","onStateChange","JSON","parse","stringify","window","addEventListener","refresh","fetchWork","url","fetch","then","res","json","code","Object","keys","length","Error","status","catch","message","work","Promise","resolve","prevProps","prevState","snapshot","this","isSplit","isMain","containerCls","id","Provider","value","defaultProps","withSpace","CustomerComponent","resProps","Consumer","MiniModel","useState","hidden","setHidden","miniModeRef","useRef","useEffect","current","minimodel","height","clientHeight","width","clientWidth","mode","prevMode","onClick","style","display","justifyContent","alignItems","position","top","right","padding","background","ref","getQueryValueByName","param","queryArr","split","location","search","slice","queryPair","find","query","isNil","require","URI","getUserId","getRoomDetail","roomCreate","getTicket","getRtcSign","request","rtcInstance","name","params","arguments","requestName","type","relativeUrl","result","method","toUpperCase","userAgent","navigator","isMiniprogram","test","isIOS","isAndroid","isApp","JSBridgeBrowser","history","back","way","href","shareConfig","a","user_id","e","userInfo","userId","getVoiceSign","opts","voice_id","voiceId","room_id","roomId","sdkAppId","Number","voice_app_id","user_identifier","userSig","sign","VRWebViewRTC","jsBridge","JSBridgeMiniprogram","JSBridgeApp","BrowserRTC","liveInstance","createLiveReact","__debug__","rtc","liveSlice","createSlice","initialState","roomCode","reducers","setLiveStateToStore","action","assign","payload","extraReducers","builder","actions","getLiveInfo","live","spaceSlice","setSpaceStateToStore","getSpaceState","space","useConnect","useLiveAction","useLiveOperation","exit","connect","useJSBridgeAction","login","getUserInfo","dispatch","useDispatch","liveConnect","userRole","includes","getRoomInfo","ws_url","room_code","wsUrl","getWsUrl","force","liveExit","liveConnectFromUrl","create_user_role","create_user_id","room_link","user_role","ticket","useKeyframe","useSelfInfo","useSpaceState","spaceState","useSelector","updateState","setSpaceStateKeyframe","selfInfo","useCallback","nextState","permission","sync_frame","Barrage","topPositionValue","floor","random","__barrageCreater","aniDuration","innerWidth","useLiveEventCallback","useRTCEventCallback","EntryButton","text","entryFlag","DefaultSpaceUserModeLayout","closeWebView","liveUrlRef","IconButton","sx","color","pointerEvents","fontSize","Box","Input","placeholder","inputRef","EmoUserListPanel","styled","div","EmoUserListItem","UserInfoPanel","showEditNickNameBox","setShowEditNickNameBox","nickNameRef","createRef","list","map","item","index","micro_status","current_ws_online","extension","isSelf","canKickOut","change_other_status","volumeItem","volumeLists","isTalking","audioVolume","onForbiddenMicro","Paper","marginRight","autoFocus","defaultValue","nickname","online","onNickNameChange","onKickUser","marginLeft","renderUserList","LiveShareModal","qrcodeEl","setQrcodeEl","actionShare","Modal","open","evt","currentTarget","backgroundColor","Popover","Boolean","anchorEl","anchorOrigin","vertical","horizontal","Typography","p","shareLink","level","includeMargin","InputBase","disabled","copy","useUserList","DefaultSpaceLiveModeLayout","liveInfo","currentUserList","showGreetBtn","setShowGreetBtn","greetMsgRef","liveBroadcast","broadcast","evtMsg","event_id","useLiveBroadcast","setSelfInfo","showUserInfoPanel","setShowUserInfoPanel","kick","toggleMicro","forbidMicro","userVolumes","useVolumes","setIsTalking","showShareModal","setShowShareModal","handleClose","newNickName","Badge","badgeContent","DecorationSpaceUserMode","setSpaceState","DecorationSpaceLiveModeLayout","Gui","defaultSpacePanel","decorationSpacePanel","MinimodelWithSpace","Minimodel","useReadyState","useWebSocketEventCallback","App","bandHeight","ceil","useBangsHeightState","devicePixelRatio","defaultFiveState","setDefaultFiveState","fiveStateKeyframe","setFiveStateKeyframe","closeLoading","WrapStyle","left","spaceStateKeyframe","lastKeyframe","key","hasOwnProperty","builtinMsg","BuiltinActionType","RoomClose","UserStatus","UserInfo","UserMicroStatus","UserPermission","wsError","paddingTop","store","configureStore","reducer","spaceReducer","liveReducer","hostname","match","StrictMode","LiveProvider","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.3440beb7.chunk.js","sourcesContent":["import React from 'react'\nimport ReactDOM from 'react-dom'\nimport PropTypes from 'prop-types'\nimport './index.css'\nimport classNames from 'classnames'\n\nfunction noop () {}\n\nconst unmountStacks = []\nlet __stackIndex = -1\n\nconst Toast = props => {\n  const cls = classNames('realsee-design-toast', props.className)\n  \n  return (\n      <div className={cls}>\n        <div className=\"react-toast-contain\">\n          {props.children}\n        </div>\n      </div>\n  )\n}\n\nToast.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  className: PropTypes.string\n}\n\nconst __toastCreater = ({ content, duration = 1.5, onClose = noop, ...restProps }) => {\n  const stackIndex = ++__stackIndex\n  const container = document.createElement('div')\n  document.body.appendChild(container)\n  let unmount = () => {\n    unmount = noop\n    unmountStacks[stackIndex] = null\n    ReactDOM.unmountComponentAtNode(container)\n    container.parentNode.removeChild(container)\n    onClose()\n  }\n\n  unmountStacks[stackIndex] = unmount\n  \n  ReactDOM.render(<Toast {...restProps}>{content}</Toast>, container)\n\n  if (duration !== 0) {\n    setTimeout(unmount, duration * 1000)\n  }\n  return unmount\n}\n\nToast.error = (...args) => {\n  const config = {\n    content: args[0],\n    className: 'react-toast-error'\n  }\n  if (args[1] !== undefined) {\n    config.duration = args[1]\n  }\n  if (args[2] !== undefined) {\n    config.onClose = args[2]\n  }\n  return __toastCreater(config)\n}\n\nToast.success = (...args) => {\n  const config = {\n    content: args[0],\n    className: 'react-toast-success'\n  }\n  if (args[1] !== undefined) {\n    config.duration = args[1]\n  }\n  if (args[2] !== undefined) {\n    config.onClose = args[2]\n  }\n  return __toastCreater(config)\n}\n\nToast.unmount = () => {\n  unmountStacks.forEach(unmount => {\n    unmount && unmount()\n  })\n}\n\nexport default Toast\n","import * as React from 'react'\nimport { Five, parseWork } from '@realsee/five'\nimport './Space.css'\nimport PropTypes from \"prop-types\";\nimport classNames from \"classnames\";\nimport ModelViewPlugin from '@ke/dnalogel/plugins/ModelViewPlugin'\nimport Toast from '../gui/_ui/Toast'\n\nconst FiveContext = React.createContext(null)\n\nfunction withFive(CustomerComponent) {\n\treturn function WrappedComponent (props) {\n\t\tconst { ...resProps } = props\n\t\treturn <FiveContext.Consumer>\n\t\t\t{ five => five ? <CustomerComponent five={five} {...resProps}/> : <div className=\"null\"></div> }\n\t\t</FiveContext.Consumer>\n\t}\n}\n\nclass Space extends React.Component {\n\tconstructor (props) {\n\t\t\n\t\tsuper(props);\n\t\t\n\t\tthis.state = {\n\t\t\tfive: null,\n\t\t\twork: null\n\t\t};\n\t\t\n\t}\n\t\n\tcomponentDidMount () {\n\t\tPromise.resolve()\n\t\t\t.then(() => this.fetchWork(this.props.url))\n\t\t\t.then(data => {\n\t\t\t\tthis.setState({work: data})\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tToast.error(error.message)\n\t\t\t})\n\t}\n\t\n\tcomponentDidUpdate (prevProps, prevState, snapshot) {\n\t\tif (prevState.work !== this.state.work) {\n\t\t\tthis.initFive(this.state.work)\n\t\t}\n\t\tif (prevProps.state !== this.props.state && this.state.five) {\n\t\t\tthis.state.five.setState(this.props.state, false, false)\n\t\t}\n\t\tif (prevProps.isSplit !== this.props.isSplit && this.state.five) {\n\t\t\tthis.state.five.refresh()\n\t\t}\n\t}\n\t\n\tinitFive = (data) => {\n\t\tif (this.state.five) return\n\t\tconst initOptions = {\n\t\t\timageOptions: { size: 1024 },\n\t\t\ttextureOptions: { size: 512 },\n\t\t\tmaxFps: 70,\n\t\t\tplay: true,\n\t\t\tpoweredByRealsee: true,\n\t\t\tonlyRenderIfNeeds: true,\n\t\t\tfloorplan: {\n\t\t\t\tdefaultFov: 80,\n\t\t\t\tminFov: 60,\n\t\t\t\tmaxFov: 120,\n\t\t\t\tdefaultLatitude: 0,\n\t\t\t\tdefaultLongitude: 0,\n\t\t\t\tminLatitude: 0,\n\t\t\t\tmaxLatitude: Math.PI / 2\n\t\t\t},\n\t\t\tplugins: [[ModelViewPlugin, 'minimodel']]\n\t\t}\n\t\tconst five = new Five(initOptions)\n\t\tconst fiveWrapDom = document.querySelector(`#${this.props.spaceRootId}`)\n\t\tfive.appendTo(fiveWrapDom)\n\t\tconsole.log(data)\n\t\t// five.load(data)\n\t\tfive.load(parseWork(data))\n\t\t\n\t\tfive.once('modelLoaded', () => {\n\t\t\tthis.setState({five: five})\n\t\t})\n\t\tfive.on('stateChange', (state, userAction) => {\n\t\t\tif(!userAction) return\n\t\t\tthis.props.onStateChange(JSON.parse(JSON.stringify(state)))\n\t\t})\n\t\t\n\t\twindow.addEventListener('resize', () => five.refresh(), false)\n\t}\n\t\n\tcomponentWillUnmount () {\n\t\t// this.state.five.dispose()\n\t}\n\t\n\tfetchWork = (url) => {\n\t\treturn fetch(url)\n\t\t\t.then(res => res.json())\n\t\t\t.then(res => {\n\t\t\t\tif (res.code !== 0 || !Object.keys(res.data).length) {\n\t\t\t\t\tthrow Error(res.status)\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn res.data\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tthrow Error(error.message || 'work数据获取失败')\n\t\t\t})\n\t}\n\t\n\trender () {\n\t\tconst { children, spaceRootId, isMain, isSplit } = this.props\n\t\tconst containerCls = classNames(\"vr-container\", {'main': isMain}, {'split': isSplit})\n\t\t\n\t\treturn (\n\t\t\t<div id={spaceRootId} className={containerCls}>\n\t\t\t\t<FiveContext.Provider value={this.state.five}>\n\t\t\t\t\t{children}\n\t\t\t\t</FiveContext.Provider>\n\t\t\t</div>\n\t\t);\n\t}\n}\nSpace.propTypes = {\n\tchildren: PropTypes.any,\n\tspaceRootId: PropTypes.string.isRequired,\n\turl: PropTypes.string.isRequired,\n\tisMain: PropTypes.bool.isRequired,\n\tisSplit: PropTypes.bool.isRequired,\n\tstate: PropTypes.any,\n\tonStateChange: PropTypes.func\n};\n\nSpace.defaultProps = {\n\tspaceRootId: '',\n\turl: ''\n}\n\nSpace.withSpace = withFive\n\nexport default Space;\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport './Minimodel.css'\n\nfunction MiniModel (props) {\n\tconst [hidden, setHidden] = React.useState(false)\n\tconst five = props.five\n\tconst miniModeRef = React.useRef(null)\n\t\n\tconst BoxStyle = {\n\t\tdisplay: 'flex',\n\t\tjustifyContent: 'center',\n\t\talignItems: 'center',\n\t\tposition: \"absolute\",\n\t\ttop: '40px',\n\t\tright: '20px',\n\t\tpadding: '10px',\n\t\twidth: '75px',\n\t\theight: '100px',\n\t\tbackground: 'linear-gradient(transparent, rgba(0, 0, 0, .2))',\n\t}\n\t\n\tReact.useEffect(() => {\n\t\tif (!miniModeRef.current) return\n\t\tconst minimodel = five.plugins.minimodel\n\t\tconst height = miniModeRef.current.clientHeight\n\t\tconst width = miniModeRef.current.clientWidth\n\t\tminimodel.appendTo(miniModeRef.current, { height, width })\n\t}, [five.plugins.minimodel])\n\t\n\tfive.on('modeChange', (mode, prevMode) => {\n\t\tif (mode === 'Floorplan') {\n\t\t\treturn setHidden(true)\n\t\t}\n\t\tsetHidden(false)\n\t})\n\t\n\t\n\treturn (\n\t\t<div className={classNames(\"minimodel-wrap\", {'minimodel-wrap__hidden': hidden})}>\n\t\t\t<div\n\t\t\t\tonClick={() => five.setState({ mode: \"Floorplan\" })}\n\t\t\t\tstyle={{...BoxStyle}}\n\t\t\t\tref={miniModeRef}\n\t\t\t/>\n\t\t</div>\n\t)\n}\n\nexport default MiniModel\n","/**\n * 从 url 中获取指定参数的值\n * */\nconst getQueryValueByName = (param, url) => {\n    let queryArr\n    if (!url) queryArr = window.location.search?.slice(1)?.split('&')\n    else queryArr = url.split('?')[1]?.split('&')\n    if(!queryArr) return ''\n    const queryPair = queryArr.find(query => query.split('=')[0] === param);\n    return queryPair?.split('=')[1] || ''\n}\n\nexport default getQueryValueByName\n","/**\n * 简易的请求封装\n * pro版本：支持并发请求、promise封装\n * */\nconst isNil = require('lodash/isNil')\n\nconst URI = {\n    getUserId: 'get:/demo/auth/login',\n    getRoomDetail: 'post:/demo/live/room/detail',\n    roomCreate: 'post:/demo/live/room/create',\n    getTicket: 'post:/demo/live/apply/ticket',\n    getRtcSign: 'post:/demo/live/voice/sign'\n}\n\n/**\n * @param name: 请求名称\n * @param params: 请求参数\n * */\nfunction request (name, params) {\n    if (arguments.length === 2 && typeof params === 'function') {\n        params = undefined\n    }\n    const requestName = name\n    if (isNil(URI[requestName])) throw new Error('requestName is not defined')\n    const [type, relativeUrl] = (URI[requestName] || requestName).split(':')\n    // const url = `https://test1-ka-vr-demo-developer.realsee.com${relativeUrl}`\n    const url = `https://ka-vr-demo-developer.realsee.com${relativeUrl}`\n    const result = fetch(url, {\n        body: JSON.stringify(params),\n        method: type?.toUpperCase()\n    })\n        .then(res => res.json())\n        .then(res => {\n            if (res.code !== 0 || !Object.keys(res.data).length) {\n                throw Error(res.status)\n            }\n            return res.data\n        })\n    return result\n}\n\nexport default request\n","/**\n * live实例初始化\n * */\nimport { createLiveReact } from \"@realsee/live\";\nimport request from \"../utils/request\";\nimport { isMiniprogram, isApp } from '../utils/deviceDetect'\nimport {JSBridgeApp} from '@realsee/jsbridge-x/lib/app'\nimport { VRWebViewRTC } from \"@realsee/live/lib/RTC/VRWebViewRTC\";\nimport { BrowserRTC } from \"@realsee/live/lib/RTC/BrowserRTC\"\nimport { JSBridgeBrowser } from '../utils/browser'\nimport { JSBridgeMiniprogram } from '@realsee/jsbridge-x/lib/miniprogram'\n\nconst getVoiceSign = async (opts) => {\n    return await request('getRtcSign', {\n        voice_id: opts.voiceId,\n        room_id: opts.roomId,\n        user_id: opts.userId\n    }).then((res) => {\n        return {\n            sdkAppId: Number(res.voice_app_id),\n            userId: res.user_identifier,\n            userSig: res.sign\n        }\n    }).catch((error) => {\n        throw Error(error.message)\n    })\n}\n\nlet rtcInstance\nif (isMiniprogram) {\n    rtcInstance = new VRWebViewRTC({jsBridge: new JSBridgeMiniprogram(), getVoiceSign})\n}\nelse if(isApp) {\n    rtcInstance = new VRWebViewRTC({jsBridge: new JSBridgeApp(), getVoiceSign})\n}\nelse {\n    rtcInstance = new BrowserRTC({jsBridge: new JSBridgeBrowser(), getVoiceSign})\n}\n\n\nconst liveInstance = createLiveReact({\n    __debug__: true,\n    rtc: rtcInstance\n})\n\nexport default liveInstance\n\n\n","/**\n * 检测当前用户使用的设备：ios端？Android端？微信小程序？web？\n * */\n\nconst userAgent = window.navigator.userAgent\n\nconst isMiniprogram = /micromessenger/i.test(userAgent) && /miniprogram/i.test(userAgent)\n\nconst isIOS = /iphone|ipad/i.test(userAgent)\n\nconst isAndroid = /android/i.test(userAgent)\n\nconst isApp = isIOS || isAndroid\n\nexport {\n    isMiniprogram,\n    isIOS,\n    isAndroid,\n    isApp\n}\n","// import JSBridgeProtocol from '@ke/jsbridge-x/lib/typings/JSBridgeProtocol'\nimport request from \"./request\";\n\nexport class JSBridgeBrowser {\n\t\n\t// constructor () {\n\t// \tsuper();\n\t// }\n\t\n\tcloseWebView() {\n\t\treturn window.history.back()\n\t}\n\t\n\t// way表示新起还是覆盖，先支持新起\n\topenWebView(url, way) {\n\t\treturn window.location.href(url)\n\t}\n\t\n\tactionShare(shareConfig) {\n\t\treturn () => {}\n\t}\n\t\n\tasync getUserInfo() {\n\t\tconst res = await request('getUserId')\n\t\t\t.then(data => {\n\t\t\t\treturn data.user_id\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\treturn e.message\n\t\t\t})\n\t\tconst userInfo = {\n\t\t\tuserId: res\n\t\t}\n\t\t\n\t\treturn [userInfo,]\n\t}\n\t\n\tasync login() {\n\t\tconst res = await request('getUserId')\n\t\t\t.then(data => {\n\t\t\t\treturn data.user_id\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\treturn e.message\n\t\t\t})\n\t\t\n\t\treturn res\n\t}\n\t\n\tasync logout() {\n\t\treturn {}\n\t}\n\t\n\tasync closeLoading() {\n\t\treturn {}\n\t}\n\t\n\tasync getBangsHeight() {\n\t\treturn 0\n\t}\n}\n","import {createSlice} from \"@reduxjs/toolkit\";\n\nconst initialState = {\n\tstate: {\n\t\troomCode: ''\n\t}\n}\n\nexport const liveSlice = createSlice({\n\tname: 'live',\n\tinitialState,\n\treducers: {\n\t\t// state的集合体\n\t\tsetLiveStateToStore: (state, action) => {\n\t\t\tstate.state = Object.assign({}, state.state, action.payload)\n\t\t}\n\t},\n\textraReducers: (builder => {})\n})\n\nexport const {\n\tsetLiveStateToStore\n} = liveSlice.actions\n\nexport const getLiveInfo = (state) => state.live.state\n\nexport default liveSlice.reducer\n","import {createSlice} from \"@reduxjs/toolkit\";\n\nconst initialState = {\n    state: {\n        type: 'default',// 'default' | 'decoration'\n        mode: 'user',// 'user' | 'live' | 'tour'\n        split: false\n    }\n}\n\nexport const spaceSlice = createSlice({\n    name: 'space',\n    initialState,\n    reducers: {\n        // state的集合体\n        setSpaceStateToStore: (state, action) => {\n            state.state = Object.assign({}, state.state, action.payload)\n        }\n    },\n    extraReducers: (builder => {})\n})\n\nexport const {\n    setSpaceStateToStore\n} = spaceSlice.actions\n\nexport const getSpaceState = (state) => state.space.state\n\nexport default spaceSlice.reducer\n","import getQueryValueByName from \"../utils/getQueryValueByName\";\nimport liveInstance from '../liveController/createLiveInstance'\nimport request from \"../utils/request\";\nimport { useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport { setLiveStateToStore } from \"../slices/liveSlice\";\nimport { useDispatch } from \"react-redux\";\nimport { isApp } from '../utils/deviceDetect'\nimport { getSpaceState, setSpaceStateToStore } from '../slices/spaceSlice'\n\nconst {\n\tuseConnect,\n\tuseLiveAction\n} = liveInstance\n\nfunction useLiveOperation () {\n \tconst { exit } = useLiveAction()\n\tconst connect = useConnect()\n\tconst { login, getUserInfo } = useJSBridgeAction()\n\tconst dispatch = useDispatch()\n\t\n\tconst getUserId = async () => {\n\t\tif (isApp) { await login() }\n\t\tconst [userInfo, error] = await getUserInfo()\n\t\tif(!userInfo) {\n\t\t\tthrow Error(error?.message || '身份信息获取失败，请重试')\n\t\t}\n\t\treturn userInfo.userId\n\t}\n\t\n\tconst liveConnect = async () => {\n\t\tconst userRole = window.location.search.includes('userRole=audience') ? 'audience' : 'anchor'\n\t\tconst userId = await getUserId()\n\t\tlet wsUrl, roomCode\n\t\tif (userRole === 'anchor') {\n\t\t\tconst [ws_url, room_code] = await getRoomInfo(userId, userRole)\n\t\t\twsUrl = ws_url\n\t\t\troomCode = room_code\n\t\t}\n\t\telse {\n\t\t\troomCode = getQueryValueByName('roomCode')\n\t\t\twsUrl = await getWsUrl(roomCode)\n\t\t}\n\t\treturn Promise.resolve().then(() => {\n\t\t\tdispatch(setLiveStateToStore({roomCode: roomCode}))\n\t\t\tconnect({\n\t\t\t\tforce: true,\n\t\t\t\turl: wsUrl,\n\t\t\t\tgetTicket: async  () => {\n\t\t\t\t\treturn await getTicket({ roomCode, userId, userRole })\n\t\t\t\t}\n\t\t\t})\n\t\t}).catch(error => console.error(error.message))\n\t}\n\t\n\tconst liveConnectFromUrl = async (url) => {\n \t\tconst userRole = getQueryValueByName('userRole', url)\n\t\tconst roomCode = getQueryValueByName('roomCode', url)\n\t\tconst enterLive = getQueryValueByName('enterLive', url)\n\t\tif (!enterLive || !roomCode) return\n\t\tconst userId = await getUserId()\n\t\tconst wsUrl = await getWsUrl(roomCode)\n\t\treturn Promise.resolve().then(() => {\n\t\t\tdispatch(setLiveStateToStore({roomCode: roomCode}))\n\t\t\tconnect({\n\t\t\t\tforce: true, // 不传此参数有bug，已提阳哥\n\t\t\t\turl: wsUrl,\n\t\t\t\tgetTicket: async  () => {\n\t\t\t\t\treturn await getTicket({ roomCode, userId, userRole })\n\t\t\t\t}\n\t\t\t})\n\t\t}).catch(error => console.error(error.message))\n\t}\n\t\n\t// 应该有个callback\n\tconst liveExit = () => {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => exit())\n\t\t\t.then((res) => {\n\t\t\t\tif (res) {\n\t\t\t\t\tdispatch(setSpaceStateToStore({mode: 'user'}))\n\t\t\t\t\tdispatch(setLiveStateToStore({roomCode: ''}))\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthrow Error('退出带看失败')\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error.message || '退出带看失败')\n\t\t\t})\n\t}\n\t\n\treturn {\n\t\tliveConnect,\n\t\tliveExit,\n\t\tliveConnectFromUrl\n\t}\n}\n\nexport { useLiveOperation };\n\n// 请求房间信息，包括：ws链接，房间号\nexport const getRoomInfo = async (userId, userRole) => {\n\treturn request('roomCreate', {\n\t\tcreate_user_role: userRole,\n\t\tcreate_user_id: userId\n\t}).then((data) => {\n\t\treturn [data.room_link, data.room_id]\n\t}).catch((error) => {\n\t\tthrow Error(error.message || '请求带看房间信息失败')\n\t})\n}\n\n// 查询ws链接\nexport const getWsUrl = async (roomCode) => {\n\treturn request('getRoomDetail', {\n\t\troom_id: roomCode\n\t})\n\t\t.then((data) => {\n\t\t\treturn data.room_link\n\t\t})\n\t\t.catch((error) => {\n\t\t\tthrow Error(error.message || '查询带看房间信息失败')\n\t\t})\n}\n\n// 请求带看门票\nconst getTicket = async ({roomCode, userId, userRole}) => {\n\treturn request('getTicket', {\n\t\troom_id: roomCode,\n\t\tuser_id: userId,\n\t\tuser_role: userRole\n\t})\n\t\t.then((data) => {\n\t\t\treturn data.ticket\n\t\t})\n\t\t.catch((error) => {\n\t\t\tthrow Error(error.message || '获取带看门票失败')\n\t\t})\n}\n","import React from 'react';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getSpaceState, setSpaceStateToStore } from '../slices/spaceSlice'\nimport liveInstance from \"../liveController/createLiveInstance\";\n\nconst { useKeyframe, useSelfInfo } = liveInstance\n// const { useKeyframe } = liveInstance\n\nfunction useSpaceState () {\n\tconst spaceState = useSelector(getSpaceState)\n\tconst dispatch = useDispatch()\n\tconst [state, updateState] = React.useState(spaceState)\n\t// const [spaceStateKeyframe, setSpaceStateKeyframe] = useKeyframe('SpaceState')\n\tconst [, setSpaceStateKeyframe] = useKeyframe('SpaceState')\n\tconst [selfInfo] = useSelfInfo()\n\t\n\tconst setState = React.useCallback((\n\t\tstate,\n\t\tuserAction = true\n\t) => {\n\t\tconst nextState = typeof state === 'function' ? state() : state\n\t\t// 在此处理live发送逻辑\n\t\tif (userAction && spaceState.mode === 'live' && selfInfo?.permission?.sync_frame) { // TODO：在此拿 userInfo 做权限相关校验，会导致update逻辑阻塞 bug\n\t\t\tsetSpaceStateKeyframe(nextState)\n\t\t}\n\t\t\n\t\tdispatch(setSpaceStateToStore(nextState))\n\t\t\n\t}, [dispatch, setSpaceStateKeyframe, spaceState.mode, selfInfo])\n\t\n\tReact.useEffect(() => {\n\t\treturn updateState(spaceState)\n\t}, [spaceState])\n\n\treturn [state, setState]\n}\n\nexport { useSpaceState } ;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport PropTypes from 'prop-types'\nimport './index.css'\nimport classNames from 'classnames'\n\nfunction noop () {}\n\nconst unmountStacks = []\nlet __stackIndex = -1\n\nconst Barrage = props => {\n  const cls = classNames('realsee-design-barrage', props.className)\n  let topPositionValue = Math.floor(Math.random() * 100)\n  if (topPositionValue < 20 || 80 < topPositionValue ) topPositionValue = 50\n  \n  return (\n      <div className={cls} style={{\n        top: `${topPositionValue}%`\n      }}>\n        <div className=\"react-barrage-contain\">\n          {props.children}\n        </div>\n      </div>\n  )\n}\n\nBarrage.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  className: PropTypes.string\n}\n\nconst __barrageCreater = ({ content, duration = 1, onClose = noop, ...restProps }) => {\n  const stackIndex = ++__stackIndex\n  const container = document.createElement('div')\n  document.body.appendChild(container)\n  let unmount = () => {\n    unmount = noop\n    unmountStacks[stackIndex] = null\n    ReactDOM.unmountComponentAtNode(container)\n    container.parentNode.removeChild(container)\n    onClose()\n  }\n\n  unmountStacks[stackIndex] = unmount\n  \n  ReactDOM.render(<Barrage {...restProps}>{content}</Barrage>, container)\n\n  if (duration !== 0) {\n    const aniDuration = window.innerWidth > 768 ? 2 : duration\n    setTimeout(unmount, aniDuration * 10000)\n  }\n  return unmount\n}\n\n/**\n * content: string\n * duration: number\n * */\n\nBarrage.message = (...args) => {\n  const config = {\n    content: args[0],\n    className: 'react-barrage'\n  }\n  if (args[1] !== undefined) {\n    config.duration = args[1]\n  }\n  if (args[2] !== undefined) {\n    config.onClose = args[2]\n  }\n  \n  return __barrageCreater(config)\n  \n}\n\n\nBarrage.unmount = () => {\n  unmountStacks.forEach(unmount => {\n    unmount && unmount()\n  })\n}\n\nexport default Barrage\n","import React from 'react'\nimport liveInstance from \"../liveController/createLiveInstance\";\nimport Barrage from \"../gui/_ui/Barrage\";\n\nconst {\n\tuseSelfInfo,\n\tuseLiveAction,\n\tuseLiveEventCallback\n} = liveInstance\n\n// function useLiveBroadcast (evtId, greetMsg, toUserIds, timeout) {\nfunction useLiveBroadcast (params) {\n\tconst [selfInfo] = useSelfInfo()\n\tconst { broadcast } = useLiveAction()\n\t\n\tuseLiveEventCallback(\"broadcast\", (evtMsg) => {\n\t\tswitch (evtMsg.event_id) {\n\t\t\tcase 'greet':\n\t\t\t\tBarrage.message(evtMsg.data.message)\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tconsole.log('___broadcast__bug__')\n\t\t}\n\t})\n\n\treturn React.useCallback((params) => {\n\t\tbroadcast({\n\t\t\tevent_id: params.event_id,\n\t\t\tdata: {\n\t\t\t\tmessage: `${selfInfo?.extension?.nickname || selfInfo?.id}说：${params.message}`\n\t\t\t}\n\t\t}, [], 0)\n\t}, [params, selfInfo])\n}\n\nexport { useLiveBroadcast }\n","import React from 'react';\nimport liveInstance from \"../liveController/createLiveInstance\";\n\nconst {\n\tuseRTCEventCallback\n} = liveInstance\n\nfunction useVolumes (props) {\n\tconst [state, updateState] = React.useState([])\n\t\n\tuseRTCEventCallback('userVolumes', userVolumes => {\n\t\t// console.log('音量： ', userVolumes)\n\t\tupdateState(userVolumes)\n\t})\n\t\n\treturn state\n}\n\nexport { useVolumes } ;\n","import * as React from 'react';\nimport './index.css'\n\nfunction EntryButton (props) {\n\treturn <div className='btn-wrap' onClick={props.onClick}>\n\t\t{props.text}\n\t</div>\n\t\n};\n\nexport default EntryButton;\n","import * as React from 'react';\nimport './index.css'\nimport { useLiveOperation } from \"../../userHooks\";\nimport { useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport IconButton from '@mui/material/IconButton'\nimport CloseIcon from '@mui/icons-material/Close';\nimport { Box, Input } from \"@mui/material\";\nimport CallIcon from '@mui/icons-material/Call';\nimport EntryButton from \"../_ui/EntryButton\";\n\nconst entryFlag = window.location.search.includes('userRole=audience')\n\nconst DefaultSpaceUserModeLayout = () => {\n    const { liveConnect, liveConnectFromUrl } = useLiveOperation()\n    const { closeWebView } = useJSBridgeAction()\n    const liveUrlRef = React.createRef()\n    \n    function handleClose() {\n        Promise.resolve().then(() => closeWebView())\n    }\n    \n    function onLiveOpen() {\n        if(!liveUrlRef.current.value) {\n            console.log('输入有误')\n            return\n        }\n        liveConnectFromUrl(liveUrlRef.current.value)\n    }\n\n    return <div className='default__user'>\n        <div className=\"gui__top\" >\n            <div className=\"gui__top--bar\">\n                <IconButton onClick={handleClose} className=\"close btn\" sx={{color: 'white', pointerEvents: 'auto'}}><CloseIcon/></IconButton>\n                <IconButton className=\"title btn\" sx={{color: 'white', fontSize: '16px'}}>如视开发者中心示例--user态</IconButton>\n                <IconButton></IconButton>\n            </div>\n        </div>\n        <div className=\"gui__overlay\">\n            {/* 一些面板 */}\n            <div className=\"scene-overlay\">\n            \n            </div>\n        </div>\n        <div className=\"gui__bottom\">\n            <div className='controls'>\n             <div className='collapsible-list'>\n                 <div className='collapsible-item'>\n                     {\n                         entryFlag\n                             ? <Box>\n                                 <Input type=\"text\" placeholder=\"请输入带看链接\" inputRef={liveUrlRef} />\n                                 <IconButton\n                                     sx={{color: 'white'}}\n                                     onClick={onLiveOpen}\n                                 ><CallIcon /></IconButton>\n                             </Box>\n                             : <Box\n                                 className='live--open'\n                                 onClick={() => liveConnect()}\n                                 sx={{display: 'flex', justifyContent: 'center'}}\n                             ><EntryButton text='进入带看'/></Box>\n                     }\n                 </div>\n             </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DefaultSpaceUserModeLayout;\n","// 参与人员列表面板\nimport styled from \"@emotion/styled\";\nimport React from \"react\";\nimport { Input, Paper } from \"@mui/material\";\nimport classNames from \"classnames\";\nimport PersonRemoveIcon from '@mui/icons-material/PersonRemove';\nimport MicIcon from '@mui/icons-material/Mic';\nimport MicOffIcon from \"@mui/icons-material/MicOff\";\nimport MicNoneIcon from '@mui/icons-material/MicNone'\n\nconst EmoUserListPanel = styled.div`\n  max-height: 200px;\n  display: flex;\n  flex-flow: column;\n  overflow-y: auto;\n  font-size: 12px;\n  pointer-events: auto;\n`\nconst EmoUserListItem = styled.div`\n  display: flex;\n  flex-flow: row wrap;\n  align-items: center;\n  padding: 4px 0;\n  pointer-events: auto;\n  \n  > span {\n    display: flex;\n  }\n  \n  & > .role {\n    padding-left: 4px;\n    padding-right: 4px;\n    border-radius: 2px;\n    background-color: #5a6268;\n    color: white;\n  }\n\n  & > .self-tag {\n    color: darkorange;\n  }\n  \n  & > .nickname {\n    color: white;\n  }\n\n  & > .nickname.self-name {\n    color: greenyellow;\n  }\n\n  & > .btn {\n    color: darkorange;\n    cursor: pointer;\n  }\n\n  & > .edit-btn-groups {\n    display: inline-flex;\n  }\n\n  & > .status {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background-color: #5a6268;\n\n    &.online {\n      background-color: aquamarine;\n    }\n  }\n`\n\nconst UserInfoPanel = (props) => {\n\tconst [showEditNickNameBox, setShowEditNickNameBox] = React.useState(false)\n\tconst nickNameRef = React.createRef()\n\t\n\t//  麦克风开关还未更新，先禁用。\n\tconst renderUserList = (userInfo, index) => {\n\t\tconst { id, micro_status, current_ws_online, permission, extension, user_role } = userInfo\n\t\tconst isSelf = id === props.selfInfo.id\n\t\tconst canKickOut = !isSelf && current_ws_online && permission?.change_other_status\n\t\tconst volumeItem = props.volumeLists.find(item => id === item.id)\n\t\tconst isTalking = !!(volumeItem && volumeItem.audioVolume >= 10)\n\t\tlet userRole = ''\n\t\tif(user_role === 'anchor') userRole = '主持人'\n\t\telse if (user_role === 'audience') userRole = '观众'\n\t\t\n\t\treturn (\n\t\t\t<EmoUserListItem className=\"user-list-item\" key={index}>\n\t\t\t\t<span onClick={() => props.onForbiddenMicro(id)}>\n                    <Paper sx={{\n\t                    display: 'flex',\n\t                    marginRight: '2px'\n                    }}>\n                        { isTalking ? <MicIcon fontSize=\"small\" color='primary'/> : micro_status ? <MicNoneIcon fontSize=\"small\" /> : <MicOffIcon fontSize=\"small\" /> }\n                    </Paper>\n                </span>\n\t\t\t\t<span className='role'>{userRole}</span>\n\t\t\t\t{isSelf && <span className=\"self-tag\">[自己]</span>}\n\t\t\t\t{isSelf && showEditNickNameBox\n\t\t\t\t\t? <Input className='nickname'\n                        autoFocus={true}\n                        defaultValue=''\n                        type='text'\n                        inputRef={nickNameRef} />\n\t\t\t\t\t: <span className={classNames('nickname', {\"self-name\": isSelf})}>{extension?.nickname || id}</span>}\n\t\t\t\t<span className={classNames('status', {online: current_ws_online})} />\n\t\t\t\t{isSelf && !showEditNickNameBox && <span onClick={() => setShowEditNickNameBox(true)} className=\"edit-nickname btn\">[修改昵称]</span>}\n\t\t\t\t{isSelf && showEditNickNameBox && <span className='edit-btn-groups btn'>\n\t\t\t                <span onClick={() => {\n\t\t\t\t                setShowEditNickNameBox(false)\n\t\t\t\t                props.onNickNameChange(nickNameRef.current?.value)\n\t\t\t                }} className=\"submit-nickname btn\">[提交修改]</span>\n\t\t\t                <span onClick={() => setShowEditNickNameBox(false)} className=\"exit-edit-nickname btn\">[退出]</span>\n\t\t                </span>}\n\t\t\t\t{canKickOut && <span onClick={() => props.onKickUser(id)}>\n                    <Paper sx={{ display: 'flex', marginLeft: '2px' }}>\n                        <PersonRemoveIcon fontSize=\"small\"/>\n                    </Paper>\n                </span>}\n\t\t\t</EmoUserListItem>\n\t\t)\n\t}\n\t\n\treturn (\n\t\t<div className=\"user-info\">\n\t\t\t<EmoUserListPanel className=\"user-list-panel\">\n\t\t\t\t{props.list && props.list.map((item, index) => renderUserList(item, index))}\n\t\t\t</EmoUserListPanel>\n\t\t</div>\n\t)\n}\n\nexport default UserInfoPanel\n","import React from 'react';\nimport { Box, IconButton, InputBase, Modal, Popover, Typography } from \"@mui/material\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport QrCodeScannerIcon from \"@mui/icons-material/QrCodeScanner\";\nimport QRCode from \"qrcode.react\";\nimport copy from \"copy-to-clipboard\";\nimport LinkIcon from '@mui/icons-material/Link';\nimport { isMiniprogram } from \"../../utils/deviceDetect\";\nimport { useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport Toast from '../_ui/Toast'\n\nfunction LiveShareModal (props) {\n\tconst [qrcodeEl, setQrcodeEl] = React.useState(null)\n\tconst [miniprogramEl, setMiniprogramEl] = React.useState(null)\n\tconst { actionShare } = useJSBridgeAction()\n\t\n\tconst handleQrcodeOpen = (evt) => {\n\t\tsetQrcodeEl(evt.currentTarget)\n\t}\n\t\n\tconst handleQrcodeClose = () => {\n\t\tsetQrcodeEl(null)\n\t}\n\t\n\tconst handleMiniprogramOpen = (evt) => {\n\t\tif (!isMiniprogram) return\n\t\tactionShare(props.shareConfig)\n\t\tsetMiniprogramEl(evt.currentTarget)\n\t}\n\t\n\tconst handleMiniprogramClose = () => {\n\t\tsetMiniprogramEl(null)\n\t}\n\t\n\tconst handleCopyLink = () => {\n\t\tcopy(props.shareConfig.shareLink)\n\t\tToast.success('操作成功')\n\t}\n\t\n\tconst handleClose = () => {\n\t\tprops.onClose()\n\t}\n\t\n\t// TODO 抽象icon share\n\treturn (\n\t\t<Modal open={props.open}>\n\t\t\t<div className=\"modal__wrap\">\n\t\t\t\t<div className=\"modal__header\">\n\t\t\t\t\t<div className=\"share\">分享</div>\n\t\t\t\t\t<IconButton onClick={handleClose} className=\"close\" sx={{color: 'black'}}><CloseIcon fontSize=\"small\" /></IconButton>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"modal__body\">\n\t\t\t\t\t<div className=\"link-icon-list\">\n\t\t\t\t\t\t<Box>\n\t\t\t\t\t\t\t<IconButton onClick={handleQrcodeOpen} sx={{backgroundColor: '#f1f3f4', color: 'black'}}><QrCodeScannerIcon/></IconButton>\n\t\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\t\topen={Boolean(qrcodeEl)}\n\t\t\t\t\t\t\t\tanchorEl={qrcodeEl}\n\t\t\t\t\t\t\t\tonClose={handleQrcodeClose}\n\t\t\t\t\t\t\t\tanchorOrigin={{\n\t\t\t\t\t\t\t\t\tvertical: 'center',\n\t\t\t\t\t\t\t\t\thorizontal: 'center'\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Typography sx={{ p: 2 }}>\n\t\t\t\t\t\t\t\t\t<QRCode\n\t\t\t\t\t\t\t\t\t\tvalue={props.shareConfig.shareLink}\n\t\t\t\t\t\t\t\t\t\tlevel='H'\n\t\t\t\t\t\t\t\t\t\tincludeMargin={true}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t{/* bridge分享 api 暂不支持,先隐藏 */}\n\t\t\t\t\t\t{/*{isMiniprogram && <Box sx={{marginLeft: '10px'}}>*/}\n\t\t\t\t\t\t{/*\t<IconButton onClick={handleMiniprogramOpen} sx={{backgroundColor: '#f1f3f4', color: 'black'}}><LinkIcon/></IconButton>*/}\n\t\t\t\t\t\t{/*\t<Popover*/}\n\t\t\t\t\t\t{/*\t\topen={Boolean(miniprogramEl)}*/}\n\t\t\t\t\t\t{/*\t\tanchorEl={miniprogramEl}*/}\n\t\t\t\t\t\t{/*\t\tonClose={handleMiniprogramClose}*/}\n\t\t\t\t\t\t{/*\t\tanchorOrigin={{*/}\n\t\t\t\t\t\t{/*\t\t\tvertical: 'center',*/}\n\t\t\t\t\t\t{/*\t\t\thorizontal: 'center'*/}\n\t\t\t\t\t\t{/*\t\t}}*/}\n\t\t\t\t\t\t{/*\t>*/}\n\t\t\t\t\t\t{/*\t\t<Typography sx={{ p: 2 }}>*/}\n\t\t\t\t\t\t{/*\t\t\t<div className=\"tip\">*/}\n\t\t\t\t\t\t{/*\t\t\t\t<p>点击屏幕右上角'...'</p>*/}\n\t\t\t\t\t\t{/*\t\t\t\t<p>即可分享带看</p>*/}\n\t\t\t\t\t\t{/*\t\t\t</div>*/}\n\t\t\t\t\t\t{/*\t\t</Typography>*/}\n\t\t\t\t\t\t{/*\t</Popover>*/}\n\t\t\t\t\t\t{/*</Box>}*/}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Box className=\"link-copy link-content\" >\n\t\t\t\t\t\t<InputBase\n\t\t\t\t\t\t\tdisabled={true}\n\t\t\t\t\t\t\tclassName=\"link\"\n\t\t\t\t\t\t\tvalue={props.shareConfig.shareLink}\n\t\t\t\t\t\t\tsx={{padding: '0 4px'}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tonClick={handleCopyLink}\n\t\t\t\t\t\t\tclassName=\"copy\" sx={{fontSize: '16px', color: 'black'}}>复制</IconButton>\n\t\t\t\t\t</Box>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"modal__footer\"></div>\n\t\t\t</div>\n\t\t</Modal>\n\t);\n}\n\nexport default LiveShareModal;\n","import * as React from 'react';\nimport { useLiveOperation } from '../../userHooks'\nimport './index.css'\nimport liveInstance from \"../../liveController/createLiveInstance\";\nimport ShareIcon from '@mui/icons-material/Share';\nimport PeopleIcon from '@mui/icons-material/People';\nimport ChatIcon from '@mui/icons-material/Chat';\nimport MicIcon from '@mui/icons-material/Mic';\nimport MicOffIcon from \"@mui/icons-material/MicOff\";\nimport SendIcon from '@mui/icons-material/Send'\nimport { Input, Badge, IconButton } from '@mui/material'\nimport { useLiveBroadcast } from \"../../userHooks\";\nimport UserInfoPanel from \"./UserInfoPanel\";\nimport CloseIcon from '@mui/icons-material/Close';\nimport LiveShareModal from \"./LiveShareModal\";\nimport { useVolumes } from '../../userHooks'\nimport { useSelector } from \"react-redux\";\nimport { getLiveInfo } from \"../../slices/liveSlice\";\nimport CallEndIcon from '@mui/icons-material/CallEnd';\nimport Toast from \"../_ui/Toast\";\n\nconst {\n    useSelfInfo,\n    useUserList,\n    useLiveAction,\n    useRTCEventCallback\n} = liveInstance\n\nconst DefaultSpaceLiveModeLayout = () => {\n    const { liveExit } = useLiveOperation()\n    const liveInfo = useSelector(getLiveInfo)\n    const currentUserList = useUserList()\n    const [showGreetBtn, setShowGreetBtn] = React.useState(true)\n    const greetMsgRef = React.createRef()\n    const liveBroadcast = useLiveBroadcast()\n    const [selfInfo, setSelfInfo] = useSelfInfo()\n    const [showUserInfoPanel, setShowUserInfoPanel] = React.useState(false)\n    const { kick, toggleMicro, forbidMicro } = useLiveAction()\n    const userVolumes = useVolumes()\n    const [isTalking, setIsTalking] = React.useState(false)\n    const [showShareModal, setShowShareModal] = React.useState(false)\n    \n    React.useEffect(() => {\n        if(!selfInfo) return\n        if(!userVolumes.length) return\n        const volumeItem = userVolumes.find(item => selfInfo.id === item.userId)\n        const isTalking = !!(volumeItem && volumeItem.audioVolume >= 10)\n        setIsTalking(isTalking)\n    }, [userVolumes])\n    \n    useRTCEventCallback(\"joined\", () => {\n        console.log('rtc -- joined')\n    })\n    \n    useRTCEventCallback(\"error\", (error) => {\n        console.log('rtc -- error: ', error.message)\n    })\n    \n    const handleShareLive = () => {\n        setShowShareModal(true)\n    }\n    \n    const handleClose = () => {\n        liveExit().then(() => {\n            Toast.success('退出带看')\n        })\n    }\n    \n    return <div className=\"default__live\">\n        <div className=\"gui__top\">\n            <div className=\"gui__top--bar\">\n                <IconButton className=\"close btn\" sx={{color: 'white'}} onClick={handleClose}><CloseIcon /></IconButton>\n                <IconButton className=\"title btn\" sx={{color: 'white', fontSize: '16px'}}>如视开发者中心示例--live态</IconButton>\n                <IconButton className=\"share btn\" sx={{color: 'white'}} onClick={() => handleShareLive()}><ShareIcon/></IconButton>\n            </div>\n        </div>\n        <div className=\"gui__overlay\">\n            <div className=\"scene-overlay\">\n                <LiveShareModal\n                    open={showShareModal}\n                    onClose={() => setShowShareModal(false)}\n                    shareConfig={{ shareLink: `${window.location.href.split('?')[0]}?userRole=audience&roomCode=${liveInfo.roomCode}&enterLive=true` }}\n                />\n                {\n                    showUserInfoPanel && <div className=\"overlay-modal\">\n                        <IconButton className=\"icon-close\" onClick={() => setShowUserInfoPanel(false)}><CloseIcon/></IconButton>\n                        <UserInfoPanel\n                            list={currentUserList}\n                            selfInfo={selfInfo}\n                            volumeLists={userVolumes}\n                            onForbiddenMicro={(userId) => forbidMicro('CLOSE', userId)}\n                            onKickUser={(userId) => kick(userId)}\n                            onNickNameChange={(newNickName) => setSelfInfo({'nickname': newNickName})}\n                        />\n                    </div>\n                }\n            </div>\n        </div>\n        <div className=\"gui__bottom\">\n            <div className='controls'>\n                <div className='collapsible-list'>\n                    <div className='collapsible-item'>\n                        <IconButton sx={{color: 'white'}} className=\"members\" onClick={() => setShowUserInfoPanel(true)}>\n                            <Badge color=\"primary\" badgeContent={currentUserList && currentUserList.length}><PeopleIcon/></Badge>\n                        </IconButton>\n                        {\n                            showGreetBtn\n                                ? <IconButton sx={{color: 'white'}} className=\"greet\" onClick={() => setShowGreetBtn(false)}><ChatIcon/></IconButton>\n                                : <div className=\"greet\">\n                                    <Input type=\"text\" placeholder=\"说点什么吧\" inputRef={greetMsgRef} />\n                                    <IconButton\n                                        sx={{color: 'white'}}\n                                        onClick={() => {\n                                            liveBroadcast({\n                                                event_id: 'greet',\n                                                message: greetMsgRef.current?.value\n                                            })\n                                            setShowGreetBtn(true)\n                                        }}\n                                    ><SendIcon /></IconButton>\n                                </div>\n                        }\n                        <IconButton sx={{color: 'white'}} className=\"micro\" onClick={() => toggleMicro(!selfInfo.micro_status)}>\n                            { selfInfo?.micro_status ? (isTalking ? <MicIcon color='primary'/> : <MicIcon />) : <MicOffIcon/> }\n                        </IconButton>\n                        <IconButton sx={{color: 'white'}} className=\"close\" onClick={handleClose}><CallEndIcon/></IconButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DefaultSpaceLiveModeLayout;\n","import * as React from 'react';\nimport './index.css'\nimport { useSpaceState } from \"../../userHooks\";\n\n\nconst DecorationSpaceUserMode = () => {\n    const setSpaceState = useSpaceState()[1]\n\n    return <div className=\"panel decoration-space-panel__bottom-user\">\n        <div className='bottom'>\n            <div className='controls'>\n                <div className='collapsible-list'>\n                    <div className='collapsible-item'>\n                        <span>decoration -- user</span>\n                        <button onClick={() => setSpaceState({ type: 'default' })}>switch to default space</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DecorationSpaceUserMode;\n","import * as React from 'react';\nimport { useLiveOperation, useSpaceState } from '../../userHooks'\nimport './index.css'\n\nconst DecorationSpaceLiveModeLayout = () => {\n    const { liveExit } = useLiveOperation()\n    const setSpaceState = useSpaceState()[1]\n\n    return <div className=\"panel decoration-space-panel__bottom--live\">\n        <div className='bottom'>\n            <div className='controls'>\n                <div className='collapsible-list'>\n                    <div className='collapsible-item'>\n                        <span>decoration -- live</span>\n                        <button onClick={() => setSpaceState({ type: 'default' } )}>switch to default space</button>\n                        <button onClick={() => liveExit()}>exit live</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DecorationSpaceLiveModeLayout;\n","import * as React from 'react';\nimport './index.css'\nimport DefaultSpaceUserModeLayout from './DefaultSpaceUserModeLayout'\nimport DefaultSpaceLiveModeLayout from \"./DefaultSpaceLiveModeLayout\";\nimport DecorationSpaceUserMode from \"./DecorationSpaceUserModeLayout\";\nimport DecorationSpaceLiveMode from './DecorationSpaceLiveModeLayout'\nimport { useSpaceState } from \"../userHooks\";\n\nconst Gui = () => {\n    const [spaceState] = useSpaceState()\n    \n    const renderDefaultSpaceUserMode = () => <DefaultSpaceUserModeLayout/>\n    const renderDefaultSpaceLiveMode = () => <DefaultSpaceLiveModeLayout/>\n\n    const renderDefaultSpaceTourMode = () => {\n        return <div className=\"panel default-space-panel__bottom--tour\">default -- tour</div>\n    }\n\n    const renderDecorationSpaceUserMode = () => <DecorationSpaceUserMode/>\n\n    const renderDecorationSpaceLiveMode = () => <DecorationSpaceLiveMode/>\n\n    const renderDecorationSpaceTourMode = () => {\n        return <div className=\"panel decoration-space-panel__bottom--tour\">decoration -- tour</div>\n    }\n\n    switch(spaceState.type){\n        case 'default':\n            return defaultSpacePanel()\n        case 'decoration':\n            return decorationSpacePanel()\n        default:\n            return null\n    }\n\n    function defaultSpacePanel () {\n        switch (spaceState.mode) {\n            case 'user':\n                return renderDefaultSpaceUserMode()\n            case 'live':\n                return renderDefaultSpaceLiveMode()\n            case 'tour':\n                return renderDefaultSpaceTourMode()\n            default:\n                return null\n        }\n    }\n\n    function decorationSpacePanel () {\n        switch (spaceState.mode) {\n            case 'user':\n                return renderDecorationSpaceUserMode()\n            case 'live':\n                return renderDecorationSpaceLiveMode()\n            case 'tour':\n                return renderDecorationSpaceTourMode()\n            default:\n                return null\n        }\n    }\n};\n\nexport default Gui;\n","import React from 'react';\nimport './App.css';\nimport Space from './spaces/Space'\nimport Minimodel from \"./attachments/Minimodel\";\nimport { useLiveOperation, useSpaceState } from \"./userHooks\";\nimport Gui from './gui'\nimport liveInstance from \"./liveController/createLiveInstance\";\n// import { WebSocketState } from \"@realsee/live/lib/typings/WebSocket\";\nimport { setSpaceStateToStore } from \"./slices/spaceSlice\";\nimport { useDispatch } from \"react-redux\";\nimport { isApp } from './utils/deviceDetect'\nimport { useBangsHeightState, useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport { Box } from '@mui/material'\nimport Barrage from \"./gui/_ui/Barrage\";\nimport Toast from './gui/_ui/Toast'\nimport { BuiltinEventType, BuiltinActionType, BuiltinMsg } from \"@realsee/live/lib/typings/LiveMsg\";\n\nconst MinimodelWithSpace = Space.withSpace(Minimodel)\n\n// const defaultWorkUrl = \"/mock/testWork.json\"\n// const defaultWorkUrl = \"/mock/defaultWork.json\"\nconst defaultWorkUrl = \"/api/demo/work/show.json\"\n// const defaultWorkUrl = \"https://vrlab-public.ljcdn.com/common/file/web/0d60a982-5a5f-4d86-85f9-5055d3b69da9.json\"\n\nconst { useKeyframe, useReadyState, useLiveEventCallback, useWebSocketEventCallback } = liveInstance\n\nfunction App() {\n    const bandHeight = Math.ceil(useBangsHeightState() / window.devicePixelRatio)\n    const [defaultFiveState, setDefaultFiveState] = React.useState()\n    const [fiveStateKeyframe, setFiveStateKeyframe] = useKeyframe('FiveState')\n    // const wsStatus = useReadyState()\n    const [spaceState, setSpaceState] = useSpaceState()\n    const { closeLoading } = useJSBridgeAction()\n    const { liveConnectFromUrl } = useLiveOperation()\n    const { liveExit } = useLiveOperation()\n    \n    const WrapStyle = {\n        position: 'absolute',\n        left: 0,\n        top: `${bandHeight}px`,\n        width: '100%',\n        height: '100%',\n        pointerEvents: 'none'\n    }\n    \n    // 根据url参数进入带看\n    React.useEffect(() => {\n        if (isApp) {\n            Promise.resolve()\n                .then(closeLoading)\n                .then(() => liveConnectFromUrl(window.location.href))\n                .catch(error => {\n                    Toast.error(error.message || '哪里出错了，请刷新后重试！')\n                })\n        }else {\n            Promise.resolve()\n                .then(() => liveConnectFromUrl(window.location.href))\n                .catch(error => {\n                    Toast.error(error.message || '哪里出错了，请刷新后重试！')\n                })\n        }\n    }, [])\n    \n    /** 纯live相关处理start */\n    const [spaceStateKeyframe] = useKeyframe('SpaceState')\n    const dispatch = useDispatch()\n    \n    // 不再以此作为带看进入/离开的事件监听\n    // React.useEffect(() => {\n    //     switch (wsStatus) {\n    //         case WebSocketState.OPEN:\n    //             setSpaceState({ mode: 'live' }, false)\n    //             Toast.success('进入带看')\n    //             break;\n    //         case WebSocketState.CLOSED:\n    //             console.log(\"__退出带看__\")\n    //             setSpaceState({ mode: 'user' })\n    //             Toast.success('退出带看')\n    //             break;\n    //         default:\n    //             return null\n    //     }\n    // }, [wsStatus])\n\n    React.useEffect(() => {\n        if (spaceStateKeyframe && spaceState.mode === 'live') {\n            dispatch(setSpaceStateToStore(spaceStateKeyframe))\n        }\n    }, [spaceStateKeyframe, dispatch, spaceState.mode])\n    \n    // 带看通道建立，首屏数据同步\n    useLiveEventCallback('readyKeyframeSync', (lastKeyframe) => {\n        // live channel ready\n        setSpaceState({ mode: 'live' }, false)\n        Toast.success('进入带看')\n        \n        // sync first screen frame\n        if (JSON.stringify(lastKeyframe) !== '{}') {\n            for (const key in lastKeyframe) {\n                if (lastKeyframe.hasOwnProperty(key)) {\n                    switch (key) {\n                        case 'FiveState':\n                            setDefaultFiveState(lastKeyframe[key])\n                            break\n                        default:\n                            return\n                    }\n                }\n            }\n        }\n    })\n    \n    // 被踢出\n    useLiveEventCallback(\"kickOut\", () => {\n        liveExit().then(() => {\n            // setSpaceState({ mode: 'user' }) // TODO 存疑,为什么不是从wsState里得到的close信息\n            Barrage.message('你被踢出带看房间')\n        })\n    })\n    \n    // 内置事件监听\n    useLiveEventCallback(\"builtinEvent\", (builtinMsg) => {\n        switch (builtinMsg.action) {\n            case BuiltinActionType.RoomClose:\n                console.log('__房间关闭__')\n                setSpaceState({ mode: 'user' })\n                Toast.success('房间关闭')\n                break\n            case BuiltinActionType.UserStatus:\n                console.log(builtinMsg.data)\n                console.log('builtinEvent: user state change')\n                break\n            case BuiltinActionType.UserInfo:\n                console.log('builtinEven: user info change')\n                break\n            case BuiltinActionType.UserMicroStatus:\n                console.log('builtinEvent: user micro change')\n                break\n            case BuiltinActionType.UserPermission:\n                console.log('builtinEvent: user permission change')\n                break\n            default:\n                console.log('builtinEvent: 其他不在枚举内的变更！') // debug\n                break\n        }\n    })\n    \n    // ws异常提示\n    useWebSocketEventCallback(\"ws.error\", (wsError) => {\n        Toast.error(wsError.error.message || '哪里出错了，请刷新后重试！')\n        console.log(wsError.error.message || '哪里出错了，请刷新后重试！')\n    })\n    \n    \n    /** 纯live相关处理end */\n    \n    // live mode下，five state同步\n    React.useEffect(() => {\n        if (spaceState.mode === 'live' && fiveStateKeyframe) {\n            setDefaultFiveState(fiveStateKeyframe)\n        }\n    }, [fiveStateKeyframe, spaceState.mode])\n    \n    function handleDefaultState (state) {\n        if (spaceState.mode === 'live') {\n            setFiveStateKeyframe(state)\n        }\n    }\n    \n  return (\n      <section id=\"app-container\">\n          {/* 此处可放错误bar等额外信息 */}\n          <main>\n              <div id=\"canvas-container\">\n                  <Space\n                      spaceRootId=\"default-canvas\"\n                      url={defaultWorkUrl}\n                      isMain={spaceState.type === 'default'}\n                      isSplit={spaceState.split}\n                      state={defaultFiveState}\n                      onStateChange={handleDefaultState}\n                  >\n                      {/* attachments */}\n                      <Box sx={WrapStyle}>\n                          <MinimodelWithSpace/>\n                      </Box>\n                  </Space>\n              </div>\n              {/* gui不含任何space相关操作能力 */}\n              <div id=\"gui\" style={{ paddingTop: `${bandHeight}px`}}>\n                  <Gui />\n              </div>\n          </main>\n      </section>\n  );\n}\n\nexport default App;\n","import { configureStore } from '@reduxjs/toolkit';\nimport spaceReducer from '../slices/spaceSlice'\nimport liveReducer from '../slices/liveSlice'\n\nexport const store = configureStore({\n  reducer: {\n    space: spaceReducer,\n    live: liveReducer\n  },\n});\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { store } from './app/store';\nimport { Provider } from 'react-redux';\nimport * as serviceWorker from './serviceWorker';\nimport liveInstance from \"./liveController/createLiveInstance\";\nimport {JSBridgeApp} from \"@realsee/jsbridge-x/lib/app\";\nimport {JSBridgeContext} from \"@realsee/jsbridge-x/lib/react\"\nimport {JSBridgeMiniprogram} from \"@realsee/jsbridge-x/lib/miniprogram\";\nimport { JSBridgeBrowser } from './utils/browser'\nimport { isApp, isMiniprogram } from './utils/deviceDetect'\n\nlet value\nif (isMiniprogram) value = new JSBridgeMiniprogram()\nelse if (isApp) value = new JSBridgeApp()\nelse value = new JSBridgeBrowser()\n\nReactDOM.render(\n  <React.StrictMode>\n      <JSBridgeContext.Provider value={value}>\n          <Provider store={store}>\n              <liveInstance.LiveProvider >\n                  <App/>\n              </liveInstance.LiveProvider>\n          </Provider>\n      </JSBridgeContext.Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}