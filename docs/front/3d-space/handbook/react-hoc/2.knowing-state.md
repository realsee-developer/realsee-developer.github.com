---
title: æ”¹å˜è§†è§’
---

> **ä¸Šä¸€ç« å›é¡¾: å±•ç¤ºä¸‰ç»´ç©ºé—´** <br/>
> - ä½ äº†è§£äº†ä»€ä¹ˆæ˜¯ **Work**, ä»¥åŠå¦‚ä½•è·å–å’ŒåŠ è½½ã€‚<br/>
> - å¦‚ä½•å±•ç¤ºä¸‰ç»´ç©ºé—´ï¼Œå¹¶ä¸”å†æ¬¡åŸºç¡€ä¸Šå¼€å‘ç»„ä»¶æ¥æ§åˆ¶ä¸‰ç»´ç©ºé—´ã€‚

:::tip æœ¬ç« ä½ å¯ä»¥å­¦ä¹ åˆ°

- äº†è§£ä»€ä¹ˆæ˜¯ Stateã€‚
- å¦‚ä½•æ”¹å˜ä¸‰ç»´ç©ºé—´è§‚å¯Ÿçš„æ–¹å‘ / ä½ç½®ã€‚
- äº†è§£ä¸Šä¸€ç« çš„ä»£ç ï¼Œæ¯”å¦‚ `currentState` `setState` åŠå…¶ä»–å“åº”çš„æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚
- é€šè¿‡ **State** å®Œæˆäº†è‡ªåŠ¨ç¯è§†çš„åŠŸèƒ½ã€‚

:::

## å‡†å¤‡å·¥ä½œ

å’Œä¸Šä¸€ç« èŠ‚ä¸€æ ·ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªç›®å½•ï¼ˆ`src/2.knowing-state`ï¼‰ä»¥åŠå¯¹åº”çš„ **html** æ–‡ä»¶ ä»¥åŠ **jsx** æˆ– **tsx** æ–‡ä»¶ã€‚

**jsx** æˆ– **tsx** æ–‡ä»¶å¯ä»¥å…ˆæ‹·è´ä¸Šä¸€ç« èŠ‚çš„å†…å®¹ã€‚

```html title="src/2.knowing-state/index.html"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ”¹å˜è§†è§’ | Knowing state</title>
  <style>
    * { margin: 0; padding: 0; }
    html, body #app { width: 100%; height: 100%; overflow: hidden; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script type="module" src="./index"></script>
</body>
</html>
```

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

**src/2.knowing-state/withFetchWork.jsx**
```js
import { useState, useEffect } from "react";
import { parseWork } from "@realsee/five";

/**
 * React Hook: é€šè¿‡ work.json çš„åœ°å€ è·å– work å¯¹è±¡
 * @param url work.json çš„æ•°æ®åœ°å€
 * @returns work å¯¹è±¡ï¼Œå¦‚æœè·å–ä¸­ï¼Œè¿”å› null
 */
 function useFetchWork(url) {
  const [work, setWork] = useState(null);
  useEffect(() => {
    setWork(null);
    fetch(url)
      .then(response => response.text())
      .then(text => setWork(parseWork(text)));
  },[url]);
  return work;
}

export { useFetchWork };
```

**src/2.knowing-state/withWindowDimensions.js**
```js
import React, { Component } from "react";

/**
 * React HOC: è·å–å½“å‰çª—å£çš„å°ºå¯¸
 */
function withWindowDimensions() {
  return function(Compnent) {
    return class extends Component {
      state = this.getWindowDimensions();
      resizeListener = () => {
        this.setState(this.getWindowDimensions());
      };
      getWindowDimensions() {
        return { width: window.innerWidth, height: window.innerHeight };
      }
      componentDidMount() {
        window.addEventListener("resize", this.resizeListener, false);
      }
      componentWillUnmount() {
        window.removeEventListener("resize", this.resizeListener, false);
      }
      render() {
        const dimensions = { width: this.state.width, height: this.state.height };
        return <Compnent windowDimensions={dimensions} {...this.props}/>;
      }
    }
  }
}

export { withWindowDimensions };
```

**src/2.knowing-state/ModeController.jsx**
```jsx
import React, { Component } from "react";
import { Five } from "@realsee/five";
import { withFive, createFiveFeature } from "@realsee/five/react";
import { compose } from "@wordpress/compose";
import BottomNavigation from "@mui/material/BottomNavigation";
import BottomNavigationAction from "@mui/material/BottomNavigationAction";
import Paper from "@mui/material/Paper";
import DirectionsWalkIcon from "@mui/icons-material/DirectionsWalk";
import ViewInArIcon from "@mui/icons-material/ViewInAr";

const FEATURES = createFiveFeature("currentState", "setState");

/**
 * React Component: æ¨¡æ€æ§åˆ¶
 */
const ModeController = compose(
  withFive(FEATURES)
)(class extends Component {
  render() {
    return <Paper sx={{ position: "fixed", bottom: 0, left: 0, right: 0 }}>
      <BottomNavigation
        showLabels
        value={this.props.$five.currentState.mode}
        onChange={(_, newValue) => {
          this.props.$five.setState({ mode: newValue });
        }}
      >
        <BottomNavigationAction label="å…¨æ™¯æ¼«æ¸¸" icon={<DirectionsWalkIcon/>} value={Five.Mode.Panorama}/>
        <BottomNavigationAction label="ç©ºé—´æ€»è§ˆ" icon={<ViewInArIcon/>} value={Five.Mode.Floorplan}/>
      </BottomNavigation>
    </Paper>;
  }
})

export { ModeController };
```

**src/2.knowing-state/App.jsx**
```jsx
import React, { Component } from "react";
import { compose } from "@wordpress/compose";
import { createFiveProvider, FiveCanvas } from "@realsee/five/react";
import { withFetchWork } from "./withFetchWork";
import { withWindowDimensions } from "./withWindowDimensions";
import { ModeController } from "./ModeController";

/** work.json çš„æ•°æ® URL */
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

const FiveProvider = createFiveProvider();

const App = compose(
  withFetchWork(workURL),
  withWindowDimensions()
)(class extends Component {
  render() {
    const { work, windowDimensions } = this.props;
    return <FiveProvider initialWork={work}>
      <FiveCanvas width={windowDimensions.width} height={windowDimensions.height}/>
      <ModeController/>;
    </FiveProvider>;
  }
});

export { App };
```

**src/2.knowing-state/index.jsx**
```jsx
import React from "react";
import ReactDOM from "react-dom";
import { App } from "./App";

ReactDOM.render(<App/>, document.querySelector("#app"));

export {};
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">


**src/2.knowing-state/withFetchWork.tsx**
```tsx
import React, { Component, ComponentClass } from "react";
import { Work, parseWork } from "@realsee/five";

/**
 * React HOC è·å– work
 * @param url work.json çš„åœ°å€
 */
function withFetchWork<P extends Record<string, any>>(url: string) {
  return function(Compnent: ComponentClass<P & { work: Work }>): ComponentClass<P> {
    return class extends Component<P, {work: Work | null}> {
      state = { work: null };
      componentDidMount() {
        fetch(url).then(res => res.json()).then(json => {
          this.setState({ work: parseWork(json) });
        });
      }
      render() {
        if (this.state.work === null) return null;
        return <Compnent work={this.state.work} {...this.props}/>;
      }
    }
  }
}

export { withFetchWork };
```

**src/2.knowing-state/useWindowDimensions.tsx**
```tsx
import React, { Component, ComponentClass } from "react";

/**
 * React HOC: è·å–å½“å‰çª—å£çš„å°ºå¯¸
 */
function withWindowDimensions<P extends Record<string, any>>() {
  return function(Compnent: ComponentClass<P & { windowDimensions: { width: number, height: number} }>): ComponentClass<P> {
    return class extends Component<P, {width: number, height: number}> {
      state = this.getWindowDimensions();
      resizeListener = () => {
        this.setState(this.getWindowDimensions());
      };
      getWindowDimensions() {
        return { width: window.innerWidth, height: window.innerHeight };
      }
      componentDidMount() {
        window.addEventListener("resize", this.resizeListener, false);
      }
      componentWillUnmount() {
        window.removeEventListener("resize", this.resizeListener, false);
      }
      render() {
        const dimensions = { width: this.state.width, height: this.state.height };
        return <Compnent windowDimensions={dimensions} {...this.props}/>;
      }
    }
  }
}

export { withWindowDimensions };
```

**src/2.knowing-state/ModeController.tsx**
```tsx
import React, { Component } from "react";
import { Five, Mode } from "@realsee/five";
import { withFive, createFiveFeature, PropTypeOfFiveFeatures } from "@realsee/five/react";
import { compose } from "@wordpress/compose";
import BottomNavigation from "@mui/material/BottomNavigation";
import BottomNavigationAction from "@mui/material/BottomNavigationAction";
import Paper from "@mui/material/Paper";
import DirectionsWalkIcon from "@mui/icons-material/DirectionsWalk";
import ViewInArIcon from "@mui/icons-material/ViewInAr";

const FEATURES = createFiveFeature("currentState", "setState");
type Props = PropTypeOfFiveFeatures<typeof FEATURES>;

/**
 * React Component: æ¨¡æ€æ§åˆ¶
 */
const ModeController = compose(
  withFive(FEATURES)
)(class extends Component<Props> {
  render() {
    return <Paper sx={{ position: "fixed", bottom: 0, left: 0, right: 0 }}>
      <BottomNavigation
        showLabels
        value={this.props.$five.currentState.mode}
        onChange={(_, newValue: Mode) => {
          this.props.$five.setState({ mode: newValue });
        }}
      >
        <BottomNavigationAction label="å…¨æ™¯æ¼«æ¸¸" icon={<DirectionsWalkIcon/>} value={Five.Mode.Panorama}/>
        <BottomNavigationAction label="ç©ºé—´æ€»è§ˆ" icon={<ViewInArIcon/>} value={Five.Mode.Floorplan}/>
      </BottomNavigation>
    </Paper>;
  }
})

export { ModeController };
```

**src/2.knowing-state/App.tsx**
```tsx
import React, { Component } from "react";
import { Work } from "@realsee/five";
import { createFiveProvider, FiveCanvas } from "@realsee/five/react";
import { compose } from "@wordpress/compose";
import { withFetchWork } from "./withFetchWork";
import { withWindowDimensions } from "./withWindowDimensions";
import { ModeController } from "./ModeController";

/** work.json çš„æ•°æ® URL */
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

const FiveProvider = createFiveProvider();

const App = compose(
  withFetchWork(workURL),
  withWindowDimensions()
)(class extends Component<{work: Work, windowDimensions: { width: number, height: number }}> {
  render() {
    const { work, windowDimensions } = this.props;
    return <FiveProvider initialWork={work}>
      <FiveCanvas width={windowDimensions.width} height={windowDimensions.height}/>
      <ModeController/>
    </FiveProvider>;
  }
});


export { App };
```

**src/2.knowing-state/index.tsx**
```tsx
import React from "react";
import ReactDOM from "react-dom";
import { App } from "./App";

ReactDOM.render(<App/>, document.querySelector("#app"));

export {};
```

</TabItem>
</Tabs>


å¯åŠ¨æœåŠ¡ `npm run dev`ã€‚ å¹¶è·³è½¬åˆ°å½“å‰é¡µé¢ "http://localhost:3000/src/2.knowing-state/index.html"ã€‚

:::info
è¯·æŸ¥çœ‹ä½ çš„æ§åˆ¶å°ï¼Œç«¯å£å·ä¼šå› ä¸ºä½ çš„é…ç½®ä»¥åŠå½“å‰ç«¯å£å ç”¨æƒ…å†µå˜æ›´ï¼Œè¯·å·²æ§åˆ¶å°è¾“å‡ºçš„ä¸ºå‡†ã€‚
å¦‚æœä½ ä½¿ç”¨å…¶ä»–å¼€å‘æ„å»ºå·¥å…·ï¼Œè¯·æŒ‰ç…§è‡ªå·±çš„å¼€å‘æ„å»ºå·¥å…·çš„è¦æ±‚å¯åŠ¨æœåŠ¡ã€‚
:::

## ä»€ä¹ˆæ˜¯ State

> ç”±æ¥äº†è§£æ¦‚å¿µäº†ï¼Œæˆ‘ä¿è¯ç€ä½ æ˜¯ç°é˜¶æ®µéœ€è¦äº†è§£çš„æœ€åä¸€ä¸ªç†è®ºåªæ˜¯äº†ã€‚

### State ç®€ä»‹

**State** ç”¨äºæè¿°çŠ¶æ€çš„æ•°æ®ç»“æ„ã€‚ä¸Šä¸€ç« æˆ‘ä»¬äº†è§£äº† **Work**, **Work** æ˜¯ç”¨äºæè¿°ä¸€ä¸ªä¸‰ç»´ç©ºé—´ï¼Œé‚£ä¹ˆ **State** åˆ™æ˜¯æè¿°åœ¨è¿™ä¸ªä¸‰ç»´ç©ºé—´å†…ï¼Œç›®å‰æ­£åœ¨å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚ä»–åŒ…å«äº†æ¨¡æ€ã€ä½äºçš„é‡‡é›†ç‚¹ä½ã€ç›¸æœºçš„æ–¹å‘ã€ç›¸æœºå¯è§†è§’åº¦çš„ä¿¡æ¯ã€‚

### State çš„æ•°æ®ç»“æ„åŠè¯´æ˜

```tsx
interface State {
  "mode": Five.Mode,
  "panoIndex": number,
  "longitude": number,
  "latitude": number,
  "fov": number,
  "offset": THEEE.Vector3
}
```

**State**çš„æ•°æ®æè¿°

- `mode`: å½“å‰çš„æ¨¡æ€
  Five å¸¸ç”¨æœ‰ 5 ç§æ¨¡æ€ï¼Œå¯ä»¥ä½¿ç”¨ `Five.Mode` è·å¾—
    - Panorama: å…¨æ™¯æ¸¸èµ°æ¨¡æ€ï¼Œè¯¥æ¨¡æ€ä¸‹è§†å›¾å°†åœ¨é‡‡é›†ç‚¹é—´æ¸¸èµ°ï¼Œæ‰‹åŠ¿æ“ä½œå¯ä»¥æ—‹è½¬/æ”¾å¤§è§†è§’/åˆ‡æ¢é‡‡é›†ç‚¹ï¼Œé€‚åˆæŸ¥çœ‹é‡‡é›†çš„å…¨æ™¯ä¿¡æ¯ã€‚
    - Floorplan: ç©ºé—´æ€»è§ˆæ¨¡æ€, è¯¥æ¨¡æ€ä¸‹è§†å›¾ä»¥æ¨¡å‹ä¸ºä¸­å¿ƒï¼Œæ‰‹åŠ¿æ“ä½œå¯ä»¥æ—‹è½¬/æ”¾å¤§æ¨¡å‹/åˆ‡æ¢æ¥¼å±‚ï¼Œé€‚åˆæŸ¥çœ‹æ¨¡å‹çš„æ•´ä½“æ•ˆæœã€‚
    - Topview: æˆ·å‹å›¾æ¨¡æ€ï¼Œè¯¥æ¨¡æ€ä¸‹è§†å›¾ä»¥æ¨¡å‹ä¸ºä¸­å¿ƒï¼Œå‚ç›´ä¿¯è§†æ¨¡å‹ï¼Œæ‰‹åŠ¿æ“ä½œå¯ä»¥å¹³ç§»/æ”¾å¤§æ¨¡å‹/åˆ‡æ¢æ¥¼å±‚ï¼Œé€‚åˆæŸ¥çœ‹æ¨¡å‹å¹³é¢ç»“æ„ã€‚
    - Model: æ¨¡å‹æ¸¸èµ°æ¨¡æ€ï¼Œè¯¥æ¨¡æ€ä¸‹è§†å›¾å°†åœ¨æ¨¡å‹ä¸­è‡ªç”±æ¸¸èµ°ï¼Œæ‰‹åŠ¿æ“ä½œå¯ä»¥æ—‹è½¬/æ”¾å¤§è§†è§’/ä½ç§»ï¼Œé€‚åˆæŸ¥çœ‹æ¨¡å‹çš„ç»†èŠ‚ï¼Œåšä¸€äº›å®šä½æ“ä½œã€‚
    - VRPanorama: VR çœ¼é•œæ¨¡æ€ï¼Œè¯¥æ¨¡æ€ä¸‹å¯ä»¥ä½¿ç”¨ [Cardboard çœ¼é•œ](https://arvr.google.com/cardboard/) æˆ–è€…ä»–çš„ç¬¬ä¸‰æ–¹è¡ç”Ÿäº§å“ï¼Œå®ç° VR è™šæ‹Ÿæ˜¾ç¤ºæ•ˆæœã€‚

- `panoIndex`: é‡‡é›†ç‚¹ä½ï¼Œå³åœ¨ Panorama æ¨¡æ€å¯ä»¥è½è„šçš„ä½ç½®ã€‚æ˜¯ä¸€ä¸ª `work[observers]` çš„ä¸€ä¸ªç´¢å¼•ã€‚

- `longitude` / `latitude`: ç›¸æœºçš„æ°´å¹³è§’ / ç›¸æœºçš„åèˆªè§’ï¼ˆå¼§åº¦ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ç±»ä¼¼ç»çº¬åº¦çš„æ–¹å¼æè¿°ç›¸æœºä½ç½®ã€‚

  æ•´ä¸ªæ¨¡å‹åœºæ™¯ä¸ºä¸€ä¸ªå³æ‰‹ç¬›å¡å°”åæ ‡ç³», `XZ`å¹³é¢å¹³è¡Œäºåœ°é¢ï¼Œ `Y`è½´å‚ç›´äºåœ°é¢ã€‚

  ![å³æ‰‹åæ ‡ç³»å›¾ç¤º](https://vrlab-public.ljcdn.com/common/file/web/2f331826-4b15-4da5-9603-50c1287b38f7.svg)

  åˆå§‹ç›¸æœºæ–¹å‘ä¸ºåŸç‚¹çœ‹å‘ **Z è½´è´Ÿæ–¹å‘**ã€‚
    - å¢åŠ  `longitude` ç›¸æœºå‘å·¦æ—‹è½¬ã€‚
    - å‡å°‘ `longitude` ç›¸æœºå‘å³æ—‹è½¬ã€‚
    - å¢åŠ  `latitude` ç›¸æœºå‘ä¸‹æ—‹è½¬ã€‚
    - å‡å°‘ `latitude` ç›¸æœºå‘ä¸Šæ—‹è½¬ã€‚


- `fov`: ç›¸æœºå‚ç›´æ–¹å‘çš„å¯è§†è§’åº¦ (è§’åº¦)ã€‚

- `offset`: å½“å‰ç›¸æœºçš„ä¸‰ç»´åæ ‡ã€‚

### state ç›¸å…³çš„ API æœ‰ä»€ä¹ˆ

- [`[state, setState] = useFiveState;`](https://unpkg.com/@realsee/five/docs/modules/react.html#useFiveState)
- [`[currentState, setCurrentState] = useFiveCurrentState;`](https://unpkg.com/@realsee/five/docs/modules/react.html#useFiveCurrentState)

å¯ä»¥é€šè¿‡ `state` `currentState` è·å–å½“å‰çŠ¶æ€ï¼Œé€šè¿‡ `setState` `setCurrentState` è®¾ç½®çŠ¶æ€ã€‚

### state / currentState çš„åŒºåˆ«

**currentState** æ˜¯å½“å‰çŠ¶æ€ï¼Œå°±æ˜¯ç”»é¢ä¸­çš„çŠ¶æ€ï¼Œç›®å‰å±•ç¤ºçš„çŠ¶æ€ã€‚
**state** æ˜¯ç›®æ ‡çŠ¶æ€æˆ–è€…è¯´ä¸‹ä¸€æ—¶é—´çš„ç¨³å®šçŠ¶æ€ã€‚

å¯ä»¥ç®€å•çš„è¿™æ ·è®¤ä¸º: <br/>
å½“ **setSate** è¢«è°ƒç”¨åï¼Œ**state** å½“å³ä¼šå˜æˆ **setState** çš„å€¼ï¼Œè€Œ **currentState** åˆ™ä¸ä¼šé©¬ä¸Šæ”¹å˜ï¼Œä»–ä¼šåœ¨åŠ¨ç”»è¿‡æ¸¡çš„è¿‡ç¨‹ä¸­é€æ­¥é€¼è¿‘ **state** å¹¶æœ€ç»ˆå˜æˆå’Œ  **state** ä¸€æ ·çš„å€¼ã€‚å°±å’Œä½ åœ¨ç”»é¢ä¸­çœ‹åˆ°çš„åŠ¨ç”»ä¸€æ ·ã€‚

åœ¨ä¸Šä¸€ç« çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨äº† **mode** å±æ€§ï¼Œæ¥åˆ‡æ¢ **Panorama** ä»¥åŠ **Floorplan** æ¨¡æ€ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•æŠŠå…¶ä»–çš„å‡ ç§æ¨¡æ€éƒ½è¡¥å……ä¸Šï¼Œçœ‹çœ‹å„ç§æ¨¡æ€ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚
> **VRPanorama æ¨¡æ€**éœ€è¦ä½¿ç”¨è®¾å¤‡é™€èºä»ªä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨ç§»åŠ¨è®¾å¤‡ã€‚
> å¹¶ä¸”å¦‚æœåœ¨ **iOS** è®¾å¤‡ä¸‹ï¼Œéœ€è¦æœåŠ¡å¤„äº `https` ä¸‹ï¼Œå¦åˆ™ **iOS** ä¸å…è®¸è®¿é—®é™€èºä»ªä¿¡æ¯ã€‚

## å¼€å‘ä¸€ä¸ªè‡ªåŠ¨ç¯è§†çš„åŠŸèƒ½ ##

æˆ‘ä»¬å·²ç»è·å–å’Œè®¾ç½®è¿‡äº† **mode**ï¼Œè¿™æ¬¡æˆ‘ä»¬ä¿®æ”¹ä¸‹ **longitude / latitude** è¯•è¯•ã€‚è¿™æ¬¡æˆ‘ä»¬å¼€å‘ä¸€ä¸ªè‡ªåŠ¨ç¯è§†çš„åŠŸèƒ½ã€‚é€šè¿‡ä¸€ä¸ªæŒ‰é’®æ§åˆ¶æ¿€æ´»è‡ªåŠ¨ç¯è§†çš„åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½ä¼šè‡ªåŠ¨æ°´å¹³æ—‹è½¬é•œå¤´ã€‚

### ä¹¦å†™ç¯è§†ç»„ä»¶

1. æ·»åŠ ä¸€ä¸ª **LookAroundController** æ–‡ä»¶ï¼Œç”¨äºç¼–å†™ç»„ä»¶ã€‚
2. è®¾è®¡ **active** React state ç”¨äºæ§åˆ¶ç¯è§†çš„åŠŸèƒ½æ˜¯å¦å¼€å¯çš„æŒ‰é’®å±•ç¤ºçŠ¶æ€ã€‚
3. ç¯è§†åŠŸèƒ½çš„å®ç°ä¸ºï¼šé€šè¿‡ setInterval å®šæ—¶è§¦å‘å‡½æ•°ï¼Œä¿®æ”¹ five çš„ **state**ã€‚


<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```jsx title="src/2.knowing-state/LookAroundController.jsx"
import React, { Component } from "react";
import { withFive, createFiveFeature } from "@realsee/five/react";
import { compose } from "@wordpress/compose";
import IconButton from "@mui/material/IconButton";
import Paper from "@mui/material/Paper";
import FlipCameraAndroidIcon from "@mui/icons-material/FlipCameraAndroid";
import PauseIcon from "@mui/icons-material/Pause";

const FEATURES = createFiveFeature("currentState", "setState");

/**
 * ReactComponent: è‡ªåŠ¨ç¯è§†æŒ‰é’®
 */
const LookAroundController = compose(
  withFive(FEATURES)
)(class extends Component {

  timer;
  state = { active: false };

  toggleActive(active) {
    window.clearInterval(this.timer);
    this.setState({ active });
    if (active === true) {
      this.timer = window.setInterval(() => {
        this.props.$five.setState({
          longitude: this.props.$five.currentState.longitude + Math.PI / 360
        });
      }, 16);
    } else {
      delete this.timer;
    }
  }
  render() {
    return <Paper sx={{ position: "fixed", top: 10, right: 10 }}>
    {this.state.active ?
      <IconButton onClick={() => this.toggleActive(false)}><PauseIcon/></IconButton>:
      <IconButton onClick={() => this.toggleActive(true)}><FlipCameraAndroidIcon/></IconButton>
    }
    </Paper>;
  }
});

export { LookAroundController };
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```tsx title="src/2.knowing-state/LookAroundController.tsx"
import React, { Component } from "react";
import { withFive, createFiveFeature, PropTypeOfFiveFeatures } from "@realsee/five/react";
import { compose } from "@wordpress/compose";
import IconButton from "@mui/material/IconButton";
import Paper from "@mui/material/Paper";
import FlipCameraAndroidIcon from "@mui/icons-material/FlipCameraAndroid";
import PauseIcon from "@mui/icons-material/Pause";

const FEATURES = createFiveFeature("currentState", "setState");
type Props = PropTypeOfFiveFeatures<typeof FEATURES>;
type State = { active: boolean };

/**
 * ReactComponent: è‡ªåŠ¨ç¯è§†æŒ‰é’®
 */
const LookAroundController = compose(
  withFive(FEATURES)
)(class extends Component<Props, State> {

  timer?: number;
  state = { active: false };

  toggleActive(active: boolean) {
    window.clearInterval(this.timer);
    this.setState({ active });
    if (active === true) {
      this.timer = window.setInterval(() => {
        this.props.$five.setState({
          longitude: this.props.$five.currentState.longitude + Math.PI / 360
        });
      }, 16);
    } else {
      delete this.timer;
    }
  }
  render() {
    return <Paper sx={{ position: "fixed", top: 10, right: 10 }}>
    {this.state.active ?
      <IconButton onClick={() => this.toggleActive(false)}><PauseIcon/></IconButton>:
      <IconButton onClick={() => this.toggleActive(true)}><FlipCameraAndroidIcon/></IconButton>
    }
    </Paper>;
  }
});

export { LookAroundController };
```

</TabItem>
</Tabs>


### ä½¿ç”¨è‡ªåŠ¨ç¯è§†ç»„ä»¶

æ’å…¥åˆ° **App** æ–‡ä»¶çš„ **FiveProvider** ä¸­

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```jsx title="src/2.knowing-state/App.jsx"
import React, { Component } from "react";
import { compose } from "@wordpress/compose";
import { createFiveProvider, FiveCanvas } from "@realsee/five/react";
import { withFetchWork } from "./withFetchWork";
import { withWindowDimensions } from "./withWindowDimensions";
import { ModeController } from "./ModeController";
// highlight-start
import { LookAroundController } from "./LookAroundController";
// highlight-end

/** work.json çš„æ•°æ® URL */
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

const FiveProvider = createFiveProvider();

const App = compose(
  withFetchWork(workURL),
  withWindowDimensions()
)(class extends Component {
  render() {
    const { work, windowDimensions } = this.props;
    return <FiveProvider initialWork={work}>
      <FiveCanvas width={windowDimensions.width} height={windowDimensions.height}/>
      <ModeController/>;
      // highlight-start
      <LookAroundController/>;
      // highlight-end
    </FiveProvider>;
  }
});

export { App };
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```tsx title="src/2.knowing-state/App.tsx"
import React, { Component } from "react";
import { Work } from "@realsee/five";
import { createFiveProvider, FiveCanvas } from "@realsee/five/react";
import { compose } from "@wordpress/compose";
import { withFetchWork } from "./withFetchWork";
import { withWindowDimensions } from "./withWindowDimensions";
import { ModeController } from "./ModeController";
// highlight-start
import { LookAroundController } from "./LookAroundController";
// highlight-end

/** work.json çš„æ•°æ® URL */
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

const FiveProvider = createFiveProvider();

const App = compose(
  withFetchWork(workURL),
  withWindowDimensions()
)(class extends Component<{work: Work, windowDimensions: { width: number, height: number }}> {
  render() {
    const { work, windowDimensions } = this.props;
    return <FiveProvider initialWork={work}>
      <FiveCanvas width={windowDimensions.width} height={windowDimensions.height}/>
      <ModeController/>
      // highlight-start
      <LookAroundController/>
      // highlight-end
    </FiveProvider>;
  }
});


export { App };
```

</TabItem>
</Tabs>


å›åˆ°ä½ çš„æµè§ˆå™¨æŸ¥çœ‹ï¼Œä¼šå‘ç°ä½ çš„é¡µé¢å³ä¸Šè§’å‡ºç°ä¸€ä¸ªç¯è§†æŒ‰é’®ã€‚ç‚¹å‡»å¯ä»¥è§¦å‘å’Œå…³é—­ç¯è§†ã€‚

çœŸæ˜¯ä¸€ä¸ªä¸é”™çš„åŠŸèƒ½ğŸ¥³ ï¼

## ä¸‹ä¸€ç« èŠ‚ä½ ä¼šå­¦åˆ°

:::tip ä¸‹ä¸€ç« æˆ‘ä»¬å†ä½¿ç”¨ State åšä¸€äº›å¤æ‚çš„åŠŸèƒ½ï¼Œæ·±å…¥ä½“ä¼šä¸€ä¸‹ State çš„èƒ½åŠ›ã€‚

- é€šè¿‡ **State** å®Œæˆç”¨æˆ·æ“ä½œçš„å½•åˆ¶
- é€šè¿‡ **State** è¿˜åŸç”¨æˆ·æ“ä½œç”»é¢

:::
