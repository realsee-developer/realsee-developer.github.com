---
title: æ‰“æ ‡ç­¾
---

> **ä¸Šä¸€ç« å›é¡¾: ä¸‰ç»´ä¸­çš„ç‚¹** <br/>
> ä½ äº†è§£ Five SDK çš„äº‹ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”å°è¯•å¼€å‘äº†å°åº”ç”¨ï¼Œé€šè¿‡ç‚¹å‡»äº‹ä»¶è·å–åˆ°ç‚¹çš„ä¸‰ç»´ä½ç½®ã€‚

:::tip æœ¬ç« ä½ å¯ä»¥å­¦ä¹ åˆ°

 åœ¨ä¸‰ç»´ç©ºé—´ä¸­è®¾ç½®æ ‡ç­¾ã€‚

:::

## å‡†å¤‡å·¥ä½œ
æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç›®å½•ï¼ˆ`src/5.tagging`ï¼‰ä»¥åŠå¯¹åº”çš„ **html** æ–‡ä»¶ ä»¥åŠ **js** æˆ– **ts** æ–‡ä»¶ã€‚
æºå¸¦ç€ä¸Šä¸€ç« çš„ **State** ä»£ç ï¼Œå¤ªè¿‡äºç¹çï¼Œé‚£æˆ‘ä»¬ä» **å±•ç¤ºä¸‰ç»´ç©ºé—´** ç« çš„å†…å®¹çš„åŸºç¡€å¼€å‘ã€‚

```html title="src/5.tagging/index.html"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸‰ç»´ä¸­çš„ç‚¹ | Points in 3d</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    html, body, #app { width: 100%; height: 100%; overflow: hidden; }
  </style>
</head>
<body>
  <div id="app"></div>
  <!-- æ¨¡å¼åˆ‡æ¢ -->
  <nav class="navbar fixed-bottom navbar-light bg-light">
    <div class="container-fluid justify-content-center">
      <div class="btn-group">
        <button class="btn btn-primary active js-Panorama">å…¨æ™¯æ¼«æ¸¸</button>
        <button class="btn btn-primary js-Floorplan">ç©ºé—´æ€»è§ˆ</button>
      </div>
    </div>
  </nav>
  <script type="module" src="./index"></script>
</body>
</html>
```

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```js title="src/5.tagging/index.js"
import { Five, parseWork } from "@realsee/five";

const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

const five = new Five();

five.appendTo(document.querySelector("#app"));

fetch(workURL).then(res => res.json()).then((json) => {
  const work = parseWork(json);
  five.load(work);
});

window.addEventListener("resize", () => five.refresh(), false);

{// === æ¨¡å¼åˆ‡æ¢ ===
  const buttons = {
    "Panorama": document.querySelector(".js-Panorama"),
    "Floorplan": document.querySelector(".js-Floorplan")
  };

  for (const [modeName, element] of Object.entries(buttons)) {
    element.addEventListener("click", () => {
      five.setState({ mode: modeName });
    }, false);
  }

  five.on("stateChange", state => {
    for (const [modeName, element] of Object.entries(buttons)) {
      if (modeName === state.mode) {
        element.classList.add("active");
      } else {
        element.classList.remove("active");
      }
    };
  });
}

export {};
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```ts title="src/5.tagging/index.ts"
import { Five, Mode, parseWork } from "@realsee/five";

const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

const five = new Five();

five.appendTo(document.querySelector("#app")!);

fetch(workURL).then(res => res.json()).then((json) => {
  const work = parseWork(json);
  five.load(work);
});

window.addEventListener("resize", () => five.refresh(), false);

{// === æ¨¡å¼åˆ‡æ¢ ===
  const buttons: Partial<Record<Mode, Element>> = {
    "Panorama": document.querySelector(".js-Panorama")!,
    "Floorplan": document.querySelector(".js-Floorplan")!
  };

  for (const [modeName, element] of Object.entries(buttons)) {
    element.addEventListener("click", () => {
      five.setState({ mode: modeName as Mode });
    }, false);
  }

  five.on("stateChange", state => {
    for (const [modeName, element] of Object.entries(buttons)) {
      if (modeName === state.mode) {
        element.classList.add("active");
      } else {
        element.classList.remove("active");
      }
    };
  });
}

export {};
```

</TabItem>
</Tabs>



å¯åŠ¨æœåŠ¡ `npm run dev`ã€‚ å¹¶è·³è½¬åˆ°å½“å‰é¡µé¢ "http://localhost:3000/src/5.tagging/index.html"ã€‚

:::info
è¯·æŸ¥çœ‹ä½ çš„æ§åˆ¶å°ï¼Œç«¯å£å·ä¼šå› ä¸ºä½ çš„é…ç½®ä»¥åŠå½“å‰ç«¯å£å ç”¨æƒ…å†µå˜æ›´ï¼Œè¯·å·²æ§åˆ¶å°è¾“å‡ºçš„ä¸ºå‡†ã€‚
å¦‚æœä½ ä½¿ç”¨å…¶ä»–å¼€å‘æ„å»ºå·¥å…·ï¼Œè¯·æŒ‰ç…§è‡ªå·±çš„å¼€å‘æ„å»ºå·¥å…·çš„è¦æ±‚å¯åŠ¨æœåŠ¡ã€‚
:::

## å¼€å‘æ‰“æ ‡ç­¾åŠŸèƒ½

### æ·»åŠ æ ‡ç­¾æ ·å¼

åœ¨ **html** æ–‡ä»¶ä¸­æ·»åŠ æ ‡ç­¾æ ·å¼ã€‚
> æ ·å¼å¹¶éæ˜¯å¿…é¡»çš„ï¼Œåªæ˜¯ä¸ºäº†æ ‡ç­¾å¥½çœ‹ä¸€äº›ã€‚

```html title="src/5.tagging/index.html"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å±•ç¤ºç©ºé—´ | Displaying work</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    html, body, #app { width: 100%; height: 100%; overflow: hidden; }
    /* highlight-start */
    /* æ‰“æ ‡ç­¾ */
    .tag { position: absolute; width: 0; height: 0; transform: translateZ(0); }
    .tag-pannel { position: absolute; width: 100px; min-height: 20px; transform: translate(-50%, 0); left: 50%; bottom: 10px; background: #333; color: #fff; border-radius: 2px; text-align: center; line-height: 20px; padding: 8px; font-size: 14px;}
    .tag-pannel:after { content: ""; display: block; position: absolute; width: 10px; height: 10px; left: 50%; bottom: -5px; transform: translate(-50%, 0) rotate(45deg); background: #333; pointer-events: none; }
    /* highlight-end */
  </style>
</head>
<body>
  <div id="app"></div>
  <!-- æ¨¡å¼åˆ‡æ¢ -->
  <nav class="navbar fixed-bottom navbar-light bg-light">
    <div class="container-fluid justify-content-center">
      <div class="btn-group">
        <button class="btn btn-primary active js-Panorama">å…¨æ™¯æ¼«æ¸¸</button>
        <button class="btn btn-primary js-Floorplan">ç©ºé—´æ€»è§ˆ</button>
      </div>
    </div>
  </nav>
  <!-- highlight-start -->
  <!-- æ‰“æ ‡ç­¾ -->
  <div class="card position-fixed m-2 top-0 start-0">
    <button class="btn btn-primary js-add-tag">æ‰“æ ‡ç­¾</button>
  </div>
  <!-- highlight-end -->
  <script type="module" src="./index"></script>
</body>
</html>
```

### project2d è¯´æ˜

æœ¬ç« ä¼šä½¿ç”¨åˆ° [`project2d`](https://unpkg.com/@realsee/five/docs/classes/five.Five.html#project2d) æ–¹æ³•ã€‚ä»–å¯ä»¥å°†ä¸‰ç»´çš„åæ ‡å¯¹åº”åˆ°è€Œä¸ºå±å¹•ã€‚

`five.project2d(vector: THREE.Vector3, testModel: boolean): THREE.Vector2 | null`
1. å°†ä¸€ä¸ªä¸‰ç»´åæ ‡ä¼ å…¥å¯ä»¥å¾—åˆ°ä¸€ä¸ªå±å¹•äºŒç»´åæ ‡, åŸç‚¹åœ¨å·¦ä¸Š, å•ä½ä¸ºåƒç´ ã€‚å¯ä»¥ä½œä¸º `{ left: returnValue.x + "px", top: returnValue.y + "px" }` ç­‰æ–¹å¼ä½¿ç”¨ã€‚
2. å¦‚æœä¸‰ç»´åæ ‡æ— æ³•è®¡ç®—åˆ°å±å¹•ä¸­ï¼ˆæ¯”å¦‚åœ¨èƒŒåæˆ–è€…è¢«é®æŒ¡ï¼‰ï¼Œåˆ™è¿”å› `null`ã€‚
3. ç¬¬äºŒä¸ªå‚æ•° **testModel** ä¸ºæ˜¯å¦è®¡ç®—æ¨¡å‹ç¢°æ’ï¼Œå³è¢«æ¨¡å‹é®æŒ¡çš„åæ ‡æ˜¯å¦ä¸º `null`ã€‚

### ç¼–å†™é€»è¾‘ä»£ç 

1. `newTag` ä¸ºæ–°å¢çŠ¶æ€ä¸‹çš„æ ‡ç­¾ï¼Œéœ€è¦è·Ÿéšé¼ æ ‡ä½ç½®é¢„å®šã€‚
2. `tags` å·²ç»å›ºå®šçš„æ ‡ç­¾ï¼Œè·Ÿéšé•œå¤´ç§»åŠ¨ã€‚
3. `tagToElement` å­˜å‚¨ tag å¯¹åº”çš„ DOM ç»“æ„ã€‚
4. ç›¸æœºç§»åŠ¨è§¦å‘ `cameraUpdate` äº‹ä»¶ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ï¼Œé€šè¿‡ æ ‡ç­¾è°ƒç”¨ `$five.project2d` æ–¹æ³•è·å–å±å¹•ç”»å¸ƒåæ ‡ï¼Œç„¶åé€šè¿‡æ”¹å˜æ ·å¼ï¼Œæ¸²æŸ“å‡ºæ¥ã€‚

åœ¨ **æ¨¡å¼åˆ‡æ¢** çš„ä»£ç åè¿½åŠ ï¼š

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```js title="src/5.tagging/index.js"
{ // === æ‰“æ ‡ç­¾ ===
  const app = document.querySelector("#app");
  const addButton = document.querySelector(".js-add-tag");
  let newTag = null;
  let tags = [];
  const tagToElement = new WeakMap();

  const createTagElement = tag => {
    const div = document.createElement("div");
    div.className = "tag";
    div.style.display = "none";
    div.innerHTML = `<div class="tag-pannel"><span class="tag-content">${tag.label}</span></div>`;
    app.appendChild(div);
    return div;
  };

  const renderTags = () => {
    for (const tag of [newTag, ...tags]) {
      if (!tag) continue;
      if (!tag.position) continue;
      const element = tagToElement.get(tag);
      if (!element) continue;
      const position = five.project2d(tag.position, true);
      if (position === null) {
        element.style.display = "none";
      } else {
        element.style.display = "";
        element.style.left = position.x + "px";
        element.style.top = position.y + "px";
      }
    }
  };

  addButton.addEventListener("click", () => {
    newTag = { label: window.prompt("æ·»åŠ æ ‡ç­¾", "") || "æœªå‘½å" };
    tagToElement.set(newTag, createTagElement(newTag));
  }, false);

  five.on("intersectionOnModelUpdate", intersect => {
    if (newTag) newTag.position = intersect.point;
    renderTags();
  });
  five.on("wantsTapGesture", () => {
    if (newTag && newTag.position) {
      tags.push(newTag);
      newTag = null;
      renderTags();
      return false;
    }
  });
  five.on("cameraUpdate", renderTags);
}
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```ts title="src/5.tagging/index.ts"
{ // === æ‰“æ ‡ç­¾ ===
  type Tag = { position?: THREE.Vector3, label: string };
  const app = document.querySelector("#app")!;
  const addButton = document.querySelector(".js-add-tag")!;
  let newTag: Tag | null = null;
  let tags: Tag[] = [];
  const tagToElement = new WeakMap<Tag, HTMLElement>();

  const createTagElement = (tag: Tag) => {
    const div = document.createElement("div");
    div.className = "tag";
    div.style.display = "none";
    div.innerHTML = `<div class="tag-pannel"><span class="tag-content">${tag.label}</span></div>`;
    app.appendChild(div);
    return div;
  };

  const renderTags = () => {
    for (const tag of [newTag, ...tags]) {
      if (!tag) continue;
      if (!tag.position) continue;
      const element = tagToElement.get(tag);
      if (!element) continue;
      const position = five.project2d(tag.position, true);
      if (position === null) {
        element.style.display = "none";
      } else {
        element.style.display = "";
        element.style.left = position.x + "px";
        element.style.top = position.y + "px";
      }
    }
  };

  addButton.addEventListener("click", () => {
    newTag = { label: window.prompt("æ·»åŠ æ ‡ç­¾", "") || "æœªå‘½å" };
    tagToElement.set(newTag, createTagElement(newTag));
  }, false);

  five.on("intersectionOnModelUpdate", intersect => {
    if (newTag) newTag.position = intersect.point;
    renderTags();
  });
  five.on("wantsTapGesture", () => {
    if (newTag && newTag.position) {
      tags.push(newTag);
      newTag = null;
      renderTags();
      return false;
    }
  });
  five.on("cameraUpdate", renderTags);
}
```

</TabItem>
</Tabs>


å›åˆ°ä½ çš„æµè§ˆå™¨æŸ¥çœ‹ï¼Œä¼šå‘ç°ä½ çš„é¡µé¢å·¦ä¸Šè§’å‡ºç°æ‰“æ ‡ç­¾æŒ‰é’®ï¼Œç‚¹å‡»ï¼Œå¡«å†™æ ‡ç­¾åç§°åï¼Œåç§»åŠ¨é¼ æ ‡ï¼Œåœ¨ä½ éœ€è¦çš„ä½ç½®ç‚¹å‡»ã€‚ä¾¿å¯æ”¾ç½®æ ‡ç­¾ã€‚

å—¯ï¼Œç¡®å®æ˜¯ä¸€ä¸ªå®ç”¨çš„åŠŸèƒ½ğŸ¥³ ã€‚
