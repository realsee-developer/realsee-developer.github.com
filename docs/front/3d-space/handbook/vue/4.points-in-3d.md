---
title: ä¸‰ç»´ç©ºé—´ä¸­çš„ç‚¹
---

> **ä¸Šä¸€ç« å›é¡¾: çŠ¶æ€å½•åˆ¶** <br/>
> - ä½ äº†è§£äº†å¦‚ä½•é€šè¿‡ **State** å®Œæˆæ“ä½œçš„å½•åˆ¶å’Œè¿˜åŸã€‚<br/>
> - ç†Ÿæ‚‰åœ°ä½¿ç”¨ **State** ç›¸å…³çš„æ–¹æ³•å’Œäº‹ä»¶ã€‚

:::tip æœ¬ç« ä½ å¯ä»¥å­¦ä¹ åˆ°

- äº†è§£ Five SDK çš„äº‹ä»¶ç³»ç»Ÿã€‚
- è·å–åˆ°ç‚¹çš„ä¸‰ç»´ä½ç½®ã€‚

:::

## å‡†å¤‡å·¥ä½œ
æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç›®å½•ï¼ˆ`src/4.points-in-3d`ï¼‰ä»¥åŠå¯¹åº”çš„ **html** æ–‡ä»¶ ä»¥åŠ **jsx** æˆ– **tsx** æ–‡ä»¶ã€‚
æºå¸¦ç€ä¸Šä¸€ç« çš„ **State** ä»£ç ï¼Œå¤ªè¿‡äºç¹çï¼Œé‚£æˆ‘ä»¬ä» **å±•ç¤ºä¸‰ç»´ç©ºé—´** ç« çš„å†…å®¹çš„åŸºç¡€å¼€å‘ã€‚

```html title="src/4.points-in-3d/index.html"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¸‰ç»´ä¸­çš„ç‚¹ | Points in 3d</title>
  <style>
    * { margin: 0; padding: 0; }
    html, body #app { width: 100%; height: 100%; overflow: hidden; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script type="module" src="./index"></script>
</body>
</html>
```

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```js title="src/4.points-in-3d/useWindowDimensions.js"
import {ref, onBeforeUnmount} from "vue"

function useWindowDimensions() {
    const width = ref(window.innerWidth);
    const height = ref(window.innerHeight);

    const listener = () => {
        width.value = window.innerWidth;
        height.value = window.innerHeight;
    }

    window.addEventListener("resize", listener, false)
    onBeforeUnmount(() => {
        window.removeEventListener("resize", listener, false)
    })
    return { width , height }
}
export { useWindowDimensions }
```

```vue title="src/4.points-in-3d/ModeController.vue"
<template>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <div class="container-fluid justify-content-center">
            <div class="btn-group">
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary active' : 'btn btn-primary'" @click="() => setState({mode: Five.Mode.Panorama})">å…¨æ™¯æ¼«æ¸¸</button>
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary' : 'btn btn-primary active'" @click="() => setState({mode: Five.Mode.Floorplan}) ">ç©ºé—´æ€»è§ˆ</button>
           </div>
        </div>
  </nav>
</template>

<script setup>

import { useFiveCurrentState } from "@realsee/five/vue";
import { Five } from "@realsee/five";

const [state, setState] = useFiveCurrentState();

</script>
```

```vue title="src/4.points-in-3d/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
        <ModeController />
    </FiveProvider>
</template>

<script setup>

import { FiveProvider, FiveCanvas } from "@realsee/five/vue";
import { parseWork } from "@realsee/five";
import { ref } from "vue";
import { useWindowDimensions } from "./useWindowDimensions";
import ModeController from "./ModeController.vue";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDimensions();
</script>
```

```js title="src/4.points-in-3d/index.js"
import { createApp, h } from 'vue'
import App from "./App.vue"

createApp(App).mount('#app')
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```ts title="src/4.points-in-3d/useWindowDimensions.ts"
import {ref, onBeforeUnmount} from "vue"

function useWindowDimensions() {
    const width = ref<number>(window.innerWidth);
    const height = ref<number>(window.innerHeight);

    const listener = () => {
        width.value = window.innerWidth;
        height.value = window.innerHeight;
    }

    window.addEventListener("resize", listener, false)
    onBeforeUnmount(() => {
        window.removeEventListener("resize", listener, false)
    })
    return { width , height }
}
export { useWindowDimensions }
```

```vue title="src/4.points-in-3d/ModeController.vue"
<template>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <div class="container-fluid justify-content-center">
            <div class="btn-group">
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary active' : 'btn btn-primary'" @click="() => setState({mode: Five.Mode.Panorama})">å…¨æ™¯æ¼«æ¸¸</button>
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary' : 'btn btn-primary active'" @click="() => setState({mode: Five.Mode.Floorplan}) ">ç©ºé—´æ€»è§ˆ</button>
           </div>
        </div>
  </nav>
</template>

<script setup lang="ts">

import { useFiveCurrentState } from "@realsee/five/vue";
import { Five } from "@realsee/five";

const [state, setState] = useFiveCurrentState();

</script>
```

```vue title="src/4.points-in-3d/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
        <ModeController />
    </FiveProvider>
</template>

<script setup lang="ts">

import { FiveProvider, FiveCanvas } from "@realsee/five/vue";
import { parseWork } from "@realsee/five";
import { ref } from "vue";
import { useWindowDimensions } from "./useWindowDimensions";
import ModeController from "./ModeController.vue";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDimensions();
</script>
```

```ts title="src/4.points-in-3d/index.ts"
import { createApp, h } from 'vue'
import App from "./App.vue"

createApp(App).mount('#app')
```

</TabItem>
</Tabs>



å¯åŠ¨æœåŠ¡ `npm run dev`ã€‚ å¹¶è·³è½¬åˆ°å½“å‰é¡µé¢ "http://localhost:3000/src/4.points-in-3d"ã€‚

:::info
è¯·æŸ¥çœ‹ä½ çš„æ§åˆ¶å°ï¼Œç«¯å£å·ä¼šå› ä¸ºä½ çš„é…ç½®ä»¥åŠå½“å‰ç«¯å£å ç”¨æƒ…å†µå˜æ›´ï¼Œè¯·å·²æ§åˆ¶å°è¾“å‡ºçš„ä¸ºå‡†ã€‚
å¦‚æœä½ ä½¿ç”¨å…¶ä»–å¼€å‘æ„å»ºå·¥å…·ï¼Œè¯·æŒ‰ç…§è‡ªå·±çš„å¼€å‘æ„å»ºå·¥å…·çš„è¦æ±‚å¯åŠ¨æœåŠ¡ã€‚
:::

## äº‹ä»¶ç³»ç»Ÿ

åœ¨å±å¹•ä¸Šç‚¹å‡»æ—¶ï¼Œ**five SDK** çš„é»˜è®¤è¡Œä¸ºæ˜¯é€‰æ‹©ç‚¹å‡»ä½ç½®é™„è¿‘æœ€åˆé€‚çš„ **è§‚å¯Ÿç‚¹(observer)** ç§»åŠ¨è¿‡å»ã€‚å¤§éƒ¨åˆ†ç”¨æˆ·çš„åŠ¨ä½œéƒ½æ˜¯å¦‚æ­¤ï¼Œå°±å¥½æ¯”æµè§ˆå™¨å¯¹äº **A æ ‡ç­¾** çš„å¤„ç†é€»è¾‘å¤§å¤šéƒ½æ˜¯é“¾æ¥è·³è½¬ã€‚ä¸Šè¿°å°±æ˜¯ **five SDK** çš„å†…å»º **tapGesture**äº‹ä»¶ã€‚

### å†…å»ºäº‹ä»¶

**five SDK** å†…å»ºçš„äº‹ä»¶æœ‰å¦‚ä¸‹:
- **tapGesture**: é¼ æ ‡å·¦é”®ç‚¹å‡»æˆ–è€…æ‰‹æŒ‡ç‚¹å‡»ã€‚é»˜è®¤è¡Œä¸ºæ˜¯ç‚¹ä½ç§»åŠ¨ï¼›
- **panGesture**: é¼ æ ‡æŒ‰ä½ä¸€æ ‹æˆ–è€…æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ‹–æ‹½ç§»åŠ¨ã€‚ç›¸æœºæ—‹è½¬ï¼ˆTopviewä¸‹æ˜¯ç›¸æœºå¹³ç§»ï¼‰ï¼›
- **pinchGesture**: æ‰‹æŒ‡åŒæŒ‡åšæçš„æ‰‹åŠ¿ã€‚é»˜è®¤è¡Œä¸ºæ˜¯ä¿®æ”¹ç›¸æœºå¯è§†è§’åº¦ï¼›
- **mouseWheel**: é¼ æ ‡æ»šè½®ã€‚é»˜è®¤è¡Œä¸ºæ˜¯ä¿®æ”¹ç›¸æœºå¯è§†è§’åº¦ï¼›
- **gesture**: ä¸Šè¿°çš„ä»»æ„äº‹ä»¶ã€‚

### é˜»æ­¢é»˜è®¤è¡Œä¸º

æ‰€æœ‰äº‹ä»¶å’Œ æµè§ˆå™¨å¯¹äº **A æ ‡ç­¾** çš„å¤„ç†é€»è¾‘ ä¸€æ ·ï¼Œéƒ½å¯ä»¥é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œä½ åªéœ€è¦ç›‘å¬ `wants` å¼€å¤´çš„äº‹ä»¶ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ `return false` å³å¯ã€‚æ¯”å¦‚æƒ³é˜»æ­¢ **tapGesture** çš„é»˜è®¤ç‚¹ä½ç§»åŠ¨è¡Œä¸ºã€‚å¯ä»¥åšå¦‚ä¸‹æ“ä½œã€‚

```js
useFiveEventCallback("wantsTapGesture", () => {
  // highlight-start
  // é˜»æ­¢ tapGesture è§¦å‘
  return false;
  // highlight-end
});
```

å…·ä½“æ¯ä¸ªäº‹ä»¶çš„ API å¯ä»¥æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
- [tapGesture](https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html#tapGesture)
- [panGesture](https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html#panGesture)
- [pinchGesture](https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html#pinchGesture)
- [mouseWheel](https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html#mouseWheel)
- [gesture](https://unpkg.com/@realsee/five/docs/interfaces/five.EventCallback.html#gesture)

## ä» tapGesture è·å–åæ ‡

> æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªç®€å•åŠŸèƒ½ï¼Œç”¨äºæ ‡è®°åœ¨ç”»å¸ƒä¸Šç‚¹å‡»çš„ä¸‰ç»´ä½ç½®ã€‚
> ä½†æ˜¯ä¸ºäº†å’Œ **ç‚¹ä½ç§»åŠ¨** åŠŸèƒ½ä¸å†²çªï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª `Switch` æŒ‰é’®æ¥æ§åˆ¶æ ‡è®°çŠ¶æ€æ˜¯å¦å¼€å¯ã€‚

### å¤´éƒ¨æ·»åŠ ä¾èµ–

æœ¬ç« éœ€è¦ä»‹ç»ä¸€ä¸‹ [three.js](http://threejs.org) äº†ã€‚**three.js** æ˜¯ä¸€ä¸ªä¸‰ç»´å›¾å½¢åº“ï¼Œ**Five SDK** ä½¿ç”¨ **three.js** çš„æ•°å­¦åº“å’Œæ¸²æŸ“å™¨ã€‚æœ¬ç« æ¶‰åŠ **three.js** æœ‰ä¸¤ä¸ªå†…å®¹ï¼Œåœ¨è¿™é‡Œåšä¸€äº›è¯´æ˜ï¼Œä½ ä¸å¿…å®Œå…¨äº†è§£ **three.js**, æˆ‘åšä¸€äº›è¯´æ˜ä½ å°±å¯ä»¥ç†è§£ã€‚

- [`THREE.Vector3`](https://threejs.org/docs/index.html#api/zh/math/Vector3): ä½ å¯ä»¥å°±è®¤ä¸ºæ˜¯ä¸€ä¸ª `{ x: number, y: number, z: number }` çš„ç»“æ„ä½“ï¼Œå¹¶ä¸”å¤šåŠ äº†ä¸€äº›æ•°å­¦æ–¹æ³•ï¼ˆæœ¬æ¬¡ä¸ä¼šç”¨åˆ°æ•°å­¦æ–¹æ³•ï¼Œåªæ˜¯è®°å½•xyzï¼‰
- [`THREE.Raycaster`](https://threejs.org/docs/index.html#api/zh/core/Raycaster): å…‰çº¿æŠ•å°„ç±»ã€‚ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºå±å¹•ä¸Šçš„ä¸€ä¸ªç‚¹å¯¹åº”åˆ°ä¸‰ç»´ç©ºé—´æ˜¯ä¸€æ¡å°„çº¿ã€‚

![REYCASTER](../../../../assets/raycaster.png);

å°„çº¿æœ‰å¾ˆå¤šä½œç”¨ï¼Œæ¯”å¦‚ï¼šé€šè¿‡å°„çº¿å’Œæ¨¡å‹ä¹‹å‰çš„ç›¸äº¤æ€§æ£€æµ‹ï¼Œå°±å¯ä»¥åˆ¤æ–­æ˜¯å¦å¯¹è±¡è¢«é€‰ä¸­ã€‚

### ç¼–å†™ **MarkController** ç»„ä»¶

1. æ·»åŠ ä¸€ä¸ª **MarkController** æ–‡ä»¶ï¼Œç”¨äºç¼–å†™ç»„ä»¶
2. æˆ‘ä»¬é€šè¿‡ **active** Vue Ref å“åº”æ€§API ç»“åˆ v-model æ¥æ§åˆ¶å½“å‰åº”ç”¨æ˜¯å¦åœ¨æ ‡è®°çš„æ¨¡å¼ä¸‹
3. é€šè¿‡ `tapGesture` ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `raycaster`ï¼Œé€šè¿‡ `modelIntersectRaycaster` å¯ä»¥è·å–åˆ°ç„¦ç‚¹ä¿¡æ¯ `intersect`ï¼Œ`intersect.point` å°±æ˜¯äº¤ç‚¹çš„åæ ‡
4. é€šè¿‡ `marks` Vue Ref æ¥å­˜å‚¨æ‰€æœ‰äº¤ç‚¹ï¼Œå¹¶ä¸”å®ç°æ”¶é›†å’Œåˆ é™¤ã€‚

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```vue title="src/4.points-in-3d/MarkController.vue"
<template>
    <div class="card position-fixed m-2 top-0 start-0">
        <div class="form-check form-switch m-2">
        <input class="form-check-input" type="checkbox" v-model="isSwitch">
        <label class="form-check-label" for="flexSwitchCheckDefault">æ ‡è®°</label>
        </div>
        <div class="js-marks" v-if="marks.length > 0">
            <p v-for="(v3, index) in marks" calss="badge bg-primary d-block m-2">
                <span>x={{v3.x.toFixed(2)}} y={{v3.y.toFixed(2)}} z={{v3.z.toFixed(2)}}</span>
                <i class="bi bi-x-circle ms-2" @click="() => {removeMark(index)}"></i>
            </p>
        </div>
    </div>
</template>
<script setup lang="ts">
    import { useFiveEventCallback, useFiveModelIntersectRaycaster } from '@realsee/five/vue';
    import { Raycaster } from 'three';
    import { ref } from 'vue';
    const marks = ref([]);
    const isSwitch = ref(false);
    const raycasterRef = ref(new Raycaster());
    const fiveModelIntersectRaycaster = useFiveModelIntersectRaycaster();
    const intersect = fiveModelIntersectRaycaster(raycasterRef);

    useFiveEventCallback('wantsTapGesture', (raycaster, tapPosition) => {
        if(isSwitch.value) {
            raycasterRef.value = raycaster;
            if(intersect.value[0]?.point) marks.value.push(intersect.value[0]?.point);
            return false;
        }
    })
    
    const removeMark = (index) => {
        marks.value.splice(index, 1);
    }

</script>

```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```vue title="src/4.points-in-3d/MarkController.vue"
<template>
    <div class="card position-fixed m-2 top-0 start-0">
        <div class="form-check form-switch m-2">
        <input class="form-check-input" type="checkbox" v-model="isSwitch">
        <label class="form-check-label" for="flexSwitchCheckDefault">æ ‡è®°</label>
        </div>
        <div class="js-marks" v-if="marks.length > 0">
            <p v-for="(v3, index) in marks" calss="badge bg-primary d-block m-2">
                <span>x={{v3.x.toFixed(2)}} y={{v3.y.toFixed(2)}} z={{v3.z.toFixed(2)}}</span>
                <i class="bi bi-x-circle ms-2" @click="() => {removeMark(index)}"></i>
            </p>
        </div>
    </div>
</template>
<script setup lang="ts">
    import { useFiveEventCallback, useFiveModelIntersectRaycaster } from '@realsee/five/vue';
    import { Raycaster } from 'three';
    import { ref } from 'vue';
    const marks = ref<THREE.Vector3[]>([]);
    const isSwitch = ref(false);
    const raycasterRef = ref<Raycaster>(new Raycaster());
    const fiveModelIntersectRaycaster = useFiveModelIntersectRaycaster();
    const intersect = fiveModelIntersectRaycaster(raycasterRef);

    useFiveEventCallback('wantsTapGesture', (raycaster, tapPosition) => {
        if(isSwitch.value) {
            raycasterRef.value = raycaster;
            if(intersect.value[0]?.point) marks.value.push(intersect.value[0]?.point);
            return false;
        }
    })
    
    const removeMark = (index: number) => {
        marks.value.splice(index, 1);
    }

</script>

```

</TabItem>
</Tabs>


### ä½¿ç”¨æ ‡è®°ç»„ä»¶

æ’å…¥åˆ° **App** æ–‡ä»¶çš„ **FiveProvider** ä¸­


<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```vue title="src/4.points-in-3d/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
        <ModeController />
        <MarkController />
    </FiveProvider>
</template>

<script setup>

import { FiveProvider, FiveCanvas } from "@realsee/five/vue";
import { parseWork } from "@realsee/five"; 
import { ref } from "vue";
import { useWindowDimensions } from "./useWindowDimensions";
import ModeController from "./ModeController.vue";
import MarkController from "./MarkController.vue";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDimensions();
</script>

```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```vue title="src/4.points-in-3d/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
        <ModeController />
        <MarkController />
    </FiveProvider>
</template>

<script setup lang="ts">

import { FiveProvider, FiveCanvas } from "@realsee/five/vue";
import { parseWork, Work } from "@realsee/five"; 
import { ref } from "vue";
import { useWindowDimensions } from "./useWindowDimensions";
import ModeController from "./ModeController.vue";
import MarkController from "./MarkController.vue";

const work = ref<Work>();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDimensions();
</script>

```

</TabItem>
</Tabs>


å›åˆ°ä½ çš„æµè§ˆå™¨æŸ¥çœ‹ï¼Œä¼šå‘ç°ä½ çš„é¡µé¢å·¦ä¸Šè§’å‡ºç°ä¸€ä¸ªé€‰æ‹©å¼€å…³ã€‚æ‰“å¼€å¼€å…³ï¼Œç‚¹å‡»ç”»å¸ƒå†…å®¹ï¼Œä¼šè¾“å‡ºç‚¹å‡»ä½ç½®çš„åæ ‡ã€‚

çœŸæ£’ï¼Œä¸€ä¸‹å­å°±ç†è§£å’Œè·å–åˆ°äº†ä¸‰ç»´åæ ‡ğŸ¥³ ã€‚

## ä¸‹ä¸€ç« èŠ‚ä½ ä¼šå­¦åˆ°

:::tip ä¸‹ä¸€ç« æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç©ºé—´æ ‡ç­¾åŠŸèƒ½ï¼Œä¸è¦é”™è¿‡å“¦ã€‚
:::
