---
title: æ‰“æ ‡ç­¾
---

> **ä¸Šä¸€ç« å›é¡¾: ä¸‰ç»´ä¸­çš„ç‚¹** <br/>
> ä½ äº†è§£ Five SDK çš„äº‹ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”åªæ˜¯äº†å°åº”ç”¨ï¼Œé€šè¿‡ç‚¹å‡»äº‹ä»¶è·å–åˆ°ç‚¹çš„ä¸‰ç»´ä½ç½®ã€‚

:::tip æœ¬ç« ä½ å¯ä»¥å­¦ä¹ åˆ°

åœ¨ä¸‰ç»´ç©ºé—´ä¸­è®¾ç½®æ ‡ç­¾ã€‚

:::

## å‡†å¤‡å·¥ä½œ
æˆ‘ä»¬æ–°å»ºä¸€ä¸ªç›®å½•ï¼ˆ`src/5.tagging`ï¼‰ä»¥åŠå¯¹åº”çš„ **html** æ–‡ä»¶ ä»¥åŠ **js** æˆ– **ts** æ–‡ä»¶ã€‚
æºå¸¦ç€ä¸Šä¸€ç« çš„ **State** ä»£ç ï¼Œå¤ªè¿‡äºç¹çï¼Œé‚£æˆ‘ä»¬ä» **å±•ç¤ºä¸‰ç»´ç©ºé—´** ç« çš„å†…å®¹çš„åŸºç¡€å¼€å‘ã€‚

```html title="src/5.tagging/index.html"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰“æ ‡ç­¾ | Tagging</title>
  <style>
    * { margin: 0; padding: 0; }
    html, body #app { width: 100%; height: 100%; overflow: hidden; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script type="module" src="./index"></script>
</body>
</html>
```


import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```js title="src/5.tagging/useWindowDimensions.js"
import {ref, onBeforeUnmount} from "vue"

function useWindowDemisions() {
    const width = ref(window.innerWidth);
    const height = ref(window.innerHeight);

    const listener = () => {
        width.value = window.innerWidth;
        height.value = window.innerHeight;
    }

    window.addEventListener("resize", listener, false)
    onBeforeUnmount(() => {
        window.removeEventListener("resize", listener, false)
    })
    return { width , height }
}
export { useWindowDemisions }
```

```vue title="src/5.tagging/ModeController.vue"
<template>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <div class="container-fluid justify-content-center">
            <div class="btn-group">
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary active' : 'btn btn-primary'" @click="() => setState({mode: Five.Mode.Panorama})">å…¨æ™¯æ¼«æ¸¸</button>
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary' : 'btn btn-primary active'" @click="() => setState({mode: Five.Mode.Floorplan}) ">ç©ºé—´æ€»è§ˆ</button>
           </div>
        </div>
  </nav>
</template>

<script setup>

import { useFiveCurrentState } from "@realsee/five/vue";
import { Five } from "@realsee/five";

const [state, setState] = useFiveCurrentState();

</script>
```

```vue title="src/5.tagging/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
    </FiveProvider>
</template>

<script setup lang="ts">

import { FiveProvider, FiveCanvas } from "@realsee/five/vue";
import { parseWork } from "@realsee/five";
import { ref } from "vue";
import { useWindowDemisions } from "./useWindowDemisions";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDemisions();
</script>
```

```js title="src/5.tagging/index.js"
import { createApp, h } from 'vue'
import App from "./App.vue"

createApp(App).mount('#app')
```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```ts title="src/5.tagging/useWindowDimensions.ts"
import {ref, onBeforeUnmount} from "vue"

function useWindowDemisions() {
    const width = ref<number>(window.innerWidth);
    const height = ref<number>(window.innerHeight);

    const listener = () => {
        width.value = window.innerWidth;
        height.value = window.innerHeight;
    }

    window.addEventListener("resize", listener, false)
    onBeforeUnmount(() => {
        window.removeEventListener("resize", listener, false)
    })
    return { width , height }
}
export { useWindowDemisions }
```

```vue title="src/5.tagging/ModeController.vue"
<template>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <div class="container-fluid justify-content-center">
            <div class="btn-group">
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary active' : 'btn btn-primary'" @click="() => setState({mode: Five.Mode.Panorama})">å…¨æ™¯æ¼«æ¸¸</button>
                <button :class="state.mode == 'Panorama' ? 'btn btn-primary' : 'btn btn-primary active'" @click="() => setState({mode: Five.Mode.Floorplan}) ">ç©ºé—´æ€»è§ˆ</button>
           </div>
        </div>
  </nav>
</template>

<script setup lang="ts">

import { useFiveCurrentState } from "@realsee/five/vue";
import { Five } from "@realsee/five";

const [state, setState] = useFiveCurrentState();

</script>
```

```vue title="src/5.tagging/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
    </FiveProvider>
</template>

<script setup lang="ts">

import { FiveProvider, FiveCanvas } from "@realsee/five/vue";
import { parseWork } from "@realsee/five";
import { ref } from "vue";
import { useWindowDemisions } from "./useWindowDemisions";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDemisions();
</script>

```

```ts title="src/5.tagging/index.ts"
import { createApp, h } from 'vue'
import App from "./App.vue"

createApp(App).mount('#app')
```

</TabItem>
</Tabs>


å¯åŠ¨æœåŠ¡ `npm run dev`ã€‚ å¹¶è·³è½¬åˆ°å½“å‰é¡µé¢ "http://localhost:3000/src/5.tagging"ã€‚

:::info
è¯·æŸ¥çœ‹ä½ çš„æ§åˆ¶å°ï¼Œç«¯å£å·ä¼šå› ä¸ºä½ çš„é…ç½®ä»¥åŠå½“å‰ç«¯å£å ç”¨æƒ…å†µå˜æ›´ï¼Œè¯·å·²æ§åˆ¶å°è¾“å‡ºçš„ä¸ºå‡†ã€‚
å¦‚æœä½ ä½¿ç”¨å…¶ä»–å¼€å‘æ„å»ºå·¥å…·ï¼Œè¯·æŒ‰ç…§è‡ªå·±çš„å¼€å‘æ„å»ºå·¥å…·çš„è¦æ±‚å¯åŠ¨æœåŠ¡ã€‚
:::

## å¼€å‘æ‰“æ ‡ç­¾åŠŸèƒ½


### useFiveProject2d è¯´æ˜

æœ¬ç« ä¼šä½¿ç”¨åˆ° [`useFiveProject2d`](https://unpkg.com/@realsee/five/docs/modules/vue.html#useFiveProject2d) æ–¹æ³•ã€‚ä»–å¯ä»¥å°†ä¸‰ç»´çš„åæ ‡å¯¹åº”åˆ°äºŒç»´å±å¹•ã€‚

`useFiveProject2d(vector: THREE.Vector3, testModel: boolean): THREE.Vector2 | null`
1. å°†ä¸€ä¸ªä¸‰ç»´åæ ‡ä¼ å…¥å¯ä»¥å¾—åˆ°ä¸€ä¸ªå±å¹•äºŒç»´åæ ‡, åŸç‚¹åœ¨å·¦ä¸Š, å•ä½ä¸ºåƒç´ ã€‚å¯ä»¥ä½œä¸º `{ left: returnValue.x + "px", top: returnValue.y + "px" }` ç­‰æ–¹å¼ä½¿ç”¨ã€‚
2. å¦‚æœä¸‰ç»´åæ ‡æ— æ³•è®¡ç®—åˆ°å±å¹•ä¸­ï¼ˆæ¯”å¦‚åœ¨èƒŒåæˆ–è€…è¢«é®æŒ¡ï¼‰ï¼Œåˆ™è¿”å› `null`;
3. ç¬¬äºŒä¸ªå‚æ•° **testModel** ä¸ºæ˜¯å¦è®¡ç®—æ¨¡å‹ç¢°æ’ï¼Œå³è¢«æ¨¡å‹é®æŒ¡çš„åæ ‡æ˜¯å¦ä¸º `null`ã€‚

### ç¼–å†™ TaggingController

1. æ·»åŠ ä¸€ä¸ª **TaggingController** æ–‡ä»¶ï¼Œç”¨äºç¼–å†™ç»„ä»¶
2. é€šè¿‡ `tags` Vue Reactive å­˜å‚¨æ ‡ç­¾ä½ç½®å’Œæ–‡å­—ã€‚
3. é€šè¿‡ `newTag` Vue Ref å­˜å‚¨å½“å‰æ–°å»ºçš„æ ‡ç­¾ã€‚
4. ç›‘å¬ five çš„ `intersectionOnModelUpdate` äº‹ä»¶ï¼Œå°†æ–°å»ºä¸­çš„æ ‡ç­¾æ”¾åœ¨åœ¨é¼ æ ‡çš„ä½ç½®ã€‚
5. é€šè¿‡ æ ‡ç­¾è°ƒç”¨  **useFiveProject2d** äº§ç”Ÿçš„ `project2d` æ–¹æ³•ï¼ˆ`tagElement` æ–¹æ³•ä¸­ï¼‰è·å–å±å¹•ç”»å¸ƒåæ ‡ï¼Œç„¶åé€šè¿‡æ”¹å˜æ ·å¼ï¼Œæ¸²æŸ“å‡ºæ¥ã€‚
6. æ·»åŠ æ ‡ç­¾æ ·å¼ï¼ˆæ ·å¼å¹¶éå¿…é¡»ï¼Œåªæ˜¯ä¸ºäº†æ ‡ç­¾å¥½çœ‹äº›ï¼‰


<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```vue title="src/5.tagging/TaggingController.vue"
<template>
    <div class="card position-fixed m-2 top-0 start-0">
        <button class="btn btn-primary" @click="addTag">æ‰“æ ‡ç­¾</button>
    </div>
    <div v-for="(tag, index) in tags" class="tag" :style="tagStyle(tag)">
        <div class="tag-pannel">
            <span class="tag-content">{{tag.label}}</span>
        </div>
    </div>
    <div class="tag" :style="newTagStyle(newTag)">
        <div class="tag-pannel">
            <span class="tag-content">{{newTag?.label}}</span>
        </div>
    </div>
</template>
<script setup lang="ts">
import { useFiveEventCallback, useFiveProject2d } from "@realsee/five/vue";
import { ref, Ref, reactive } from "vue";
import { Vector3 } from "three";

    let newTag = ref(null);
    let tags = reactive([]);
    const project2d = useFiveProject2d();

    const intersectPoint = ref(new Vector3(0, 0, 0));

    useFiveEventCallback("intersectionOnModelUpdate", (intersect) => {
        // æ›´æ–°ä¸‰ç»´ç‚¹
        if(newTag.value) {
            intersectPoint.value = intersect.point
            newTag.value.position = intersect.point;
        }
    })

    // ç‚¹å‡»æ›´æ–°æ•°ç»„
    useFiveEventCallback("wantsTapGesture", () => {
        if(newTag.value && newTag.value.position) {
            tags.push(newTag.value);
            newTag.value = null;
            return false;
        }
    })

    const addTag = () => {
        if(!newTag.value) {
            newTag.value = {
                label: window.prompt("æ·»åŠ æ ‡ç­¾", "") || "æœªå‘½å",
                position: new Vector3(0, 0, 0)
            }
        }
    }

    const tagStyle = (tag) => {
        return { 
            left: project2d(tag.position, false).value?.x + 'px',
            top: project2d(tag.position, false).value?.y + 'px'
        }
    }

    const newTagStyle = (tag) => {
        if(tag) {
            return { 
                left: project2d(tag.position, false).value?.x + 'px',
                top: project2d(tag.position, false).value?.y + 'px',
                display: 'block',
            }
        }
        return {
            display: 'none'
        }
    }

</script>
<style>
    .tag {
        position: absolute; 
        width: 0; height: 0; 
        transform: translateZ(0); 
    }

    .tag-pannel {
        position: absolute; 
        width: 100px; 
        min-height: 20px; 
        transform: translate(-50%, 0); 
        left: 50%; 
        bottom: 10px; 
        background: #333; 
        color: #fff; 
        border-radius: 2px; 
        text-align: center; 
        line-height: 20px; 
        padding: 8px; 
        font-size: 14px;
    }

    .tag-pannel:after { 
        content: ""; 
        display: block; 
        position: absolute; 
        width: 10px; 
        height: 10px; 
        left: 50%; 
        bottom: -5px; 
        transform: translate(-50%, 0) rotate(45deg); 
        background: #333; 
        pointer-events: none; 
    }


</style>

```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```vue title="src/5.tagging/TaggingController.vue"
<template>
    <div class="card position-fixed m-2 top-0 start-0">
        <button class="btn btn-primary" @click="addTag">æ‰“æ ‡ç­¾</button>
    </div>
    <div v-for="(tag, index) in tags" class="tag" :style="tagStyle(tag)">
        <div class="tag-pannel">
            <span class="tag-content">{{tag.label}}</span>
        </div>
    </div>
    <div class="tag" :style="newTagStyle(newTag)">
        <div class="tag-pannel">
            <span class="tag-content">{{newTag?.label}}</span>
        </div>
    </div>
</template>
<script setup lang="ts">
import { useFiveEventCallback, useFiveProject2d } from "@realsee/five/vue";
import { ref, Ref, reactive } from "vue";
import { Vector3 } from "three";

    type Tag = {
        position: THREE.Vector3;
        label: string;
    }
    let newTag: Ref<Tag | null> = ref(null);
    let tags: Tag[] = reactive([]);
    const project2d = useFiveProject2d();

    const intersectPoint = ref<Vector3>(new Vector3(0, 0, 0));

    useFiveEventCallback("intersectionOnModelUpdate", (intersect) => {
        // æ›´æ–°ä¸‰ç»´ç‚¹
        if(newTag.value) {
            intersectPoint.value = intersect.point
            newTag.value.position = intersect.point;
        }
    })

    // ç‚¹å‡»æ›´æ–°æ•°ç»„
    useFiveEventCallback("wantsTapGesture", () => {
        if(newTag.value && newTag.value.position) {
            tags.push(newTag.value);
            newTag.value = null;
            return false;
        }
    })

    const addTag = () => {
        if(!newTag.value) {
            newTag.value = {
                label: window.prompt("æ·»åŠ æ ‡ç­¾", "") || "æœªå‘½å",
                position: new Vector3(0, 0, 0)
            }
        }
    }

    const tagStyle = (tag: Tag) => {
        return { 
            left: project2d(tag.position, false).value?.x + 'px',
            top: project2d(tag.position, false).value?.y + 'px'
        }
    }

    const newTagStyle = (tag: Tag | null) => {
        if(tag) {
            return { 
                left: project2d(tag.position, false).value?.x + 'px',
                top: project2d(tag.position, false).value?.y + 'px',
                display: 'block',
            }
        }
        return {
            display: 'none'
        }
    }

</script>
<style>
    .tag {
        position: absolute; 
        width: 0; height: 0; 
        transform: translateZ(0); 
    }

    .tag-pannel {
        position: absolute; 
        width: 100px; 
        min-height: 20px; 
        transform: translate(-50%, 0); 
        left: 50%; 
        bottom: 10px; 
        background: #333; 
        color: #fff; 
        border-radius: 2px; 
        text-align: center; 
        line-height: 20px; 
        padding: 8px; 
        font-size: 14px;
    }

    .tag-pannel:after { 
        content: ""; 
        display: block; 
        position: absolute; 
        width: 10px; 
        height: 10px; 
        left: 50%; 
        bottom: -5px; 
        transform: translate(-50%, 0) rotate(45deg); 
        background: #333; 
        pointer-events: none; 
    }

</style>

```

</TabItem>
</Tabs>

### ä½¿ç”¨æ‰“æ ‡ç­¾ç»„ä»¶

æ’å…¥åˆ° **App** æ–‡ä»¶çš„ **FiveProvider** ä¸­

<Tabs>
<TabItem value="JavaScript" label="JavaScript">

```vue title="src/5.tagging/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
        <ModeController />
        <TaggingController />
    </FiveProvider>
</template>

<script setup>

import { FiveProvider, FiveCanvas } from "@realsee/five/vue"
import { parseWork } from "@realsee/five";
import { ref } from "vue";
import { useWindowDemisions } from "./useWindowDemisions";
import ModeController from "./ModeController.vue";
import TaggingController from "./TaggingController.vue";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDemisions();
</script>

```

</TabItem>
<TabItem value="TypeScript" label="TypeScript">

```vue title="src/5.tagging/App.vue"
<template>
    <FiveProvider :work="work">
        <FiveCanvas :width="width" :height="height" />
        <ModeController />
        <TaggingController />
    </FiveProvider>
</template>

<script setup lang="ts">

import { FiveProvider, FiveCanvas } from "@realsee/five/vue"
import { parseWork } from "@realsee/five";
import { ref } from "vue";
import { useWindowDemisions } from "./useWindowDemisions";
import ModeController from "./ModeController.vue";
import TaggingController from "./TaggingController.vue";

const work = ref();
const workURL = "https://vrlab-public.ljcdn.com/release/static/image/release/five/work-sample/07bdc58f413bc5494f05c7cbb5cbdce4/work.json";

fetch(workURL).then(response => response.text()).then(text => work.value = parseWork(text));
const { width, height } = useWindowDemisions();
</script>
```

</TabItem>
</Tabs>


å›åˆ°ä½ çš„æµè§ˆå™¨æŸ¥çœ‹ï¼Œä¼šå‘ç°ä½ çš„é¡µé¢å·¦ä¸Šè§’å‡ºç°æ‰“æ ‡ç­¾æŒ‰é’®ï¼Œç‚¹å‡»ï¼Œå¡«å†™æ ‡ç­¾åç§°åï¼Œç§»åŠ¨é¼ æ ‡ï¼Œåœ¨ä½ éœ€è¦çš„ä½ç½®ç‚¹å‡»ï¼Œç„¶åæ”¾ç½®æ ‡ç­¾å³å¯ã€‚

å—¯ï¼Œç¡®å®æ˜¯ä¸€ä¸ªå®ç”¨çš„åŠŸèƒ½ğŸ¥³ ã€‚
