{"version":3,"sources":["spaces/Space.jsx","attachments/Minimodel.jsx","utils/getQueryValueByName.js","utils/request.js","liveController/createLiveInstance.js","utils/deviceDetect.js","utils/browser.js","slices/liveSlice.js","slices/spaceSlice/index.js","userHooks/useLiveOperation.js","userHooks/useSpaceState.js","gui/_ui/Barrage/index.js","userHooks/useLiveBroadcast.js","userHooks/useVolumes.js","gui/_ui/EntryButton/index.js","gui/DefaultSpaceUserModeLayout/index.jsx","gui/DefaultSpaceLiveModeLayout/UserInfoPanel.js","gui/_ui/Toast/index.js","gui/DefaultSpaceLiveModeLayout/LiveShareModal.js","gui/DefaultSpaceLiveModeLayout/index.jsx","gui/DecorationSpaceUserModeLayout/index.jsx","gui/DecorationSpaceLiveModeLayout/index.jsx","gui/index.jsx","App.js","app/store.js","serviceWorker.js","index.js"],"names":["FiveContext","React","Space","props","initFive","data","state","five","initOptions","imageOptions","size","textureOptions","maxFps","play","poweredByRealsee","onlyRenderIfNeeds","floorplan","defaultFov","minFov","maxFov","defaultLatitude","defaultLongitude","minLatitude","maxLatitude","Math","PI","plugins","ModelViewPlugin","Five","fiveWrapDom","document","querySelector","spaceRootId","appendTo","load","parseWork","once","setState","on","userAction","onStateChange","JSON","parse","stringify","window","addEventListener","refresh","work","this","prevProps","prevState","snapshot","isSplit","dispose","children","isMain","containerCls","classNames","id","className","Provider","value","defaultProps","withSpace","CustomerComponent","resProps","Consumer","MiniModel","useState","hidden","setHidden","miniModeRef","useRef","useEffect","current","minimodel","height","clientHeight","width","clientWidth","mode","prevMode","onClick","style","display","justifyContent","alignItems","position","top","right","padding","background","ref","getQueryValueByName","param","url","queryArr","split","location","search","slice","queryPair","find","query","isNil","require","URI","getUserId","getRoomDetail","roomCreate","getTicket","getRtcSign","request","rtcInstance","name","params","arguments","length","undefined","requestName","Error","type","relativeUrl","result","fetch","body","method","toUpperCase","then","res","json","code","Object","keys","status","userAgent","navigator","isMiniprogram","test","isIOS","isAndroid","isApp","JSBridgeBrowser","history","back","way","href","shareConfig","a","user_id","catch","e","message","userInfo","userId","getVoiceSign","opts","voice_id","voiceId","room_id","roomId","sdkAppId","Number","voice_app_id","user_identifier","userSig","sign","error","VRWebViewRTC","jsBridge","JSBridgeMiniprogram","JSBridgeApp","BrowserRTC","liveInstance","createLiveReact","__debug__","rtc","liveSlice","createSlice","initialState","roomCode","reducers","setLiveStateToStore","action","assign","payload","extraReducers","builder","actions","getLiveInfo","live","spaceSlice","setSpaceStateToStore","getSpaceState","space","useConnect","useLiveAction","useLiveOperation","exit","connect","useJSBridgeAction","login","getUserInfo","dispatch","useDispatch","liveConnect","userRole","includes","getRoomInfo","ws_url","room_code","wsUrl","getWsUrl","Promise","resolve","force","console","liveExit","liveConnectFromUrl","create_user_role","create_user_id","room_link","user_role","ticket","useKeyframe","useSelfInfo","useSpaceState","spaceState","useSelector","updateState","setSpaceStateKeyframe","selfInfo","useCallback","nextState","permission","sync_frame","noop","unmountStacks","__stackIndex","Barrage","cls","topPositionValue","floor","random","__barrageCreater","content","duration","onClose","restProps","stackIndex","container","createElement","appendChild","unmount","ReactDOM","unmountComponentAtNode","parentNode","removeChild","render","aniDuration","innerWidth","setTimeout","config","forEach","useLiveEventCallback","useRTCEventCallback","EntryButton","text","entryFlag","DefaultSpaceUserModeLayout","liveUrlRef","closeWebView","IconButton","sx","color","fontSize","Box","Input","placeholder","inputRef","log","EmoUserListPanel","styled","div","EmoUserListItem","UserInfoPanel","showEditNickNameBox","setShowEditNickNameBox","nickNameRef","createRef","list","map","item","index","micro_status","current_ws_online","extension","isSelf","canKickOut","change_other_status","volumeItem","volumeLists","isTalking","audioVolume","onForbiddenMicro","Paper","marginRight","autoFocus","defaultValue","nickname","online","onNickNameChange","onKickUser","marginLeft","renderUserList","Toast","__toastCreater","success","LiveShareModal","qrcodeEl","setQrcodeEl","actionShare","Modal","open","evt","currentTarget","backgroundColor","Popover","Boolean","anchorEl","anchorOrigin","vertical","horizontal","Typography","p","shareLink","level","includeMargin","InputBase","disabled","copy","useUserList","DefaultSpaceLiveModeLayout","liveInfo","currentUserList","showGreetBtn","setShowGreetBtn","greetMsgRef","liveBroadcast","broadcast","evtMsg","event_id","useLiveBroadcast","setSelfInfo","showUserInfoPanel","setShowUserInfoPanel","kick","toggleMicro","forbidMicro","userVolumes","useVolumes","setIsTalking","showShareModal","setShowShareModal","handleClose","newNickName","Badge","badgeContent","DecorationSpaceUserMode","setSpaceState","DecorationSpaceLiveModeLayout","Gui","defaultSpacePanel","decorationSpacePanel","MinimodelWithSpace","Minimodel","useReadyState","useWebSocketEventCallback","App","bandHeight","ceil","useBangsHeightState","devicePixelRatio","defaultFiveState","setDefaultFiveState","fiveStateKeyframe","setFiveStateKeyframe","closeLoading","WrapStyle","left","pointerEvents","spaceStateKeyframe","lastKeyframe","key","hasOwnProperty","builtinMsg","BuiltinActionType","RoomClose","UserStatus","UserInfo","UserMicroStatus","UserPermission","wsError","defaultWork","paddingTop","store","configureStore","reducer","spaceReducer","liveReducer","hostname","match","StrictMode","LiveProvider","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.6bd68fdd.chunk.js","sourcesContent":["import * as React from 'react'\nimport { Five, parseWork } from '@realsee/five'\nimport './Space.css'\nimport PropTypes from \"prop-types\";\nimport classNames from \"classnames\";\nimport ModelViewPlugin from '@realsee/dnalogel/libs/ModelViewPlugin'\n\nconst FiveContext = React.createContext(null)\n\nfunction withFive(CustomerComponent) {\n\treturn function WrappedComponent (props) {\n\t\tconst { ...resProps } = props\n\t\treturn <FiveContext.Consumer>\n\t\t\t{ five => five ? <CustomerComponent five={five} {...resProps}/> : <div className=\"null\"></div> }\n\t\t</FiveContext.Consumer>\n\t}\n}\n\nclass Space extends React.Component {\n\tconstructor (props) {\n\t\t\n\t\tsuper(props);\n\t\t\n\t\tthis.state = {\n\t\t\tfive: null,\n\t\t\twork: props.work\n\t\t};\n\t}\n\t\n\tcomponentDidMount (): void {\n\t\tthis.initFive(this.state.work)\n\t}\n\t\n\t\n\tcomponentDidUpdate (prevProps, prevState, snapshot) {\n\t\tif (prevState.work !== this.state.work) {\n\t\t\tthis.initFive(this.state.work)\n\t\t}\n\t\tif (prevProps.state !== this.props.state && this.state.five) {\n\t\t\tthis.state.five.setState(this.props.state, false, false)\n\t\t}\n\t\tif (prevProps.isSplit !== this.props.isSplit && this.state.five) {\n\t\t\tthis.state.five.refresh()\n\t\t}\n\t}\n\t\n\tinitFive = (data) => {\n\t\tif (this.state.five) return\n\t\tconst initOptions = {\n\t\t\timageOptions: { size: 1024 },\n\t\t\ttextureOptions: { size: 512 },\n\t\t\tmaxFps: 70,\n\t\t\tplay: true,\n\t\t\tpoweredByRealsee: true,\n\t\t\tonlyRenderIfNeeds: true,\n\t\t\tfloorplan: {\n\t\t\t\tdefaultFov: 80,\n\t\t\t\tminFov: 60,\n\t\t\t\tmaxFov: 120,\n\t\t\t\tdefaultLatitude: 0,\n\t\t\t\tdefaultLongitude: 0,\n\t\t\t\tminLatitude: 0,\n\t\t\t\tmaxLatitude: Math.PI / 2\n\t\t\t},\n\t\t\tplugins: [[ModelViewPlugin, 'minimodel']]\n\t\t}\n\t\tconst five = new Five(initOptions)\n\t\tconst fiveWrapDom = document.querySelector(`#${this.props.spaceRootId}`)\n\t\tfive.appendTo(fiveWrapDom)\n\t\tfive.load(parseWork(data))\n\t\t\n\t\tfive.once('modelLoaded', () => {\n\t\t\tthis.setState({five: five})\n\t\t})\n\t\tfive.on('stateChange', (state, userAction) => {\n\t\t\tif(!userAction) return\n\t\t\tthis.props.onStateChange(JSON.parse(JSON.stringify(state)))\n\t\t})\n\t\t\n\t\twindow.addEventListener('resize', () => five.refresh(), false)\n\t}\n\t\n\tcomponentWillUnmount () {\n\t\tthis.state.five.dispose()\n\t}\n\t\n\trender () {\n\t\tconst { children, spaceRootId, isMain, isSplit } = this.props\n\t\tconst containerCls = classNames(\"vr-container\", {'main': isMain}, {'split': isSplit})\n\t\t\n\t\treturn (\n\t\t\t<div id={spaceRootId} className={containerCls}>\n\t\t\t\t<FiveContext.Provider value={this.state.five}>\n\t\t\t\t\t{children}\n\t\t\t\t</FiveContext.Provider>\n\t\t\t</div>\n\t\t);\n\t}\n}\nSpace.propTypes = {\n\tchildren: PropTypes.any,\n\tspaceRootId: PropTypes.string.isRequired,\n\twork: PropTypes.any.isRequired,\n\tisMain: PropTypes.bool.isRequired,\n\tisSplit: PropTypes.bool.isRequired,\n\tstate: PropTypes.any,\n\tonStateChange: PropTypes.func\n};\n\nSpace.defaultProps = {\n\tspaceRootId: '',\n\twork: null\n}\n\nSpace.withSpace = withFive\n\nexport default Space;\n","import React from \"react\";\nimport classNames from \"classnames\";\nimport './Minimodel.css'\n\nfunction MiniModel (props) {\n\tconst [hidden, setHidden] = React.useState(false)\n\tconst five = props.five\n\tconst miniModeRef = React.useRef(null)\n\t\n\tconst BoxStyle = {\n\t\tdisplay: 'flex',\n\t\tjustifyContent: 'center',\n\t\talignItems: 'center',\n\t\tposition: \"absolute\",\n\t\ttop: '40px',\n\t\tright: '20px',\n\t\tpadding: '10px',\n\t\twidth: '75px',\n\t\theight: '100px',\n\t\tbackground: 'linear-gradient(transparent, rgba(0, 0, 0, .2))',\n\t}\n\t\n\tReact.useEffect(() => {\n\t\tif (!miniModeRef.current) return\n\t\tconst minimodel = five.plugins.minimodel\n\t\tconst height = miniModeRef.current.clientHeight\n\t\tconst width = miniModeRef.current.clientWidth\n\t\tminimodel.appendTo(miniModeRef.current, { height, width })\n\t}, [five.plugins.minimodel])\n\t\n\tfive.on('modeChange', (mode, prevMode) => {\n\t\tif (mode === 'Floorplan') {\n\t\t\treturn setHidden(true)\n\t\t}\n\t\tsetHidden(false)\n\t})\n\t\n\t\n\treturn (\n\t\t<div className={classNames(\"minimodel-wrap\", {'minimodel-wrap__hidden': hidden})}>\n\t\t\t<div\n\t\t\t\tonClick={() => five.setState({ mode: \"Floorplan\" })}\n\t\t\t\tstyle={{...BoxStyle}}\n\t\t\t\tref={miniModeRef}\n\t\t\t/>\n\t\t</div>\n\t)\n}\n\nexport default MiniModel\n","/**\n * 从 url 中获取指定参数的值\n * */\nconst getQueryValueByName = (param, url) => {\n    let queryArr\n    if (!url) queryArr = window.location.search?.slice(1)?.split('&')\n    else queryArr = url.split('?')[1]?.split('&')\n    if(!queryArr) return ''\n    const queryPair = queryArr.find(query => query.split('=')[0] === param);\n    return queryPair?.split('=')[1] || ''\n}\n\nexport default getQueryValueByName\n","/**\n * 简易的请求封装\n * pro版本：支持并发请求、promise封装\n * */\nconst isNil = require('lodash/isNil')\n\nconst URI = {\n    getUserId: 'get:/demo/auth/login',\n    getRoomDetail: 'post:/demo/live/room/detail',\n    roomCreate: 'post:/demo/live/room/create',\n    getTicket: 'post:/demo/live/apply/ticket',\n    getRtcSign: 'post:/demo/live/voice/sign'\n}\n\n/**\n * @param name: 请求名称\n * @param params: 请求参数\n * */\nfunction request (name, params) {\n    if (arguments.length === 2 && typeof params === 'function') {\n        params = undefined\n    }\n    const requestName = name\n    if (isNil(URI[requestName])) throw new Error('requestName is not defined')\n    const [type, relativeUrl] = (URI[requestName] || requestName).split(':')\n    // const url = `https://test1-ka-vr-demo-developer.realsee.com${relativeUrl}`\n    const url = `https://ka-vr-demo-developer.realsee.com${relativeUrl}`\n    const result = fetch(url, {\n        body: JSON.stringify(params),\n        method: type?.toUpperCase()\n    })\n        .then(res => res.json())\n        .then(res => {\n            if (res.code !== 0 || !Object.keys(res.data).length) {\n                throw Error(res.status)\n            }\n            return res.data\n        })\n    return result\n}\n\nexport default request\n","/**\n * live实例初始化\n * */\nimport { createLiveReact } from \"@realsee/live\";\nimport request from \"../utils/request\";\nimport { isMiniprogram, isApp } from '../utils/deviceDetect'\nimport {JSBridgeApp} from '@realsee/jsbridge-x/lib/app'\nimport { VRWebViewRTC } from \"@realsee/live/lib/RTC/VRWebViewRTC\";\nimport { BrowserRTC } from \"@realsee/live/lib/RTC/BrowserRTC\"\nimport { JSBridgeBrowser } from '../utils/browser'\nimport { JSBridgeMiniprogram } from '@realsee/jsbridge-x/lib/miniprogram'\n\nconst getVoiceSign = async (opts) => {\n    return await request('getRtcSign', {\n        voice_id: opts.voiceId,\n        room_id: opts.roomId,\n        user_id: opts.userId\n    }).then((res) => {\n        return {\n            sdkAppId: Number(res.voice_app_id),\n            userId: res.user_identifier,\n            userSig: res.sign\n        }\n    }).catch((error) => {\n        throw Error(error.message)\n    })\n}\n\nlet rtcInstance\nif (isMiniprogram) {\n    rtcInstance = new VRWebViewRTC({jsBridge: new JSBridgeMiniprogram(), getVoiceSign})\n}\nelse if(isApp) {\n    rtcInstance = new VRWebViewRTC({jsBridge: new JSBridgeApp(), getVoiceSign})\n}\nelse {\n    rtcInstance = new BrowserRTC({jsBridge: new JSBridgeBrowser(), getVoiceSign})\n}\n\n\nconst liveInstance = createLiveReact({\n    __debug__: true,\n    rtc: rtcInstance\n})\n\nexport default liveInstance\n\n\n","/**\n * 检测当前用户使用的设备：ios端？Android端？微信小程序？web？\n * */\n\nconst userAgent = window.navigator.userAgent\n\nconst isMiniprogram = /micromessenger/i.test(userAgent) && /miniprogram/i.test(userAgent)\n\nconst isIOS = /iphone|ipad/i.test(userAgent)\n\nconst isAndroid = /android/i.test(userAgent)\n\nconst isApp = isIOS || isAndroid\n\nexport {\n    isMiniprogram,\n    isIOS,\n    isAndroid,\n    isApp\n}\n","// import JSBridgeProtocol from '@ke/jsbridge-x/lib/typings/JSBridgeProtocol'\nimport request from \"./request\";\n\nexport class JSBridgeBrowser {\n\t\n\t// constructor () {\n\t// \tsuper();\n\t// }\n\t\n\tcloseWebView() {\n\t\treturn window.history.back()\n\t}\n\t\n\t// way表示新起还是覆盖，先支持新起\n\topenWebView(url, way) {\n\t\treturn window.location.href(url)\n\t}\n\t\n\tactionShare(shareConfig) {\n\t\treturn () => {}\n\t}\n\t\n\tasync getUserInfo() {\n\t\tconst res = await request('getUserId')\n\t\t\t.then(data => {\n\t\t\t\treturn data.user_id\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\treturn e.message\n\t\t\t})\n\t\tconst userInfo = {\n\t\t\tuserId: res\n\t\t}\n\t\t\n\t\treturn [userInfo,]\n\t}\n\t\n\tasync login() {\n\t\tconst res = await request('getUserId')\n\t\t\t.then(data => {\n\t\t\t\treturn data.user_id\n\t\t\t})\n\t\t\t.catch(e => {\n\t\t\t\treturn e.message\n\t\t\t})\n\t\t\n\t\treturn res\n\t}\n\t\n\tasync logout() {\n\t\treturn {}\n\t}\n\t\n\tasync closeLoading() {\n\t\treturn {}\n\t}\n\t\n\tasync getBangsHeight() {\n\t\treturn 0\n\t}\n}\n","import {createSlice} from \"@reduxjs/toolkit\";\n\nconst initialState = {\n\tstate: {\n\t\troomCode: ''\n\t}\n}\n\nexport const liveSlice = createSlice({\n\tname: 'live',\n\tinitialState,\n\treducers: {\n\t\t// state的集合体\n\t\tsetLiveStateToStore: (state, action) => {\n\t\t\tstate.state = Object.assign({}, state.state, action.payload)\n\t\t}\n\t},\n\textraReducers: (builder => {})\n})\n\nexport const {\n\tsetLiveStateToStore\n} = liveSlice.actions\n\nexport const getLiveInfo = (state) => state.live.state\n\nexport default liveSlice.reducer\n","import {createSlice} from \"@reduxjs/toolkit\";\n\nconst initialState = {\n    state: {\n        type: 'default',// 'default' | 'decoration'\n        mode: 'user',// 'user' | 'live' | 'tour'\n        split: false\n    }\n}\n\nexport const spaceSlice = createSlice({\n    name: 'space',\n    initialState,\n    reducers: {\n        // state的集合体\n        setSpaceStateToStore: (state, action) => {\n            state.state = Object.assign({}, state.state, action.payload)\n        }\n    },\n    extraReducers: (builder => {})\n})\n\nexport const {\n    setSpaceStateToStore\n} = spaceSlice.actions\n\nexport const getSpaceState = (state) => state.space.state\n\nexport default spaceSlice.reducer\n","import getQueryValueByName from \"../utils/getQueryValueByName\";\nimport liveInstance from '../liveController/createLiveInstance'\nimport request from \"../utils/request\";\nimport { useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport { setLiveStateToStore } from \"../slices/liveSlice\";\nimport { useDispatch } from \"react-redux\";\nimport { isApp } from '../utils/deviceDetect'\nimport { getSpaceState, setSpaceStateToStore } from '../slices/spaceSlice'\n\nconst {\n\tuseConnect,\n\tuseLiveAction\n} = liveInstance\n\nfunction useLiveOperation () {\n \tconst { exit } = useLiveAction()\n\tconst connect = useConnect()\n\tconst { login, getUserInfo } = useJSBridgeAction()\n\tconst dispatch = useDispatch()\n\t\n\tconst getUserId = async () => {\n\t\tif (isApp) { await login() }\n\t\tconst [userInfo, error] = await getUserInfo()\n\t\tif(!userInfo) {\n\t\t\tthrow Error(error?.message || '身份信息获取失败，请重试')\n\t\t}\n\t\treturn userInfo.userId\n\t}\n\t\n\tconst liveConnect = async () => {\n\t\tconst userRole = window.location.search.includes('userRole=audience') ? 'audience' : 'anchor'\n\t\tconst userId = await getUserId()\n\t\tlet wsUrl, roomCode\n\t\tif (userRole === 'anchor') {\n\t\t\tconst [ws_url, room_code] = await getRoomInfo(userId, userRole)\n\t\t\twsUrl = ws_url\n\t\t\troomCode = room_code\n\t\t}\n\t\telse {\n\t\t\troomCode = getQueryValueByName('roomCode')\n\t\t\twsUrl = await getWsUrl(roomCode)\n\t\t}\n\t\treturn Promise.resolve().then(() => {\n\t\t\tdispatch(setLiveStateToStore({roomCode: roomCode}))\n\t\t\tconnect({\n\t\t\t\tforce: true,\n\t\t\t\turl: wsUrl,\n\t\t\t\tgetTicket: async  () => {\n\t\t\t\t\treturn await getTicket({ roomCode, userId, userRole })\n\t\t\t\t}\n\t\t\t})\n\t\t}).catch(error => console.error(error.message))\n\t}\n\t\n\tconst liveConnectFromUrl = async (url) => {\n \t\tconst userRole = getQueryValueByName('userRole', url)\n\t\tconst roomCode = getQueryValueByName('roomCode', url)\n\t\tconst enterLive = getQueryValueByName('enterLive', url)\n\t\tif (!enterLive || !roomCode) return\n\t\tconst userId = await getUserId()\n\t\tconst wsUrl = await getWsUrl(roomCode)\n\t\treturn Promise.resolve().then(() => {\n\t\t\tdispatch(setLiveStateToStore({roomCode: roomCode}))\n\t\t\tconnect({\n\t\t\t\tforce: true, // 不传此参数有bug，已提阳哥\n\t\t\t\turl: wsUrl,\n\t\t\t\tgetTicket: async  () => {\n\t\t\t\t\treturn await getTicket({ roomCode, userId, userRole })\n\t\t\t\t}\n\t\t\t})\n\t\t}).catch(error => console.error(error.message))\n\t}\n\t\n\t// 应该有个callback\n\tconst liveExit = () => {\n\t\treturn Promise.resolve()\n\t\t\t.then(() => exit())\n\t\t\t.then((res) => {\n\t\t\t\tif (res) {\n\t\t\t\t\tdispatch(setSpaceStateToStore({mode: 'user'}))\n\t\t\t\t\tdispatch(setLiveStateToStore({roomCode: ''}))\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthrow Error('退出带看失败')\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(error.message || '退出带看失败')\n\t\t\t})\n\t}\n\t\n\treturn {\n\t\tliveConnect,\n\t\tliveExit,\n\t\tliveConnectFromUrl\n\t}\n}\n\nexport { useLiveOperation };\n\n// 请求房间信息，包括：ws链接，房间号\nexport const getRoomInfo = async (userId, userRole) => {\n\treturn request('roomCreate', {\n\t\tcreate_user_role: userRole,\n\t\tcreate_user_id: userId\n\t}).then((data) => {\n\t\treturn [data.room_link, data.room_id]\n\t}).catch((error) => {\n\t\tthrow Error(error.message || '请求带看房间信息失败')\n\t})\n}\n\n// 查询ws链接\nexport const getWsUrl = async (roomCode) => {\n\treturn request('getRoomDetail', {\n\t\troom_id: roomCode\n\t})\n\t\t.then((data) => {\n\t\t\treturn data.room_link\n\t\t})\n\t\t.catch((error) => {\n\t\t\tthrow Error(error.message || '查询带看房间信息失败')\n\t\t})\n}\n\n// 请求带看门票\nconst getTicket = async ({roomCode, userId, userRole}) => {\n\treturn request('getTicket', {\n\t\troom_id: roomCode,\n\t\tuser_id: userId,\n\t\tuser_role: userRole\n\t})\n\t\t.then((data) => {\n\t\t\treturn data.ticket\n\t\t})\n\t\t.catch((error) => {\n\t\t\tthrow Error(error.message || '获取带看门票失败')\n\t\t})\n}\n","import React from 'react';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getSpaceState, setSpaceStateToStore } from '../slices/spaceSlice'\nimport liveInstance from \"../liveController/createLiveInstance\";\n\nconst { useKeyframe, useSelfInfo } = liveInstance\n// const { useKeyframe } = liveInstance\n\nfunction useSpaceState () {\n\tconst spaceState = useSelector(getSpaceState)\n\tconst dispatch = useDispatch()\n\tconst [state, updateState] = React.useState(spaceState)\n\t// const [spaceStateKeyframe, setSpaceStateKeyframe] = useKeyframe('SpaceState')\n\tconst [, setSpaceStateKeyframe] = useKeyframe('SpaceState')\n\tconst [selfInfo] = useSelfInfo()\n\t\n\tconst setState = React.useCallback((\n\t\tstate,\n\t\tuserAction = true\n\t) => {\n\t\tconst nextState = typeof state === 'function' ? state() : state\n\t\t// 在此处理live发送逻辑\n\t\tif (userAction && spaceState.mode === 'live' && selfInfo?.permission?.sync_frame) { // TODO：在此拿 userInfo 做权限相关校验，会导致update逻辑阻塞 bug\n\t\t\tsetSpaceStateKeyframe(nextState)\n\t\t}\n\t\t\n\t\tdispatch(setSpaceStateToStore(nextState))\n\t\t\n\t}, [dispatch, setSpaceStateKeyframe, spaceState.mode, selfInfo])\n\t\n\tReact.useEffect(() => {\n\t\treturn updateState(spaceState)\n\t}, [spaceState])\n\n\treturn [state, setState]\n}\n\nexport { useSpaceState } ;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport PropTypes from 'prop-types'\nimport './index.css'\nimport classNames from 'classnames'\n\nfunction noop () {}\n\nconst unmountStacks = []\nlet __stackIndex = -1\n\nconst Barrage = props => {\n  const cls = classNames('realsee-design-barrage', props.className)\n  let topPositionValue = Math.floor(Math.random() * 100)\n  if (topPositionValue < 20 || 80 < topPositionValue ) topPositionValue = 50\n  \n  return (\n      <div className={cls} style={{\n        top: `${topPositionValue}%`\n      }}>\n        <div className=\"react-barrage-contain\">\n          {props.children}\n        </div>\n      </div>\n  )\n}\n\nBarrage.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  className: PropTypes.string\n}\n\nconst __barrageCreater = ({ content, duration = 1, onClose = noop, ...restProps }) => {\n  const stackIndex = ++__stackIndex\n  const container = document.createElement('div')\n  document.body.appendChild(container)\n  let unmount = () => {\n    unmount = noop\n    unmountStacks[stackIndex] = null\n    ReactDOM.unmountComponentAtNode(container)\n    container.parentNode.removeChild(container)\n    onClose()\n  }\n\n  unmountStacks[stackIndex] = unmount\n  \n  ReactDOM.render(<Barrage {...restProps}>{content}</Barrage>, container)\n\n  if (duration !== 0) {\n    const aniDuration = window.innerWidth > 768 ? 2 : duration\n    setTimeout(unmount, aniDuration * 10000)\n  }\n  return unmount\n}\n\n/**\n * content: string\n * duration: number\n * */\n\nBarrage.message = (...args) => {\n  const config = {\n    content: args[0],\n    className: 'react-barrage'\n  }\n  if (args[1] !== undefined) {\n    config.duration = args[1]\n  }\n  if (args[2] !== undefined) {\n    config.onClose = args[2]\n  }\n  \n  return __barrageCreater(config)\n  \n}\n\n\nBarrage.unmount = () => {\n  unmountStacks.forEach(unmount => {\n    unmount && unmount()\n  })\n}\n\nexport default Barrage\n","import React from 'react'\nimport liveInstance from \"../liveController/createLiveInstance\";\nimport Barrage from \"../gui/_ui/Barrage\";\n\nconst {\n\tuseSelfInfo,\n\tuseLiveAction,\n\tuseLiveEventCallback\n} = liveInstance\n\n// function useLiveBroadcast (evtId, greetMsg, toUserIds, timeout) {\nfunction useLiveBroadcast (params) {\n\tconst [selfInfo] = useSelfInfo()\n\tconst { broadcast } = useLiveAction()\n\t\n\tuseLiveEventCallback(\"broadcast\", (evtMsg) => {\n\t\tswitch (evtMsg.event_id) {\n\t\t\tcase 'greet':\n\t\t\t\tBarrage.message(evtMsg.data.message)\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tconsole.log('___broadcast__bug__')\n\t\t}\n\t})\n\n\treturn React.useCallback((params) => {\n\t\tbroadcast({\n\t\t\tevent_id: params.event_id,\n\t\t\tdata: {\n\t\t\t\tmessage: `${selfInfo?.extension?.nickname || selfInfo?.id}说：${params.message}`\n\t\t\t}\n\t\t}, [], 0)\n\t}, [params, selfInfo])\n}\n\nexport { useLiveBroadcast }\n","import React from 'react';\nimport liveInstance from \"../liveController/createLiveInstance\";\n\nconst {\n\tuseRTCEventCallback\n} = liveInstance\n\nfunction useVolumes (props) {\n\tconst [state, updateState] = React.useState([])\n\t\n\tuseRTCEventCallback('userVolumes', userVolumes => {\n\t\t// console.log('音量： ', userVolumes)\n\t\tupdateState(userVolumes)\n\t})\n\t\n\treturn state\n}\n\nexport { useVolumes } ;\n","import * as React from 'react';\nimport './index.css'\n\nfunction EntryButton (props) {\n\treturn <div className='btn-wrap' onClick={props.onClick}>\n\t\t{props.text}\n\t</div>\n\t\n};\n\nexport default EntryButton;\n","import * as React from 'react';\nimport './index.css'\nimport { useLiveOperation } from \"../../userHooks\";\nimport { useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport IconButton from '@mui/material/IconButton'\nimport CloseIcon from '@mui/icons-material/Close';\nimport { Box, Input } from \"@mui/material\";\nimport CallIcon from '@mui/icons-material/Call';\nimport EntryButton from \"../_ui/EntryButton\";\n\nconst entryFlag = window.location.search.includes('userRole=audience')\n\nconst DefaultSpaceUserModeLayout = () => {\n    const { liveConnect, liveConnectFromUrl } = useLiveOperation()\n    const { closeWebView } = useJSBridgeAction()\n    const liveUrlRef = React.createRef()\n    \n    function handleClose() {\n        Promise.resolve().then(() => closeWebView())\n    }\n    \n    function onLiveOpen() {\n        if(!liveUrlRef.current.value) {\n            console.log('输入有误')\n            return\n        }\n        liveConnectFromUrl(liveUrlRef.current.value)\n    }\n\n    return <div className='default__user'>\n        <div className=\"gui__top\" >\n            <div className=\"gui__top--bar\">\n                {/*<IconButton onClick={handleClose} className=\"close btn\" sx={{color: 'white', pointerEvents: 'auto'}}><CloseIcon/></IconButton>*/}\n                <IconButton className=\"title btn\" sx={{color: 'white', fontSize: '16px'}}>如视开发者中心示例--user态</IconButton>\n                {/*<IconButton></IconButton>*/}\n            </div>\n        </div>\n        <div className=\"gui__overlay\">\n            {/* 一些面板 */}\n            <div className=\"scene-overlay\">\n            \n            </div>\n        </div>\n        <div className=\"gui__bottom\">\n            <div className='controls'>\n             <div className='collapsible-list'>\n                 <div className='collapsible-item'>\n                     {\n                         entryFlag\n                             ? <Box>\n                                 <Input type=\"text\" placeholder=\"请输入带看链接\" inputRef={liveUrlRef} />\n                                 <IconButton\n                                     sx={{color: 'white'}}\n                                     onClick={onLiveOpen}\n                                 ><CallIcon /></IconButton>\n                             </Box>\n                             : <Box\n                                 className='live--open'\n                                 onClick={() => liveConnect()}\n                                 sx={{display: 'flex', justifyContent: 'center'}}\n                             ><EntryButton text='进入带看'/></Box>\n                     }\n                 </div>\n             </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DefaultSpaceUserModeLayout;\n","// 参与人员列表面板\nimport styled from \"@emotion/styled\";\nimport React from \"react\";\nimport { Input, Paper } from \"@mui/material\";\nimport classNames from \"classnames\";\nimport PersonRemoveIcon from '@mui/icons-material/PersonRemove';\nimport MicIcon from '@mui/icons-material/Mic';\nimport MicOffIcon from \"@mui/icons-material/MicOff\";\nimport MicNoneIcon from '@mui/icons-material/MicNone'\n\nconst EmoUserListPanel = styled.div`\n  max-height: 200px;\n  display: flex;\n  flex-flow: column;\n  overflow-y: auto;\n  font-size: 12px;\n  pointer-events: auto;\n`\nconst EmoUserListItem = styled.div`\n  display: flex;\n  flex-flow: row wrap;\n  align-items: center;\n  padding: 4px 0;\n  pointer-events: auto;\n  \n  > span {\n    display: flex;\n  }\n  \n  & > .role {\n    padding-left: 4px;\n    padding-right: 4px;\n    border-radius: 2px;\n    background-color: #5a6268;\n    color: white;\n  }\n\n  & > .self-tag {\n    color: darkorange;\n  }\n  \n  & > .nickname {\n    color: white;\n  }\n\n  & > .nickname.self-name {\n    color: greenyellow;\n  }\n\n  & > .btn {\n    color: darkorange;\n    cursor: pointer;\n  }\n\n  & > .edit-btn-groups {\n    display: inline-flex;\n  }\n\n  & > .status {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background-color: #5a6268;\n\n    &.online {\n      background-color: aquamarine;\n    }\n  }\n`\n\nconst UserInfoPanel = (props) => {\n\tconst [showEditNickNameBox, setShowEditNickNameBox] = React.useState(false)\n\tconst nickNameRef = React.createRef()\n\t\n\t//  麦克风开关还未更新，先禁用。\n\tconst renderUserList = (userInfo, index) => {\n\t\tconst { id, micro_status, current_ws_online, permission, extension, user_role } = userInfo\n\t\tconst isSelf = id === props.selfInfo.id\n\t\tconst canKickOut = !isSelf && current_ws_online && permission?.change_other_status\n\t\tconst volumeItem = props.volumeLists.find(item => id === item.id)\n\t\tconst isTalking = !!(volumeItem && volumeItem.audioVolume >= 10)\n\t\tlet userRole = ''\n\t\tif(user_role === 'anchor') userRole = '主持人'\n\t\telse if (user_role === 'audience') userRole = '观众'\n\t\t\n\t\treturn (\n\t\t\t<EmoUserListItem className=\"user-list-item\" key={index}>\n\t\t\t\t<span onClick={() => props.onForbiddenMicro(id)}>\n                    <Paper sx={{\n\t                    display: 'flex',\n\t                    marginRight: '2px'\n                    }}>\n                        { isTalking ? <MicIcon fontSize=\"small\" color='primary'/> : micro_status ? <MicNoneIcon fontSize=\"small\" /> : <MicOffIcon fontSize=\"small\" /> }\n                    </Paper>\n                </span>\n\t\t\t\t<span className='role'>{userRole}</span>\n\t\t\t\t{isSelf && <span className=\"self-tag\">[自己]</span>}\n\t\t\t\t{isSelf && showEditNickNameBox\n\t\t\t\t\t? <Input className='nickname'\n                        autoFocus={true}\n                        defaultValue=''\n                        type='text'\n                        inputRef={nickNameRef} />\n\t\t\t\t\t: <span className={classNames('nickname', {\"self-name\": isSelf})}>{extension?.nickname || id}</span>}\n\t\t\t\t<span className={classNames('status', {online: current_ws_online})} />\n\t\t\t\t{isSelf && !showEditNickNameBox && <span onClick={() => setShowEditNickNameBox(true)} className=\"edit-nickname btn\">[修改昵称]</span>}\n\t\t\t\t{isSelf && showEditNickNameBox && <span className='edit-btn-groups btn'>\n\t\t\t                <span onClick={() => {\n\t\t\t\t                setShowEditNickNameBox(false)\n\t\t\t\t                props.onNickNameChange(nickNameRef.current?.value)\n\t\t\t                }} className=\"submit-nickname btn\">[提交修改]</span>\n\t\t\t                <span onClick={() => setShowEditNickNameBox(false)} className=\"exit-edit-nickname btn\">[退出]</span>\n\t\t                </span>}\n\t\t\t\t{canKickOut && <span onClick={() => props.onKickUser(id)}>\n                    <Paper sx={{ display: 'flex', marginLeft: '2px' }}>\n                        <PersonRemoveIcon fontSize=\"small\"/>\n                    </Paper>\n                </span>}\n\t\t\t</EmoUserListItem>\n\t\t)\n\t}\n\t\n\treturn (\n\t\t<div className=\"user-info\">\n\t\t\t<EmoUserListPanel className=\"user-list-panel\">\n\t\t\t\t{props.list && props.list.map((item, index) => renderUserList(item, index))}\n\t\t\t</EmoUserListPanel>\n\t\t</div>\n\t)\n}\n\nexport default UserInfoPanel\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport PropTypes from 'prop-types'\nimport './index.css'\nimport classNames from 'classnames'\n\nfunction noop () {}\n\nconst unmountStacks = []\nlet __stackIndex = -1\n\nconst Toast = props => {\n  const cls = classNames('realsee-design-toast', props.className)\n  \n  return (\n      <div className={cls}>\n        <div className=\"react-toast-contain\">\n          {props.children}\n        </div>\n      </div>\n  )\n}\n\nToast.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  className: PropTypes.string\n}\n\nconst __toastCreater = ({ content, duration = 1.5, onClose = noop, ...restProps }) => {\n  const stackIndex = ++__stackIndex\n  const container = document.createElement('div')\n  document.body.appendChild(container)\n  let unmount = () => {\n    unmount = noop\n    unmountStacks[stackIndex] = null\n    ReactDOM.unmountComponentAtNode(container)\n    container.parentNode.removeChild(container)\n    onClose()\n  }\n\n  unmountStacks[stackIndex] = unmount\n  \n  ReactDOM.render(<Toast {...restProps}>{content}</Toast>, container)\n\n  if (duration !== 0) {\n    setTimeout(unmount, duration * 1000)\n  }\n  return unmount\n}\n\nToast.error = (...args) => {\n  const config = {\n    content: args[0],\n    className: 'react-toast-error'\n  }\n  if (args[1] !== undefined) {\n    config.duration = args[1]\n  }\n  if (args[2] !== undefined) {\n    config.onClose = args[2]\n  }\n  return __toastCreater(config)\n}\n\nToast.success = (...args) => {\n  const config = {\n    content: args[0],\n    className: 'react-toast-success'\n  }\n  if (args[1] !== undefined) {\n    config.duration = args[1]\n  }\n  if (args[2] !== undefined) {\n    config.onClose = args[2]\n  }\n  return __toastCreater(config)\n}\n\nToast.unmount = () => {\n  unmountStacks.forEach(unmount => {\n    unmount && unmount()\n  })\n}\n\nexport default Toast\n","import React from 'react';\nimport { Box, IconButton, InputBase, Modal, Popover, Typography } from \"@mui/material\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport QrCodeScannerIcon from \"@mui/icons-material/QrCodeScanner\";\nimport QRCode from \"qrcode.react\";\nimport copy from \"copy-to-clipboard\";\nimport LinkIcon from '@mui/icons-material/Link';\nimport { isMiniprogram } from \"../../utils/deviceDetect\";\nimport { useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport Toast from '../_ui/Toast'\n\nfunction LiveShareModal (props) {\n\tconst [qrcodeEl, setQrcodeEl] = React.useState(null)\n\tconst [miniprogramEl, setMiniprogramEl] = React.useState(null)\n\tconst { actionShare } = useJSBridgeAction()\n\t\n\tconst handleQrcodeOpen = (evt) => {\n\t\tsetQrcodeEl(evt.currentTarget)\n\t}\n\t\n\tconst handleQrcodeClose = () => {\n\t\tsetQrcodeEl(null)\n\t}\n\t\n\tconst handleMiniprogramOpen = (evt) => {\n\t\tif (!isMiniprogram) return\n\t\tactionShare(props.shareConfig)\n\t\tsetMiniprogramEl(evt.currentTarget)\n\t}\n\t\n\tconst handleMiniprogramClose = () => {\n\t\tsetMiniprogramEl(null)\n\t}\n\t\n\tconst handleCopyLink = () => {\n\t\tcopy(props.shareConfig.shareLink)\n\t\tToast.success('操作成功')\n\t}\n\t\n\tconst handleClose = () => {\n\t\tprops.onClose()\n\t}\n\t\n\t// TODO 抽象icon share\n\treturn (\n\t\t<Modal open={props.open}>\n\t\t\t<div className=\"modal__wrap\">\n\t\t\t\t<div className=\"modal__header\">\n\t\t\t\t\t<div className=\"share\">分享</div>\n\t\t\t\t\t<IconButton onClick={handleClose} className=\"close\" sx={{color: 'black'}}><CloseIcon fontSize=\"small\" /></IconButton>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"modal__body\">\n\t\t\t\t\t<div className=\"link-icon-list\">\n\t\t\t\t\t\t<Box>\n\t\t\t\t\t\t\t<IconButton onClick={handleQrcodeOpen} sx={{backgroundColor: '#f1f3f4', color: 'black'}}><QrCodeScannerIcon/></IconButton>\n\t\t\t\t\t\t\t<Popover\n\t\t\t\t\t\t\t\topen={Boolean(qrcodeEl)}\n\t\t\t\t\t\t\t\tanchorEl={qrcodeEl}\n\t\t\t\t\t\t\t\tonClose={handleQrcodeClose}\n\t\t\t\t\t\t\t\tanchorOrigin={{\n\t\t\t\t\t\t\t\t\tvertical: 'center',\n\t\t\t\t\t\t\t\t\thorizontal: 'center'\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Typography sx={{ p: 2 }}>\n\t\t\t\t\t\t\t\t\t<QRCode\n\t\t\t\t\t\t\t\t\t\tvalue={props.shareConfig.shareLink}\n\t\t\t\t\t\t\t\t\t\tlevel='H'\n\t\t\t\t\t\t\t\t\t\tincludeMargin={true}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t</Box>\n\t\t\t\t\t\t{/* bridge分享 api 暂不支持,先隐藏 */}\n\t\t\t\t\t\t{/*{isMiniprogram && <Box sx={{marginLeft: '10px'}}>*/}\n\t\t\t\t\t\t{/*\t<IconButton onClick={handleMiniprogramOpen} sx={{backgroundColor: '#f1f3f4', color: 'black'}}><LinkIcon/></IconButton>*/}\n\t\t\t\t\t\t{/*\t<Popover*/}\n\t\t\t\t\t\t{/*\t\topen={Boolean(miniprogramEl)}*/}\n\t\t\t\t\t\t{/*\t\tanchorEl={miniprogramEl}*/}\n\t\t\t\t\t\t{/*\t\tonClose={handleMiniprogramClose}*/}\n\t\t\t\t\t\t{/*\t\tanchorOrigin={{*/}\n\t\t\t\t\t\t{/*\t\t\tvertical: 'center',*/}\n\t\t\t\t\t\t{/*\t\t\thorizontal: 'center'*/}\n\t\t\t\t\t\t{/*\t\t}}*/}\n\t\t\t\t\t\t{/*\t>*/}\n\t\t\t\t\t\t{/*\t\t<Typography sx={{ p: 2 }}>*/}\n\t\t\t\t\t\t{/*\t\t\t<div className=\"tip\">*/}\n\t\t\t\t\t\t{/*\t\t\t\t<p>点击屏幕右上角'...'</p>*/}\n\t\t\t\t\t\t{/*\t\t\t\t<p>即可分享带看</p>*/}\n\t\t\t\t\t\t{/*\t\t\t</div>*/}\n\t\t\t\t\t\t{/*\t\t</Typography>*/}\n\t\t\t\t\t\t{/*\t</Popover>*/}\n\t\t\t\t\t\t{/*</Box>}*/}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Box className=\"link-copy link-content\" >\n\t\t\t\t\t\t<InputBase\n\t\t\t\t\t\t\tdisabled={true}\n\t\t\t\t\t\t\tclassName=\"link\"\n\t\t\t\t\t\t\tvalue={props.shareConfig.shareLink}\n\t\t\t\t\t\t\tsx={{padding: '0 4px'}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\tonClick={handleCopyLink}\n\t\t\t\t\t\t\tclassName=\"copy\" sx={{fontSize: '16px', color: 'black'}}>复制</IconButton>\n\t\t\t\t\t</Box>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"modal__footer\"></div>\n\t\t\t</div>\n\t\t</Modal>\n\t);\n}\n\nexport default LiveShareModal;\n","import * as React from 'react';\nimport { useLiveOperation } from '../../userHooks'\nimport './index.css'\nimport liveInstance from \"../../liveController/createLiveInstance\";\nimport ShareIcon from '@mui/icons-material/Share';\nimport PeopleIcon from '@mui/icons-material/People';\nimport ChatIcon from '@mui/icons-material/Chat';\nimport MicIcon from '@mui/icons-material/Mic';\nimport MicOffIcon from \"@mui/icons-material/MicOff\";\nimport SendIcon from '@mui/icons-material/Send'\nimport { Input, Badge, IconButton } from '@mui/material'\nimport { useLiveBroadcast } from \"../../userHooks\";\nimport UserInfoPanel from \"./UserInfoPanel\";\nimport CloseIcon from '@mui/icons-material/Close';\nimport LiveShareModal from \"./LiveShareModal\";\nimport { useVolumes } from '../../userHooks'\nimport { useSelector } from \"react-redux\";\nimport { getLiveInfo } from \"../../slices/liveSlice\";\nimport CallEndIcon from '@mui/icons-material/CallEnd';\nimport Toast from \"../_ui/Toast\";\n\nconst {\n    useSelfInfo,\n    useUserList,\n    useLiveAction,\n    useRTCEventCallback\n} = liveInstance\n\nconst DefaultSpaceLiveModeLayout = () => {\n    const { liveExit } = useLiveOperation()\n    const liveInfo = useSelector(getLiveInfo)\n    const currentUserList = useUserList()\n    const [showGreetBtn, setShowGreetBtn] = React.useState(true)\n    const greetMsgRef = React.createRef()\n    const liveBroadcast = useLiveBroadcast()\n    const [selfInfo, setSelfInfo] = useSelfInfo()\n    const [showUserInfoPanel, setShowUserInfoPanel] = React.useState(false)\n    const { kick, toggleMicro, forbidMicro } = useLiveAction()\n    const userVolumes = useVolumes()\n    const [isTalking, setIsTalking] = React.useState(false)\n    const [showShareModal, setShowShareModal] = React.useState(false)\n    \n    React.useEffect(() => {\n        if(!selfInfo) return\n        if(!userVolumes.length) return\n        const volumeItem = userVolumes.find(item => selfInfo.id === item.userId)\n        const isTalking = !!(volumeItem && volumeItem.audioVolume >= 10)\n        setIsTalking(isTalking)\n    }, [userVolumes])\n    \n    useRTCEventCallback(\"joined\", () => {\n        console.log('rtc -- joined')\n    })\n    \n    useRTCEventCallback(\"error\", (error) => {\n        console.log('rtc -- error: ', error.message)\n    })\n    \n    const handleShareLive = () => {\n        setShowShareModal(true)\n    }\n    \n    const handleClose = () => {\n        liveExit().then(() => {\n            Toast.success('退出带看')\n        })\n    }\n    \n    return <div className=\"default__live\">\n        <div className=\"gui__top\">\n            <div className=\"gui__top--bar\">\n                <IconButton className=\"close btn\" sx={{color: 'white'}} onClick={handleClose}><CloseIcon /></IconButton>\n                <IconButton className=\"title btn\" sx={{color: 'white', fontSize: '16px'}}>如视开发者中心示例--live态</IconButton>\n                <IconButton className=\"share btn\" sx={{color: 'white'}} onClick={() => handleShareLive()}><ShareIcon/></IconButton>\n            </div>\n        </div>\n        <div className=\"gui__overlay\">\n            <div className=\"scene-overlay\">\n                <LiveShareModal\n                    open={showShareModal}\n                    onClose={() => setShowShareModal(false)}\n                    shareConfig={{ shareLink: `${window.location.href.split('?')[0]}?userRole=audience&roomCode=${liveInfo.roomCode}&enterLive=true` }}\n                />\n                {\n                    showUserInfoPanel && <div className=\"overlay-modal\">\n                        <IconButton className=\"icon-close\" onClick={() => setShowUserInfoPanel(false)}><CloseIcon/></IconButton>\n                        <UserInfoPanel\n                            list={currentUserList}\n                            selfInfo={selfInfo}\n                            volumeLists={userVolumes}\n                            onForbiddenMicro={(userId) => forbidMicro('CLOSE', userId)}\n                            onKickUser={(userId) => kick(userId)}\n                            onNickNameChange={(newNickName) => setSelfInfo({'nickname': newNickName})}\n                        />\n                    </div>\n                }\n            </div>\n        </div>\n        <div className=\"gui__bottom\">\n            <div className='controls'>\n                <div className='collapsible-list'>\n                    <div className='collapsible-item'>\n                        <IconButton sx={{color: 'white'}} className=\"members\" onClick={() => setShowUserInfoPanel(true)}>\n                            <Badge color=\"primary\" badgeContent={currentUserList && currentUserList.length}><PeopleIcon/></Badge>\n                        </IconButton>\n                        {\n                            showGreetBtn\n                                ? <IconButton sx={{color: 'white'}} className=\"greet\" onClick={() => setShowGreetBtn(false)}><ChatIcon/></IconButton>\n                                : <div className=\"greet\">\n                                    <Input type=\"text\" placeholder=\"说点什么吧\" inputRef={greetMsgRef} />\n                                    <IconButton\n                                        sx={{color: 'white'}}\n                                        onClick={() => {\n                                            liveBroadcast({\n                                                event_id: 'greet',\n                                                message: greetMsgRef.current?.value\n                                            })\n                                            setShowGreetBtn(true)\n                                        }}\n                                    ><SendIcon /></IconButton>\n                                </div>\n                        }\n                        <IconButton sx={{color: 'white'}} className=\"micro\" onClick={() => toggleMicro(!selfInfo.micro_status)}>\n                            { selfInfo?.micro_status ? (isTalking ? <MicIcon color='primary'/> : <MicIcon />) : <MicOffIcon/> }\n                        </IconButton>\n                        <IconButton sx={{color: 'white'}} className=\"close\" onClick={handleClose}><CallEndIcon/></IconButton>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DefaultSpaceLiveModeLayout;\n","import * as React from 'react';\nimport './index.css'\nimport { useSpaceState } from \"../../userHooks\";\n\n\nconst DecorationSpaceUserMode = () => {\n    const setSpaceState = useSpaceState()[1]\n\n    return <div className=\"panel decoration-space-panel__bottom-user\">\n        <div className='bottom'>\n            <div className='controls'>\n                <div className='collapsible-list'>\n                    <div className='collapsible-item'>\n                        <span>decoration -- user</span>\n                        <button onClick={() => setSpaceState({ type: 'default' })}>switch to default space</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DecorationSpaceUserMode;\n","import * as React from 'react';\nimport { useLiveOperation, useSpaceState } from '../../userHooks'\nimport './index.css'\n\nconst DecorationSpaceLiveModeLayout = () => {\n    const { liveExit } = useLiveOperation()\n    const setSpaceState = useSpaceState()[1]\n\n    return <div className=\"panel decoration-space-panel__bottom--live\">\n        <div className='bottom'>\n            <div className='controls'>\n                <div className='collapsible-list'>\n                    <div className='collapsible-item'>\n                        <span>decoration -- live</span>\n                        <button onClick={() => setSpaceState({ type: 'default' } )}>switch to default space</button>\n                        <button onClick={() => liveExit()}>exit live</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n};\n\nexport default DecorationSpaceLiveModeLayout;\n","import * as React from 'react';\nimport './index.css'\nimport DefaultSpaceUserModeLayout from './DefaultSpaceUserModeLayout'\nimport DefaultSpaceLiveModeLayout from \"./DefaultSpaceLiveModeLayout\";\nimport DecorationSpaceUserMode from \"./DecorationSpaceUserModeLayout\";\nimport DecorationSpaceLiveMode from './DecorationSpaceLiveModeLayout'\nimport { useSpaceState } from \"../userHooks\";\n\nconst Gui = () => {\n    const [spaceState] = useSpaceState()\n    \n    const renderDefaultSpaceUserMode = () => <DefaultSpaceUserModeLayout/>\n    const renderDefaultSpaceLiveMode = () => <DefaultSpaceLiveModeLayout/>\n\n    const renderDefaultSpaceTourMode = () => {\n        return <div className=\"panel default-space-panel__bottom--tour\">default -- tour</div>\n    }\n\n    const renderDecorationSpaceUserMode = () => <DecorationSpaceUserMode/>\n\n    const renderDecorationSpaceLiveMode = () => <DecorationSpaceLiveMode/>\n\n    const renderDecorationSpaceTourMode = () => {\n        return <div className=\"panel decoration-space-panel__bottom--tour\">decoration -- tour</div>\n    }\n\n    switch(spaceState.type){\n        case 'default':\n            return defaultSpacePanel()\n        case 'decoration':\n            return decorationSpacePanel()\n        default:\n            return null\n    }\n\n    function defaultSpacePanel () {\n        switch (spaceState.mode) {\n            case 'user':\n                return renderDefaultSpaceUserMode()\n            case 'live':\n                return renderDefaultSpaceLiveMode()\n            case 'tour':\n                return renderDefaultSpaceTourMode()\n            default:\n                return null\n        }\n    }\n\n    function decorationSpacePanel () {\n        switch (spaceState.mode) {\n            case 'user':\n                return renderDecorationSpaceUserMode()\n            case 'live':\n                return renderDecorationSpaceLiveMode()\n            case 'tour':\n                return renderDecorationSpaceTourMode()\n            default:\n                return null\n        }\n    }\n};\n\nexport default Gui;\n","import React from 'react';\nimport './App.css';\nimport Space from './spaces/Space'\nimport Minimodel from \"./attachments/Minimodel\";\nimport { useLiveOperation, useSpaceState } from \"./userHooks\";\nimport Gui from './gui'\nimport liveInstance from \"./liveController/createLiveInstance\";\n// import { WebSocketState } from \"@realsee/live/lib/typings/WebSocket\";\nimport { setSpaceStateToStore } from \"./slices/spaceSlice\";\nimport { useDispatch } from \"react-redux\";\nimport { isApp } from './utils/deviceDetect'\nimport { useBangsHeightState, useJSBridgeAction } from \"@realsee/jsbridge-x/lib/react/hooks\";\nimport { Box } from '@mui/material'\nimport Barrage from \"./gui/_ui/Barrage\";\nimport Toast from './gui/_ui/Toast'\nimport { BuiltinEventType, BuiltinActionType, BuiltinMsg } from \"@realsee/live/lib/typings/LiveMsg\";\nimport { work as defaultWork } from '@realsee/open-works/virtual/81gmMq5a7zbF9leWMk/work'\n\n// console.log({defaultWork})\n\nconst MinimodelWithSpace = Space.withSpace(Minimodel)\n\nconst { useKeyframe, useReadyState, useLiveEventCallback, useWebSocketEventCallback } = liveInstance\n\nfunction App() {\n    const bandHeight = Math.ceil(useBangsHeightState() / window.devicePixelRatio)\n    const [defaultFiveState, setDefaultFiveState] = React.useState()\n    const [fiveStateKeyframe, setFiveStateKeyframe] = useKeyframe('FiveState')\n    // const wsStatus = useReadyState()\n    const [spaceState, setSpaceState] = useSpaceState()\n    const { closeLoading } = useJSBridgeAction()\n    const { liveConnectFromUrl } = useLiveOperation()\n    const { liveExit } = useLiveOperation()\n    \n    const WrapStyle = {\n        position: 'absolute',\n        left: 0,\n        top: `${bandHeight}px`,\n        width: '100%',\n        height: '100%',\n        pointerEvents: 'none'\n    }\n    \n    // 根据url参数进入带看\n    React.useEffect(() => {\n        if (isApp) {\n            Promise.resolve()\n                .then(closeLoading)\n                .then(() => liveConnectFromUrl(window.location.href))\n                .catch(error => {\n                    Toast.error(error.message || '哪里出错了，请刷新后重试！')\n                })\n        }else {\n            Promise.resolve()\n                .then(() => liveConnectFromUrl(window.location.href))\n                .catch(error => {\n                    Toast.error(error.message || '哪里出错了，请刷新后重试！')\n                })\n        }\n    }, [])\n    \n    /** 纯live相关处理start */\n    const [spaceStateKeyframe] = useKeyframe('SpaceState')\n    const dispatch = useDispatch()\n\n    React.useEffect(() => {\n        if (spaceStateKeyframe && spaceState.mode === 'live') {\n            dispatch(setSpaceStateToStore(spaceStateKeyframe))\n        }\n    }, [spaceStateKeyframe, dispatch, spaceState.mode])\n    \n    // 带看通道建立，首屏数据同步\n    useLiveEventCallback('readyKeyframeSync', (lastKeyframe) => {\n        // live channel ready\n        setSpaceState({ mode: 'live' }, false)\n        Toast.success('进入带看')\n        \n        // sync first screen frame\n        if (JSON.stringify(lastKeyframe) !== '{}') {\n            for (const key in lastKeyframe) {\n                if (lastKeyframe.hasOwnProperty(key)) {\n                    switch (key) {\n                        case 'FiveState':\n                            setDefaultFiveState(lastKeyframe[key])\n                            break\n                        default:\n                            return\n                    }\n                }\n            }\n        }\n    })\n    \n    // 被踢出\n    useLiveEventCallback(\"kickOut\", () => {\n        liveExit().then(() => {\n            // setSpaceState({ mode: 'user' }) // TODO 存疑,为什么不是从wsState里得到的close信息\n            Barrage.message('你被踢出带看房间')\n        })\n    })\n    \n    // 内置事件监听\n    useLiveEventCallback(\"builtinEvent\", (builtinMsg) => {\n        switch (builtinMsg.action) {\n            case BuiltinActionType.RoomClose:\n                console.log('__房间关闭__')\n                setSpaceState({ mode: 'user' })\n                Toast.success('房间关闭')\n                break\n            case BuiltinActionType.UserStatus:\n                console.log(builtinMsg.data)\n                console.log('builtinEvent: user state change')\n                break\n            case BuiltinActionType.UserInfo:\n                console.log('builtinEven: user info change')\n                break\n            case BuiltinActionType.UserMicroStatus:\n                console.log('builtinEvent: user micro change')\n                break\n            case BuiltinActionType.UserPermission:\n                console.log('builtinEvent: user permission change')\n                break\n            default:\n                console.log('builtinEvent: 其他不在枚举内的变更！') // debug\n                break\n        }\n    })\n    \n    // ws异常提示\n    useWebSocketEventCallback(\"ws.error\", (wsError) => {\n        Toast.error(wsError.error.message || '哪里出错了，请刷新后重试！')\n        console.log(wsError.error.message || '哪里出错了，请刷新后重试！')\n    })\n    \n    \n    /** 纯live相关处理end */\n    \n    // live mode下，five state同步\n    React.useEffect(() => {\n        if (spaceState.mode === 'live' && fiveStateKeyframe) {\n            setDefaultFiveState(fiveStateKeyframe)\n        }\n    }, [fiveStateKeyframe, spaceState.mode])\n    \n    function handleDefaultState (state) {\n        if (spaceState.mode === 'live') {\n            setFiveStateKeyframe(state)\n        }\n    }\n    \n  return (\n      <section id=\"app-container\">\n          {/* 此处可放错误bar等额外信息 */}\n          <main>\n              <div id=\"canvas-container\">\n                  <Space\n                      spaceRootId=\"default-canvas\"\n                      work={defaultWork}\n                      isMain={spaceState.type === 'default'}\n                      isSplit={spaceState.split}\n                      state={defaultFiveState}\n                      onStateChange={handleDefaultState}\n                  >\n                      {/* attachments */}\n                      <Box sx={WrapStyle}>\n                          <MinimodelWithSpace/>\n                      </Box>\n                  </Space>\n              </div>\n              {/* gui不含任何space相关操作能力 */}\n              <div id=\"gui\" style={{ paddingTop: `${bandHeight}px`}}>\n                  <Gui />\n              </div>\n          </main>\n      </section>\n  );\n}\n\nexport default App;\n","import { configureStore } from '@reduxjs/toolkit';\nimport spaceReducer from '../slices/spaceSlice'\nimport liveReducer from '../slices/liveSlice'\n\nexport const store = configureStore({\n  reducer: {\n    space: spaceReducer,\n    live: liveReducer\n  },\n});\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { store } from './app/store';\nimport { Provider } from 'react-redux';\nimport * as serviceWorker from './serviceWorker';\nimport liveInstance from \"./liveController/createLiveInstance\";\nimport {JSBridgeApp} from \"@realsee/jsbridge-x/lib/app\";\nimport {JSBridgeContext} from \"@realsee/jsbridge-x/lib/react\"\nimport {JSBridgeMiniprogram} from \"@realsee/jsbridge-x/lib/miniprogram\";\nimport { JSBridgeBrowser } from './utils/browser'\nimport { isApp, isMiniprogram } from './utils/deviceDetect'\n\nlet value\nif (isMiniprogram) value = new JSBridgeMiniprogram()\nelse if (isApp) value = new JSBridgeApp()\nelse value = new JSBridgeBrowser()\n\nReactDOM.render(\n  <React.StrictMode>\n      <JSBridgeContext.Provider value={value}>\n          <Provider store={store}>\n              <liveInstance.LiveProvider >\n                  <App/>\n              </liveInstance.LiveProvider>\n          </Provider>\n      </JSBridgeContext.Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}