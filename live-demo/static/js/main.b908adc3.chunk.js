(this["webpackJsonpsparrow-js"]=this["webpackJsonpsparrow-js"]||[]).push([[0],{349:function(e,n,t){},350:function(e,n,t){},360:function(e,n,t){},362:function(e,n,t){},467:function(e,n,t){},468:function(e,n,t){},469:function(e,n,t){},470:function(e,n,t){},472:function(e,n,t){},479:function(e,n,t){},480:function(e,n,t){},481:function(e,n,t){},482:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),i=t(27),c=t.n(i),o=(t(349),t(10)),s=(t(350),t(47)),l=t(70),u=t(96),d=t(93),f=t(43),p=t(165),j=(t(360),t(37)),b=t.n(j),v=t(323),h=t.n(v),m=t(1),x=r.createContext(null);var O=function(e){Object(u.a)(t,e);var n=Object(d.a)(t);function t(e){var r;return Object(s.a)(this,t),(r=n.call(this,e)).initFive=function(e){if(!r.state.five){var n={imageOptions:{size:1024},textureOptions:{size:512},maxFps:70,play:!0,poweredByRealsee:!0,onlyRenderIfNeeds:!0,floorplan:{defaultFov:80,minFov:60,maxFov:120,defaultLatitude:0,defaultLongitude:0,minLatitude:0,maxLatitude:Math.PI/2},plugins:[[h.a,"minimodel"]]},t=new p.Five(n),a=document.querySelector("#".concat(r.props.spaceRootId));t.appendTo(a),t.load(Object(p.parseWork)(e)),t.once("modelLoaded",(function(){r.setState({five:t})})),t.on("stateChange",(function(e,n){n&&r.props.onStateChange(JSON.parse(JSON.stringify(e)))})),window.addEventListener("resize",(function(){return t.refresh()}),!1)}},r.state={five:null,work:e.work},r}return Object(l.a)(t,[{key:"componentDidMount",value:function(){this.initFive(this.state.work)}},{key:"componentDidUpdate",value:function(e,n,t){n.work!==this.state.work&&this.initFive(this.state.work),e.state!==this.props.state&&this.state.five&&this.state.five.setState(this.props.state,!1,!1),e.isSplit!==this.props.isSplit&&this.state.five&&this.state.five.refresh()}},{key:"componentWillUnmount",value:function(){this.state.five.dispose()}},{key:"render",value:function(){var e=this.props,n=e.children,t=e.spaceRootId,r=e.isMain,a=e.isSplit,i=b()("vr-container",{main:r},{split:a});return Object(m.jsx)("div",{id:t,className:i,children:Object(m.jsx)(x.Provider,{value:this.state.five,children:n})})}}]),t}(r.Component);O.defaultProps={spaceRootId:"",work:null},O.withSpace=function(e){return function(n){var t=Object.assign({},n);return Object(m.jsx)(x.Consumer,{children:function(n){return n?Object(m.jsx)(e,Object(f.a)({five:n},t)):Object(m.jsx)("div",{className:"null"})}})}};var g=O;t(362);var w=function(e){var n=a.a.useState(!1),t=Object(o.a)(n,2),r=t[0],i=t[1],c=e.five,s=a.a.useRef(null);return a.a.useEffect((function(){if(s.current){var e=c.plugins.minimodel,n=s.current.clientHeight,t=s.current.clientWidth;e.appendTo(s.current,{height:n,width:t})}}),[c.plugins.minimodel]),c.on("modeChange",(function(e,n){if("Floorplan"===e)return i(!0);i(!1)})),Object(m.jsx)("div",{className:b()("minimodel-wrap",{"minimodel-wrap__hidden":r}),children:Object(m.jsx)("div",{onClick:function(){return c.setState({mode:"Floorplan"})},style:Object(f.a)({},{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:"40px",right:"20px",padding:"10px",width:"75px",height:"100px",background:"linear-gradient(transparent, rgba(0, 0, 0, .2))"}),ref:s})})},k=t(5),C=t.n(k),N=t(26),_=function(e,n){var t,r,a,i;if(!(i=n?null===(a=n.split("?")[1])||void 0===a?void 0:a.split("&"):null===(t=window.location.search)||void 0===t||null===(r=t.slice(1))||void 0===r?void 0:r.split("&")))return"";var c=i.find((function(n){return n.split("=")[0]===e}));return(null===c||void 0===c?void 0:c.split("=")[1])||""},y=t(324),A=t(369),S={getUserId:"get:/demo/auth/login",getRoomDetail:"post:/demo/live/room/detail",roomCreate:"post:/demo/live/room/create",getTicket:"post:/demo/live/apply/ticket",getRtcSign:"post:/demo/live/voice/sign"};var F=function(e,n){2===arguments.length&&"function"===typeof n&&(n=void 0);var t=e;if(A(S[t]))throw new Error("requestName is not defined");var r=(S[t]||t).split(":"),a=Object(o.a)(r,2),i=a[0],c=a[1],s="https://ka-vr-demo-developer.realsee.com".concat(c),l=fetch(s,{body:JSON.stringify(n),method:null===i||void 0===i?void 0:i.toUpperCase()}).then((function(e){return e.json()})).then((function(e){if(0!==e.code||!Object.keys(e.data).length)throw Error(e.status);return e.data}));return l},E=window.navigator.userAgent,T=/micromessenger/i.test(E)&&/miniprogram/i.test(E),M=/iphone|ipad/i.test(E),R=/android/i.test(E),L=M||R,I=t(160),U=(t(373),t(375),function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"closeWebView",value:function(){return window.history.back()}},{key:"openWebView",value:function(e,n){return window.location.href(e)}},{key:"actionShare",value:function(e){return function(){}}},{key:"getUserInfo",value:function(){var e=Object(N.a)(C.a.mark((function e(){var n,t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("getUserId").then((function(e){return e.user_id})).catch((function(e){return e.message}));case 2:return n=e.sent,t={userId:n},e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(N.a)(C.a.mark((function e(){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F("getUserId").then((function(e){return e.user_id})).catch((function(e){return e.message}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(N.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"closeLoading",value:function(){var e=Object(N.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getBangsHeight",value:function(){var e=Object(N.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}()),B=t(161),D=t(325),W=!("anchor"!==_("userRole")),z=[{user_identifier:"123456789",user_sig:"%7B%22attendence%22%3A%7B%22attendee_id%22%3A%22b35e589d-adb1-43ca-8d63-7de013660706%22%2C%22external_user_id%22%3A%22123456789%22%2C%22join_token%22%3A%22OTg3MDhhNDEtMzJiNi0yNGRiLTIxOWUtYTFiNDc0ZWE4NmZjOjFiMmYyMGMyLWI3YjItNGExZC1iNTViLTdmNjhiZTRiOTY2OA%22%7D%2C%22config%22%3A%7B%22passport%22%3A%22%22%2C%22vendor%22%3A%22%22%2C%22app_id%22%3A%221400549412%22%2C%22bypass%22%3Anull%7D%2C%22expire_time%22%3A1648630447%2C%22identifier%22%3A%22123456789%22%2C%22user_id%22%3A%22123456789%22%2C%22user_sig%22%3A%22OTg3MDhhNDEtMzJiNi0yNGRiLTIxOWUtYTFiNDc0ZWE4NmZjOjFiMmYyMGMyLWI3YjItNGExZC1iNTViLTdmNjhiZTRiOTY2OA%22%2C%22vendor_wrapper%22%3A%7B%22MediaPlacement%22%3A%7B%22AudioFallbackUrl%22%3A%22wss%3A%2F%2Fhaxrp.m3.as2.app.chime.aws%3A443%2Fcalls%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22AudioHostUrl%22%3A%228e611798e59dafb1fb11036da79d4e0a.k.m3.as2.app.chime.aws%3A3478%22%2C%22ScreenDataUrl%22%3A%22wss%3A%2F%2Fbitpw.m3.as2.app.chime.aws%3A443%2Fv2%2Fscreen%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22ScreenSharingUrl%22%3A%22wss%3A%2F%2Fbitpw.m3.as2.app.chime.aws%3A443%2Fv2%2Fscreen%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22ScreenViewingUrl%22%3A%22wss%3A%2F%2Fbitpw.m3.as2.app.chime.aws%3A443%2Fws%2Fconnect%3Fpasscode%3Dnull%5Cu0026viewer_uuid%3Dnull%5Cu0026X-BitHub-Call-Id%3Db35e589d-adb1-43ca-8d63-7de013660706%22%2C%22SignalingUrl%22%3A%22wss%3A%2F%2Fsignal.m3.as2.app.chime.aws%2Fcontrol%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22TurnControlUrl%22%3A%22https%3A%2F%2Fccp.cp.ue1.app.chime.aws%2Fv2%2Fturn_sessions%22%7D%2C%22MeetingId%22%3A%22b35e589d-adb1-43ca-8d63-7de013660706%22%7D%7D",voice_app_id:"1400549412"},{user_identifier:"987654321",user_sig:"%7B%22attendence%22%3A%7B%22attendee_id%22%3A%22b35e589d-adb1-43ca-8d63-7de013660706%22%2C%22external_user_id%22%3A%22987654321%22%2C%22join_token%22%3A%22MjMwNWE2YjMtNmYwNC01YWEzLTNiNDMtZjAwOWRhMzRjZGM1OjgyNjFkMzU1LWZkZGQtNDRiNi05NTY3LWFhOTkyZjQ1NTBjMw%22%7D%2C%22config%22%3A%7B%22passport%22%3A%22%22%2C%22vendor%22%3A%22%22%2C%22app_id%22%3A%221400549412%22%2C%22bypass%22%3Anull%7D%2C%22expire_time%22%3A1648630447%2C%22identifier%22%3A%22987654321%22%2C%22user_id%22%3A%22987654321%22%2C%22user_sig%22%3A%22MjMwNWE2YjMtNmYwNC01YWEzLTNiNDMtZjAwOWRhMzRjZGM1OjgyNjFkMzU1LWZkZGQtNDRiNi05NTY3LWFhOTkyZjQ1NTBjMw%22%2C%22vendor_wrapper%22%3A%7B%22MediaPlacement%22%3A%7B%22AudioFallbackUrl%22%3A%22wss%3A%2F%2Fhaxrp.m3.as2.app.chime.aws%3A443%2Fcalls%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22AudioHostUrl%22%3A%228e611798e59dafb1fb11036da79d4e0a.k.m3.as2.app.chime.aws%3A3478%22%2C%22ScreenDataUrl%22%3A%22wss%3A%2F%2Fbitpw.m3.as2.app.chime.aws%3A443%2Fv2%2Fscreen%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22ScreenSharingUrl%22%3A%22wss%3A%2F%2Fbitpw.m3.as2.app.chime.aws%3A443%2Fv2%2Fscreen%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22ScreenViewingUrl%22%3A%22wss%3A%2F%2Fbitpw.m3.as2.app.chime.aws%3A443%2Fws%2Fconnect%3Fpasscode%3Dnull%5Cu0026viewer_uuid%3Dnull%5Cu0026X-BitHub-Call-Id%3Db35e589d-adb1-43ca-8d63-7de013660706%22%2C%22SignalingUrl%22%3A%22wss%3A%2F%2Fsignal.m3.as2.app.chime.aws%2Fcontrol%2Fb35e589d-adb1-43ca-8d63-7de013660706%22%2C%22TurnControlUrl%22%3A%22https%3A%2F%2Fccp.cp.ue1.app.chime.aws%2Fv2%2Fturn_sessions%22%7D%2C%22MeetingId%22%3A%22b35e589d-adb1-43ca-8d63-7de013660706%22%7D%7D",voice_app_id:"1400549412"}],Z=function(){var e=Object(N.a)(C.a.mark((function e(n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!W){e.next=4;break}return e.abrupt("return",{sdkAppId:Number(z[0].voice_app_id),userId:z[0].user_identifier,userSig:z[0].user_sig});case 4:return e.abrupt("return",{sdkAppId:Number(z[1].voice_app_id),userId:z[1].user_identifier,userSig:z[1].user_sig});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Y=new D.BrowserRTC4Chime({getVoiceSign:Z,logLevel:2}),J=Object(y.createLiveReact)({__debug__:!0,rtc:Y}),P=t(48),V=t(73),G=Object(V.b)({name:"live",initialState:{state:{roomCode:""}},reducers:{setLiveStateToStore:function(e,n){e.state=Object.assign({},e.state,n.payload)}},extraReducers:function(e){}}),H=G.actions.setLiveStateToStore,K=function(e){return e.live.state},Q=G.reducer,q=t(38),X=Object(V.b)({name:"space",initialState:{state:{type:"default",mode:"user",split:!1}},reducers:{setSpaceStateToStore:function(e,n){e.state=Object.assign({},e.state,n.payload)}},extraReducers:function(e){}}),$=X.actions.setSpaceStateToStore,ee=function(e){return e.space.state},ne=X.reducer,te=J.useConnect,re=J.useLiveAction;function ae(){var e=re().exit,n=te(),t=Object(P.useJSBridgeAction)(),r=t.login,a=t.getUserInfo,i=Object(q.b)(),c=function(){var e=Object(N.a)(C.a.mark((function e(){var n,t,i,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!L){e.next=3;break}return e.next=3,r();case 3:return e.next=5,a();case 5:if(n=e.sent,t=Object(o.a)(n,2),i=t[0],c=t[1],i){e.next=11;break}throw Error((null===c||void 0===c?void 0:c.message)||"\u8eab\u4efd\u4fe1\u606f\u83b7\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 11:return e.abrupt("return",i.userId);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{liveConnect:function(){var e=Object(N.a)(C.a.mark((function e(){var t,r,a,s,l,u,d,f;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.location.search.includes("userRole=audience")?"audience":"anchor",e.next=3,c();case 3:if(r=e.sent,"anchor"!==t){e.next=15;break}return e.next=7,ie(r,t);case 7:l=e.sent,u=Object(o.a)(l,2),d=u[0],f=u[1],a=d,s=f,e.next=19;break;case 15:return s=_("roomCode"),e.next=18,ce(s);case 18:a=e.sent;case 19:return e.abrupt("return",Promise.resolve().then((function(){i(H({roomCode:s})),n({force:!0,url:a,getTicket:function(){var e=Object(N.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe({roomCode:s,userId:r,userRole:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})})).catch((function(e){return console.error(e.message)})));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),liveExit:function(){return Promise.resolve().then((function(){return e()})).then((function(e){if(!e)throw Error("\u9000\u51fa\u5e26\u770b\u5931\u8d25");i($({mode:"user"})),i(H({roomCode:""}))})).catch((function(e){console.error(e.message||"\u9000\u51fa\u5e26\u770b\u5931\u8d25")}))},liveConnectFromUrl:function(){var e=Object(N.a)(C.a.mark((function e(t){var r,a,o,s;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=_("userRole",t),a=_("roomCode",t),_("enterLive",t)&&a){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,c();case 7:return o=e.sent,e.next=10,ce(a);case 10:return s=e.sent,e.abrupt("return",Promise.resolve().then((function(){i(H({roomCode:a})),n({force:!0,url:s,getTicket:function(){var e=Object(N.a)(C.a.mark((function e(){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe({roomCode:a,userId:o,userRole:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})})).catch((function(e){return console.error(e.message)})));case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}}var ie=function(){var e=Object(N.a)(C.a.mark((function e(n,t){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F("roomCreate",{create_user_role:t,create_user_id:n}).then((function(e){return[e.room_link,e.room_id]})).catch((function(e){throw Error(e.message||"\u8bf7\u6c42\u5e26\u770b\u623f\u95f4\u4fe1\u606f\u5931\u8d25")})));case 1:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),ce=function(){var e=Object(N.a)(C.a.mark((function e(n){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F("getRoomDetail",{room_id:n}).then((function(e){return e.room_link})).catch((function(e){throw Error(e.message||"\u67e5\u8be2\u5e26\u770b\u623f\u95f4\u4fe1\u606f\u5931\u8d25")})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=Object(N.a)(C.a.mark((function e(n){var t,r,a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.roomCode,r=n.userId,a=n.userRole,e.abrupt("return",F("getTicket",{room_id:t,user_id:r,user_role:a}).then((function(e){return e.ticket})).catch((function(e){throw Error(e.message||"\u83b7\u53d6\u5e26\u770b\u95e8\u7968\u5931\u8d25")})));case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=J.useKeyframe,le=J.useSelfInfo;function ue(){var e=Object(q.c)(ee),n=Object(q.b)(),t=a.a.useState(e),r=Object(o.a)(t,2),i=r[0],c=r[1],s=se("SpaceState"),l=Object(o.a)(s,2)[1],u=le(),d=Object(o.a)(u,1)[0],f=a.a.useCallback((function(t){var r,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i="function"===typeof t?t():t;a&&"live"===e.mode&&(null===d||void 0===d||null===(r=d.permission)||void 0===r?void 0:r.sync_frame)&&l(i),n($(i))}),[n,l,e.mode,d]);return a.a.useEffect((function(){return c(e)}),[e]),[i,f]}var de=t(117);t(467);function fe(){}var pe=[],je=-1,be=function(e){var n=b()("realsee-design-barrage",e.className),t=Math.floor(100*Math.random());return(t<20||80<t)&&(t=50),Object(m.jsx)("div",{className:n,style:{top:"".concat(t,"%")},children:Object(m.jsx)("div",{className:"react-barrage-contain",children:e.children})})},ve=function(e){var n=e.content,t=e.duration,r=void 0===t?1:t,a=e.onClose,i=void 0===a?fe:a,o=Object(de.a)(e,["content","duration","onClose"]),s=++je,l=document.createElement("div");document.body.appendChild(l);var u=function(){u=fe,pe[s]=null,c.a.unmountComponentAtNode(l),l.parentNode.removeChild(l),i()};if(pe[s]=u,c.a.render(Object(m.jsx)(be,Object(f.a)(Object(f.a)({},o),{},{children:n})),l),0!==r){var d=window.innerWidth>768?2:r;setTimeout(u,1e4*d)}return u};be.message=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-barrage"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),ve(e)},be.unmount=function(){pe.forEach((function(e){e&&e()}))};var he=be,me=J.useSelfInfo,xe=J.useLiveAction,Oe=J.useLiveEventCallback;var ge=J.useRTCEventCallback;t(468),t(469);var we=t(516),ke=t(521),Ce=t(522),Ne=t(329),_e=t.n(Ne);t(470);var ye,Ae,Se=function(e){return Object(m.jsx)("div",{className:"btn-wrap",onClick:e.onClick,children:e.text})},Fe=window.location.search.includes("userRole=audience"),Ee=function(){var e=ae(),n=e.liveConnect,t=e.liveConnectFromUrl,a=(Object(P.useJSBridgeAction)().closeWebView,r.createRef());return Object(m.jsxs)("div",{className:"default__user",children:[Object(m.jsx)("div",{className:"gui__top",children:Object(m.jsx)("div",{className:"gui__top--bar",children:Object(m.jsx)(we.a,{className:"title btn",sx:{color:"white",fontSize:"16px"},children:"\u5982\u89c6\u5f00\u53d1\u8005\u4e2d\u5fc3\u793a\u4f8b--user\u6001"})})}),Object(m.jsx)("div",{className:"gui__overlay",children:Object(m.jsx)("div",{className:"scene-overlay"})}),Object(m.jsx)("div",{className:"gui__bottom",children:Object(m.jsx)("div",{className:"controls",children:Object(m.jsx)("div",{className:"collapsible-list",children:Object(m.jsx)("div",{className:"collapsible-item",children:Fe?Object(m.jsxs)(ke.a,{children:[Object(m.jsx)(Ce.a,{type:"text",placeholder:"\u8bf7\u8f93\u5165\u5e26\u770b\u94fe\u63a5",inputRef:a}),Object(m.jsx)(we.a,{sx:{color:"white"},onClick:function(){a.current.value?t(a.current.value):console.log("\u8f93\u5165\u6709\u8bef")},children:Object(m.jsx)(_e.a,{})})]}):Object(m.jsx)(ke.a,{className:"live--open",onClick:function(){return n()},sx:{display:"flex",justifyContent:"center"},children:Object(m.jsx)(Se,{text:"\u8fdb\u5165\u5e26\u770b"})})})})})})]})},Te=(t(472),t(335)),Me=t.n(Te),Re=t(336),Le=t.n(Re),Ie=t(337),Ue=t.n(Ie),Be=t(92),De=t.n(Be),We=t(116),ze=t.n(We),Ze=t(338),Ye=t.n(Ze),Je=t(518),Pe=t(55),Ve=t(95),Ge=t(523),He=t(331),Ke=t.n(He),Qe=t(330),qe=t.n(Qe),Xe=Ve.a.div(ye||(ye=Object(Pe.a)(["\n  max-height: 200px;\n  display: flex;\n  flex-flow: column;\n  overflow-y: auto;\n  font-size: 12px;\n  pointer-events: auto;\n"]))),$e=Ve.a.div(Ae||(Ae=Object(Pe.a)(["\n  display: flex;\n  flex-flow: row wrap;\n  align-items: center;\n  padding: 4px 0;\n  pointer-events: auto;\n  \n  > span {\n    display: flex;\n  }\n  \n  & > .role {\n    padding-left: 4px;\n    padding-right: 4px;\n    border-radius: 2px;\n    background-color: #5a6268;\n    color: white;\n  }\n\n  & > .self-tag {\n    color: darkorange;\n  }\n  \n  & > .nickname {\n    color: white;\n  }\n\n  & > .nickname.self-name {\n    color: greenyellow;\n  }\n\n  & > .btn {\n    color: darkorange;\n    cursor: pointer;\n  }\n\n  & > .edit-btn-groups {\n    display: inline-flex;\n  }\n\n  & > .status {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background-color: #5a6268;\n\n    &.online {\n      background-color: aquamarine;\n    }\n  }\n"]))),en=function(e){var n=a.a.useState(!1),t=Object(o.a)(n,2),r=t[0],i=t[1],c=a.a.createRef();return Object(m.jsx)("div",{className:"user-info",children:Object(m.jsx)(Xe,{className:"user-list-panel",children:e.list&&e.list.map((function(n,t){return function(n,t){var a=n.id,o=n.micro_status,s=n.current_ws_online,l=n.permission,u=n.extension,d=n.user_role,f=a===e.selfInfo.id,p=!f&&s&&(null===l||void 0===l?void 0:l.change_other_status),j=e.volumeLists.find((function(e){return a===e.id})),v=!!(j&&j.audioVolume>=10),h="";return"anchor"===d?h="\u4e3b\u6301\u4eba":"audience"===d&&(h="\u89c2\u4f17"),Object(m.jsxs)($e,{className:"user-list-item",children:[Object(m.jsx)("span",{onClick:function(){return e.onForbiddenMicro(a)},children:Object(m.jsx)(Ge.a,{sx:{display:"flex",marginRight:"2px"},children:v?Object(m.jsx)(De.a,{fontSize:"small",color:"primary"}):o?Object(m.jsx)(qe.a,{fontSize:"small"}):Object(m.jsx)(ze.a,{fontSize:"small"})})}),Object(m.jsx)("span",{className:"role",children:h}),f&&Object(m.jsx)("span",{className:"self-tag",children:"[\u81ea\u5df1]"}),f&&r?Object(m.jsx)(Ce.a,{className:"nickname",autoFocus:!0,defaultValue:"",type:"text",inputRef:c}):Object(m.jsx)("span",{className:b()("nickname",{"self-name":f}),children:(null===u||void 0===u?void 0:u.nickname)||a}),Object(m.jsx)("span",{className:b()("status",{online:s})}),f&&!r&&Object(m.jsx)("span",{onClick:function(){return i(!0)},className:"edit-nickname btn",children:"[\u4fee\u6539\u6635\u79f0]"}),f&&r&&Object(m.jsxs)("span",{className:"edit-btn-groups btn",children:[Object(m.jsx)("span",{onClick:function(){var n;i(!1),e.onNickNameChange(null===(n=c.current)||void 0===n?void 0:n.value)},className:"submit-nickname btn",children:"[\u63d0\u4ea4\u4fee\u6539]"}),Object(m.jsx)("span",{onClick:function(){return i(!1)},className:"exit-edit-nickname btn",children:"[\u9000\u51fa]"})]}),p&&Object(m.jsx)("span",{onClick:function(){return e.onKickUser(a)},children:Object(m.jsx)(Ge.a,{sx:{display:"flex",marginLeft:"2px"},children:Object(m.jsx)(Ke.a,{fontSize:"small"})})})]},t)}(n,t)}))})})},nn=t(72),tn=t.n(nn),rn=t(517),an=t(520),cn=t(524),on=t(97),sn=t(334),ln=t.n(sn),un=t(332),dn=t.n(un),fn=t(333),pn=t.n(fn);t(479);function jn(){}var bn=[],vn=-1,hn=function(e){var n=b()("realsee-design-toast",e.className);return Object(m.jsx)("div",{className:n,children:Object(m.jsx)("div",{className:"react-toast-contain",children:e.children})})},mn=function(e){var n=e.content,t=e.duration,r=void 0===t?1.5:t,a=e.onClose,i=void 0===a?jn:a,o=Object(de.a)(e,["content","duration","onClose"]),s=++vn,l=document.createElement("div");document.body.appendChild(l);var u=function(){u=jn,bn[s]=null,c.a.unmountComponentAtNode(l),l.parentNode.removeChild(l),i()};return bn[s]=u,c.a.render(Object(m.jsx)(hn,Object(f.a)(Object(f.a)({},o),{},{children:n})),l),0!==r&&setTimeout(u,1e3*r),u};hn.error=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-toast-error"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),mn(e)},hn.success=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-toast-success"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),mn(e)},hn.unmount=function(){bn.forEach((function(e){e&&e()}))};var xn=hn;var On=function(e){var n=a.a.useState(null),t=Object(o.a)(n,2),r=t[0],i=t[1],c=a.a.useState(null),s=Object(o.a)(c,2);return s[0],s[1],Object(P.useJSBridgeAction)().actionShare,Object(m.jsx)(rn.a,{open:e.open,children:Object(m.jsxs)("div",{className:"modal__wrap",children:[Object(m.jsxs)("div",{className:"modal__header",children:[Object(m.jsx)("div",{className:"share",children:"\u5206\u4eab"}),Object(m.jsx)(we.a,{onClick:function(){e.onClose()},className:"close",sx:{color:"black"},children:Object(m.jsx)(tn.a,{fontSize:"small"})})]}),Object(m.jsxs)("div",{className:"modal__body",children:[Object(m.jsx)("div",{className:"link-icon-list",children:Object(m.jsxs)(ke.a,{children:[Object(m.jsx)(we.a,{onClick:function(e){i(e.currentTarget)},sx:{backgroundColor:"#f1f3f4",color:"black"},children:Object(m.jsx)(ln.a,{})}),Object(m.jsx)(an.a,{open:Boolean(r),anchorEl:r,onClose:function(){i(null)},anchorOrigin:{vertical:"center",horizontal:"center"},children:Object(m.jsx)(cn.a,{sx:{p:2},children:Object(m.jsx)(dn.a,{value:e.shareConfig.shareLink,level:"H",includeMargin:!0})})})]})}),Object(m.jsxs)(ke.a,{className:"link-copy link-content",children:[Object(m.jsx)(on.c,{disabled:!0,className:"link",value:e.shareConfig.shareLink,sx:{padding:"0 4px"}}),Object(m.jsx)(we.a,{onClick:function(){pn()(e.shareConfig.shareLink),xn.success("\u64cd\u4f5c\u6210\u529f")},className:"copy",sx:{fontSize:"16px",color:"black"},children:"\u590d\u5236"})]})]}),Object(m.jsx)("div",{className:"modal__footer"})]})})},gn=t(339),wn=t.n(gn),kn=J.useSelfInfo,Cn=J.useUserList,Nn=J.useLiveAction,_n=J.useRTCEventCallback,yn=function(){var e=ae().liveExit,n=Object(q.c)(K),t=Cn(),i=r.useState(!0),c=Object(o.a)(i,2),s=c[0],l=c[1],u=r.createRef(),d=function(e){var n=me(),t=Object(o.a)(n,1)[0],r=xe().broadcast;return Oe("broadcast",(function(e){switch(e.event_id){case"greet":he.message(e.data.message);break;default:console.log("___broadcast__bug__")}})),a.a.useCallback((function(e){var n;r({event_id:e.event_id,data:{message:"".concat((null===t||void 0===t||null===(n=t.extension)||void 0===n?void 0:n.nickname)||(null===t||void 0===t?void 0:t.id),"\u8bf4\uff1a").concat(e.message)}},[],0)}),[e,t])}(),f=kn(),p=Object(o.a)(f,2),j=p[0],b=p[1],v=r.useState(!1),h=Object(o.a)(v,2),x=h[0],O=h[1],g=Nn(),w=g.kick,k=g.toggleMicro,C=g.forbidMicro,N=function(e){var n=a.a.useState([]),t=Object(o.a)(n,2),r=t[0],i=t[1];return ge("userVolumes",(function(e){console.log("\u97f3\u91cf\uff1a ",e),i(e)})),r}(),_=r.useState(!1),y=Object(o.a)(_,2),A=y[0],S=y[1],F=r.useState(!1),E=Object(o.a)(F,2),T=E[0],M=E[1];r.useEffect((function(){if(j&&N.length){var e=N.find((function(e){return j.id===e.userId})),n=!!(e&&e.audioVolume>=10);S(n)}}),[N]),_n("joined",(function(){console.log("rtc -- joined")})),_n("error",(function(e){console.log("rtc -- error: ",e.message)}));var R=function(){e().then((function(){xn.success("\u9000\u51fa\u5e26\u770b")}))};return Object(m.jsxs)("div",{className:"default__live",children:[Object(m.jsx)("div",{className:"gui__top",children:Object(m.jsxs)("div",{className:"gui__top--bar",children:[Object(m.jsx)(we.a,{className:"close btn",sx:{color:"white"},onClick:R,children:Object(m.jsx)(tn.a,{})}),Object(m.jsx)(we.a,{className:"title btn",sx:{color:"white",fontSize:"16px"},children:"\u5982\u89c6\u5f00\u53d1\u8005\u4e2d\u5fc3\u793a\u4f8b--live\u6001"}),Object(m.jsx)(we.a,{className:"share btn",sx:{color:"white"},onClick:function(){M(!0)},children:Object(m.jsx)(Me.a,{})})]})}),Object(m.jsx)("div",{className:"gui__overlay",children:Object(m.jsxs)("div",{className:"scene-overlay",children:[Object(m.jsx)(On,{open:T,onClose:function(){return M(!1)},shareConfig:{shareLink:"".concat(window.location.href.split("?")[0],"?userRole=audience&roomCode=").concat(n.roomCode,"&enterLive=true")}}),x&&Object(m.jsxs)("div",{className:"overlay-modal",children:[Object(m.jsx)(we.a,{className:"icon-close",onClick:function(){return O(!1)},children:Object(m.jsx)(tn.a,{})}),Object(m.jsx)(en,{list:t,selfInfo:j,volumeLists:N,onForbiddenMicro:function(e){return C("CLOSE",e)},onKickUser:function(e){return w(e)},onNickNameChange:function(e){return b({nickname:e})}})]})]})}),Object(m.jsx)("div",{className:"gui__bottom",children:Object(m.jsx)("div",{className:"controls",children:Object(m.jsx)("div",{className:"collapsible-list",children:Object(m.jsxs)("div",{className:"collapsible-item",children:[Object(m.jsx)(we.a,{sx:{color:"white"},className:"members",onClick:function(){return O(!0)},children:Object(m.jsx)(Je.a,{color:"primary",badgeContent:t&&t.length,children:Object(m.jsx)(Le.a,{})})}),s?Object(m.jsx)(we.a,{sx:{color:"white"},className:"greet",onClick:function(){return l(!1)},children:Object(m.jsx)(Ue.a,{})}):Object(m.jsxs)("div",{className:"greet",children:[Object(m.jsx)(Ce.a,{type:"text",placeholder:"\u8bf4\u70b9\u4ec0\u4e48\u5427",inputRef:u}),Object(m.jsx)(we.a,{sx:{color:"white"},onClick:function(){var e;d({event_id:"greet",message:null===(e=u.current)||void 0===e?void 0:e.value}),l(!0)},children:Object(m.jsx)(Ye.a,{})})]}),Object(m.jsx)(we.a,{sx:{color:"white"},className:"micro",onClick:function(){return k(!j.micro_status)},children:(null===j||void 0===j?void 0:j.micro_status)?A?Object(m.jsx)(De.a,{color:"primary"}):Object(m.jsx)(De.a,{}):Object(m.jsx)(ze.a,{})}),Object(m.jsx)(we.a,{sx:{color:"white"},className:"close",onClick:R,children:Object(m.jsx)(wn.a,{})})]})})})})]})},An=(t(480),function(){var e=ue()[1];return Object(m.jsx)("div",{className:"panel decoration-space-panel__bottom-user",children:Object(m.jsx)("div",{className:"bottom",children:Object(m.jsx)("div",{className:"controls",children:Object(m.jsx)("div",{className:"collapsible-list",children:Object(m.jsxs)("div",{className:"collapsible-item",children:[Object(m.jsx)("span",{children:"decoration -- user"}),Object(m.jsx)("button",{onClick:function(){return e({type:"default"})},children:"switch to default space"})]})})})})})}),Sn=(t(481),function(){var e=ae().liveExit,n=ue()[1];return Object(m.jsx)("div",{className:"panel decoration-space-panel__bottom--live",children:Object(m.jsx)("div",{className:"bottom",children:Object(m.jsx)("div",{className:"controls",children:Object(m.jsx)("div",{className:"collapsible-list",children:Object(m.jsxs)("div",{className:"collapsible-item",children:[Object(m.jsx)("span",{children:"decoration -- live"}),Object(m.jsx)("button",{onClick:function(){return n({type:"default"})},children:"switch to default space"}),Object(m.jsx)("button",{onClick:function(){return e()},children:"exit live"})]})})})})})}),Fn=function(){var e=ue(),n=Object(o.a)(e,1)[0];switch(n.type){case"default":return function(){switch(n.mode){case"user":return Object(m.jsx)(Ee,{});case"live":return Object(m.jsx)(yn,{});case"tour":return Object(m.jsx)("div",{className:"panel default-space-panel__bottom--tour",children:"default -- tour"});default:return null}}();case"decoration":return function(){switch(n.mode){case"user":return Object(m.jsx)(An,{});case"live":return Object(m.jsx)(Sn,{});case"tour":return Object(m.jsx)("div",{className:"panel decoration-space-panel__bottom--tour",children:"decoration -- tour"});default:return null}}();default:return null}},En=t(64),Tn=t(340),Mn=g.withSpace(w),Rn=J.useKeyframe,Ln=J.useRTCEventCallback,In=J.useLiveEventCallback,Un=J.useWebSocketEventCallback;var Bn=function(){var e=Math.ceil(Object(P.useBangsHeightState)()/window.devicePixelRatio),n=a.a.useState(),t=Object(o.a)(n,2),r=t[0],i=t[1],c=Rn("FiveState"),s=Object(o.a)(c,2),l=s[0],u=s[1],d=ue(),f=Object(o.a)(d,2),p=f[0],j=f[1],b=Object(P.useJSBridgeAction)().closeLoading,v=ae().liveConnectFromUrl,h=ae().liveExit,x={position:"absolute",left:0,top:"".concat(e,"px"),width:"100%",height:"100%",pointerEvents:"none"};a.a.useEffect((function(){L?Promise.resolve().then(b).then((function(){return v(window.location.href)})).catch((function(e){xn.error(e.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")})):Promise.resolve().then((function(){return v(window.location.href)})).catch((function(e){xn.error(e.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")}))}),[]);var O=Rn("SpaceState"),w=Object(o.a)(O,1)[0],k=Object(q.b)();return a.a.useEffect((function(){w&&"live"===p.mode&&k($(w))}),[w,k,p.mode]),In("readyKeyframeSync",(function(e){if(j({mode:"live"},!1),xn.success("\u8fdb\u5165\u5e26\u770b"),"{}"!==JSON.stringify(e))for(var n in e)if(e.hasOwnProperty(n))switch(n){case"FiveState":i(e[n]);break;default:return}})),In("kickOut",(function(){h().then((function(){he.message("\u4f60\u88ab\u8e22\u51fa\u5e26\u770b\u623f\u95f4")}))})),In("builtinEvent",(function(e){switch(console.log({builtinMsg:e}),e.action){case En.BuiltinActionType.RoomClose:console.log("__\u623f\u95f4\u5173\u95ed__"),j({mode:"user"}),xn.success("\u623f\u95f4\u5173\u95ed");break;case En.BuiltinActionType.UserStatus:console.log(e.data),console.log("builtinEvent: user state change");break;case En.BuiltinActionType.UserInfo:console.log("builtinEven: user info change");break;case En.BuiltinActionType.UserMicroStatus:console.log("builtinEvent: user micro change");break;case En.BuiltinActionType.UserPermission:console.log("builtinEvent: user permission change");break;default:console.log("builtinEvent: \u5176\u4ed6\u4e0d\u5728\u679a\u4e3e\u5185\u7684\u53d8\u66f4\uff01")}})),Un("ws.error",(function(e){xn.error(e.error.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01"),console.log(e.error.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")})),Ln("joined",(function(){console.log("rtc -- joined")})),Ln("userVolumes",(function(e){console.log("\u97f3\u91cf\uff1a ",e)})),Ln("error",(function(e){console.log("rtc -- error: ",e.message)})),a.a.useEffect((function(){"live"===p.mode&&l&&i(l)}),[l,p.mode]),Object(m.jsx)("section",{id:"app-container",children:Object(m.jsxs)("main",{children:[Object(m.jsx)("div",{id:"canvas-container",children:Object(m.jsx)(g,{spaceRootId:"default-canvas",work:Tn.a,isMain:"default"===p.type,isSplit:p.split,state:r,onStateChange:function(e){"live"===p.mode&&u(e)},children:Object(m.jsx)(ke.a,{sx:x,children:Object(m.jsx)(Mn,{})})})}),Object(m.jsx)("div",{id:"gui",style:{paddingTop:"".concat(e,"px")},children:Object(m.jsx)(Fn,{})})]})})},Dn=Object(V.a)({reducer:{space:ne,live:Q}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Wn,zn=t(162);Wn=T?new B.JSBridgeMiniprogram:L?new I.JSBridgeApp:new U,c.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(zn.JSBridgeContext.Provider,{value:Wn,children:Object(m.jsx)(q.a,{store:Dn,children:Object(m.jsx)(J.LiveProvider,{children:Object(m.jsx)(Bn,{})})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[482,1,2]]]);
//# sourceMappingURL=main.b908adc3.chunk.js.map