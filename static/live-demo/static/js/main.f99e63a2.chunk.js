(this["webpackJsonpsparrow-js"]=this["webpackJsonpsparrow-js"]||[]).push([[0],{137:function(e,t,n){},138:function(e,t,n){},155:function(e,t,n){},156:function(e,t,n){},158:function(e,t,n){},195:function(e,t,n){},196:function(e,t,n){},197:function(e,t,n){},198:function(e,t,n){},200:function(e,t,n){},207:function(e,t,n){},208:function(e,t,n){},209:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(20),a=n.n(i),o=(n(137),n(6)),s=(n(138),n(31)),u=n(44),l=n(60),d=n(57),f=n(29),j=n(88),v=(n(155),n(25)),b=n.n(v),h=n(112),p=n.n(h),m=n(75),x=(n(156),n(1));function O(){}var g=[],k=-1,w=function(e){var t=b()("realsee-design-toast",e.className);return Object(x.jsx)("div",{className:t,children:Object(x.jsx)("div",{className:"react-toast-contain",children:e.children})})},y=function(e){var t=e.content,n=e.duration,r=void 0===n?1.5:n,c=e.onClose,i=void 0===c?O:c,o=Object(m.a)(e,["content","duration","onClose"]),s=++k,u=document.createElement("div");document.body.appendChild(u);var l=function(){l=O,g[s]=null,a.a.unmountComponentAtNode(u),u.parentNode.removeChild(u),i()};return g[s]=l,a.a.render(Object(x.jsx)(w,Object(f.a)(Object(f.a)({},o),{},{children:t})),u),0!==r&&setTimeout(l,1e3*r),l};w.error=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-toast-error"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),y(e)},w.success=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-toast-success"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),y(e)},w.unmount=function(){g.forEach((function(e){e&&e()}))};var C=w,N=r.createContext(null);var _=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).initFive=function(e){if(!r.state.five){var t={imageOptions:{size:1024},textureOptions:{size:512},maxFps:70,play:!0,poweredByRealsee:!0,onlyRenderIfNeeds:!0,floorplan:{defaultFov:80,minFov:60,maxFov:120,defaultLatitude:0,defaultLongitude:0,minLatitude:0,maxLatitude:Math.PI/2},plugins:[[p.a,"minimodel"]]},n=new j.Five(t),c=document.querySelector("#".concat(r.props.spaceRootId));n.appendTo(c),console.log(e),n.load(Object(j.parseWork)(e)),n.once("modelLoaded",(function(){r.setState({five:n})})),n.on("stateChange",(function(e,t){t&&r.props.onStateChange(JSON.parse(JSON.stringify(e)))})),window.addEventListener("resize",(function(){return n.refresh()}),!1)}},r.fetchWork=function(e){return fetch(e).then((function(e){return e.json()})).then((function(e){if(0===e.code&&Object.keys(e.data).length)return e.data;throw Error(e.status)})).catch((function(e){throw Error(e.message||"work\u6570\u636e\u83b7\u53d6\u5931\u8d25")}))},r.state={five:null,work:null},r}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=this;Promise.resolve().then((function(){return e.fetchWork(e.props.url)})).then((function(t){e.setState({work:t})})).catch((function(e){C.error(e.message)}))}},{key:"componentDidUpdate",value:function(e,t,n){t.work!==this.state.work&&this.initFive(this.state.work),e.state!==this.props.state&&this.state.five&&this.state.five.setState(this.props.state,!1,!1),e.isSplit!==this.props.isSplit&&this.state.five&&this.state.five.refresh()}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.spaceRootId,r=e.isMain,c=e.isSplit,i=b()("vr-container",{main:r},{split:c});return Object(x.jsx)("div",{id:n,className:i,children:Object(x.jsx)(N.Provider,{value:this.state.five,children:t})})}}]),n}(r.Component);_.defaultProps={spaceRootId:"",url:""},_.withSpace=function(e){return function(t){var n=Object.assign({},t);return Object(x.jsx)(N.Consumer,{children:function(t){return t?Object(x.jsx)(e,Object(f.a)({five:t},n)):Object(x.jsx)("div",{className:"null"})}})}};var S=_;n(158);var E=function(e){var t=c.a.useState(!1),n=Object(o.a)(t,2),r=n[0],i=n[1],a=e.five,s=c.a.useRef(null);return c.a.useEffect((function(){if(s.current){var e=a.plugins.minimodel,t=s.current.clientHeight,n=s.current.clientWidth;e.appendTo(s.current,{height:t,width:n})}}),[a.plugins.minimodel]),a.on("modeChange",(function(e,t){if("Floorplan"===e)return i(!0);i(!1)})),Object(x.jsx)("div",{className:b()("minimodel-wrap",{"minimodel-wrap__hidden":r}),children:Object(x.jsx)("div",{onClick:function(){return a.setState({mode:"Floorplan"})},style:Object(f.a)({},{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:"40px",right:"20px",padding:"10px",width:"75px",height:"100px",background:"linear-gradient(transparent, rgba(0, 0, 0, .2))"}),ref:s})})},R=n(9),I=n.n(R),L=n(19),B=function(e,t){var n,r,c,i;if(!(i=t?null===(c=t.split("?")[1])||void 0===c?void 0:c.split("&"):null===(n=window.location.search)||void 0===n||null===(r=n.slice(1))||void 0===r?void 0:r.split("&")))return"";var a=i.find((function(t){return t.split("=")[0]===e}));return(null===a||void 0===a?void 0:a.split("=")[1])||""},T=n(113),A=n(165),U={getUserId:"get:/demo/auth/login",getRoomDetail:"post:/demo/live/room/detail",roomCreate:"post:/demo/live/room/create",getTicket:"post:/demo/live/apply/ticket",getRtcSign:"post:/demo/live/voice/sign"};var F,M=function(e,t){2===arguments.length&&"function"===typeof t&&(t=void 0);var n=e;if(A(U[n]))throw new Error("requestName is not defined");var r=(U[n]||n).split(":"),c=Object(o.a)(r,2),i=c[0],a=c[1],s="https://ka-vr-demo-developer.realsee.com".concat(a),u=fetch(s,{body:JSON.stringify(t),method:null===i||void 0===i?void 0:i.toUpperCase()}).then((function(e){return e.json()})).then((function(e){if(0!==e.code||!Object.keys(e.data).length)throw Error(e.status);return e.data}));return u},J=window.navigator.userAgent,P=/micromessenger/i.test(J)&&/miniprogram/i.test(J),W=/iphone|ipad/i.test(J),V=/android/i.test(J),z=W||V,K=n(69),D=n(89),H=n(114),q=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"closeWebView",value:function(){return window.history.back()}},{key:"openWebView",value:function(e,t){return window.location.href(e)}},{key:"actionShare",value:function(e){return function(){}}},{key:"getUserInfo",value:function(){var e=Object(L.a)(I.a.mark((function e(){var t,n;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M("getUserId").then((function(e){return e.user_id})).catch((function(e){return e.message}));case 2:return t=e.sent,n={userId:t},e.abrupt("return",[n]);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(L.a)(I.a.mark((function e(){var t;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M("getUserId").then((function(e){return e.user_id})).catch((function(e){return e.message}));case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(L.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"closeLoading",value:function(){var e=Object(L.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getBangsHeight",value:function(){var e=Object(L.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),$=n(70),G=function(){var e=Object(L.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M("getRtcSign",{voice_id:t.voiceId,room_id:t.roomId,user_id:t.userId}).then((function(e){return{sdkAppId:Number(e.voice_app_id),userId:e.user_identifier,userSig:e.sign}})).catch((function(e){throw Error(e.message)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();F=P?new D.VRWebViewRTC({jsBridge:new $.JSBridgeMiniprogram,getVoiceSign:G}):z?new D.VRWebViewRTC({jsBridge:new K.JSBridgeApp,getVoiceSign:G}):new H.BrowserRTC({jsBridge:new q,getVoiceSign:G});var Q=Object(T.createLiveReact)({__debug__:!0,rtc:F}),X=n(32),Y=n(46),Z=Object(Y.b)({name:"live",initialState:{state:{roomCode:""}},reducers:{setLiveStateToStore:function(e,t){e.state=Object.assign({},e.state,t.payload)}},extraReducers:function(e){}}),ee=Z.actions.setLiveStateToStore,te=function(e){return e.live.state},ne=Z.reducer,re=n(26),ce=Object(Y.b)({name:"space",initialState:{state:{type:"default",mode:"user",split:!1}},reducers:{setSpaceStateToStore:function(e,t){e.state=Object.assign({},e.state,t.payload)}},extraReducers:function(e){}}),ie=ce.actions.setSpaceStateToStore,ae=function(e){return e.space.state},oe=ce.reducer,se=Q.useConnect,ue=Q.useLiveAction;function le(){var e=ue().exit,t=se(),n=Object(X.useJSBridgeAction)(),r=n.login,c=n.getUserInfo,i=Object(re.b)(),a=function(){var e=Object(L.a)(I.a.mark((function e(){var t,n,i,a;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!z){e.next=3;break}return e.next=3,r();case 3:return e.next=5,c();case 5:if(t=e.sent,n=Object(o.a)(t,2),i=n[0],a=n[1],i){e.next=11;break}throw Error((null===a||void 0===a?void 0:a.message)||"\u8eab\u4efd\u4fe1\u606f\u83b7\u53d6\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");case 11:return e.abrupt("return",i.userId);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{liveConnect:function(){var e=Object(L.a)(I.a.mark((function e(){var n,r,c,s,u,l,d,f;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.location.search.includes("userRole=audience")?"audience":"anchor",e.next=3,a();case 3:if(r=e.sent,"anchor"!==n){e.next=15;break}return e.next=7,de(r,n);case 7:u=e.sent,l=Object(o.a)(u,2),d=l[0],f=l[1],c=d,s=f,e.next=19;break;case 15:return s=B("roomCode"),e.next=18,fe(s);case 18:c=e.sent;case 19:return e.abrupt("return",Promise.resolve().then((function(){i(ee({roomCode:s})),t({force:!0,url:c,getTicket:function(){var e=Object(L.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je({roomCode:s,userId:r,userRole:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})})).catch((function(e){return console.error(e.message)})));case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),liveExit:function(){return Promise.resolve().then((function(){return e()})).then((function(e){if(!e)throw Error("\u9000\u51fa\u5e26\u770b\u5931\u8d25");i(ie({mode:"user"})),i(ee({roomCode:""}))})).catch((function(e){console.error(e.message||"\u9000\u51fa\u5e26\u770b\u5931\u8d25")}))},liveConnectFromUrl:function(){var e=Object(L.a)(I.a.mark((function e(n){var r,c,o,s;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=B("userRole",n),c=B("roomCode",n),B("enterLive",n)&&c){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,a();case 7:return o=e.sent,e.next=10,fe(c);case 10:return s=e.sent,e.abrupt("return",Promise.resolve().then((function(){i(ee({roomCode:c})),t({force:!0,url:s,getTicket:function(){var e=Object(L.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je({roomCode:c,userId:o,userRole:r});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})})).catch((function(e){return console.error(e.message)})));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}var de=function(){var e=Object(L.a)(I.a.mark((function e(t,n){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M("roomCreate",{create_user_role:n,create_user_id:t}).then((function(e){return[e.room_link,e.room_id]})).catch((function(e){throw Error(e.message||"\u8bf7\u6c42\u5e26\u770b\u623f\u95f4\u4fe1\u606f\u5931\u8d25")})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),fe=function(){var e=Object(L.a)(I.a.mark((function e(t){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M("getRoomDetail",{room_id:t}).then((function(e){return e.room_link})).catch((function(e){throw Error(e.message||"\u67e5\u8be2\u5e26\u770b\u623f\u95f4\u4fe1\u606f\u5931\u8d25")})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=Object(L.a)(I.a.mark((function e(t){var n,r,c;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.roomCode,r=t.userId,c=t.userRole,e.abrupt("return",M("getTicket",{room_id:n,user_id:r,user_role:c}).then((function(e){return e.ticket})).catch((function(e){throw Error(e.message||"\u83b7\u53d6\u5e26\u770b\u95e8\u7968\u5931\u8d25")})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=Q.useKeyframe,be=Q.useSelfInfo;function he(){var e=Object(re.c)(ae),t=Object(re.b)(),n=c.a.useState(e),r=Object(o.a)(n,2),i=r[0],a=r[1],s=ve("SpaceState"),u=Object(o.a)(s,2)[1],l=be(),d=Object(o.a)(l,1)[0],f=c.a.useCallback((function(n){var r,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i="function"===typeof n?n():n;c&&"live"===e.mode&&(null===d||void 0===d||null===(r=d.permission)||void 0===r?void 0:r.sync_frame)&&u(i),t(ie(i))}),[t,u,e.mode,d]);return c.a.useEffect((function(){return a(e)}),[e]),[i,f]}n(195);function pe(){}var me=[],xe=-1,Oe=function(e){var t=b()("realsee-design-barrage",e.className),n=Math.floor(100*Math.random());return(n<20||80<n)&&(n=50),Object(x.jsx)("div",{className:t,style:{top:"".concat(n,"%")},children:Object(x.jsx)("div",{className:"react-barrage-contain",children:e.children})})},ge=function(e){var t=e.content,n=e.duration,r=void 0===n?1:n,c=e.onClose,i=void 0===c?pe:c,o=Object(m.a)(e,["content","duration","onClose"]),s=++xe,u=document.createElement("div");document.body.appendChild(u);var l=function(){l=pe,me[s]=null,a.a.unmountComponentAtNode(u),u.parentNode.removeChild(u),i()};if(me[s]=l,a.a.render(Object(x.jsx)(Oe,Object(f.a)(Object(f.a)({},o),{},{children:t})),u),0!==r){var d=window.innerWidth>768?2:r;setTimeout(l,1e4*d)}return l};Oe.message=function(){var e={content:arguments.length<=0?void 0:arguments[0],className:"react-barrage"};return void 0!==(arguments.length<=1?void 0:arguments[1])&&(e.duration=arguments.length<=1?void 0:arguments[1]),void 0!==(arguments.length<=2?void 0:arguments[2])&&(e.onClose=arguments.length<=2?void 0:arguments[2]),ge(e)},Oe.unmount=function(){me.forEach((function(e){e&&e()}))};var ke=Oe,we=Q.useSelfInfo,ye=Q.useLiveAction,Ce=Q.useLiveEventCallback;var Ne=Q.useRTCEventCallback;n(196),n(197);var _e=n(243),Se=n(40),Ee=n.n(Se),Re=n(248),Ie=n(249),Le=n(118),Be=n.n(Le);n(198);var Te,Ae,Ue=function(e){return Object(x.jsx)("div",{className:"btn-wrap",onClick:e.onClick,children:e.text})},Fe=window.location.search.includes("userRole=audience"),Me=function(){var e=le(),t=e.liveConnect,n=e.liveConnectFromUrl,c=Object(X.useJSBridgeAction)().closeWebView,i=r.createRef();return Object(x.jsxs)("div",{className:"default__user",children:[Object(x.jsx)("div",{className:"gui__top",children:Object(x.jsxs)("div",{className:"gui__top--bar",children:[Object(x.jsx)(_e.a,{onClick:function(){Promise.resolve().then((function(){return c()}))},className:"close btn",sx:{color:"white",pointerEvents:"auto"},children:Object(x.jsx)(Ee.a,{})}),Object(x.jsx)(_e.a,{className:"title btn",sx:{color:"white",fontSize:"16px"},children:"\u5982\u89c6\u5f00\u53d1\u8005\u4e2d\u5fc3\u793a\u4f8b--user\u6001"}),Object(x.jsx)(_e.a,{})]})}),Object(x.jsx)("div",{className:"gui__overlay",children:Object(x.jsx)("div",{className:"scene-overlay"})}),Object(x.jsx)("div",{className:"gui__bottom",children:Object(x.jsx)("div",{className:"controls",children:Object(x.jsx)("div",{className:"collapsible-list",children:Object(x.jsx)("div",{className:"collapsible-item",children:Fe?Object(x.jsxs)(Re.a,{children:[Object(x.jsx)(Ie.a,{type:"text",placeholder:"\u8bf7\u8f93\u5165\u5e26\u770b\u94fe\u63a5",inputRef:i}),Object(x.jsx)(_e.a,{sx:{color:"white"},onClick:function(){i.current.value?n(i.current.value):console.log("\u8f93\u5165\u6709\u8bef")},children:Object(x.jsx)(Be.a,{})})]}):Object(x.jsx)(Re.a,{className:"live--open",onClick:function(){return t()},sx:{display:"flex",justifyContent:"center"},children:Object(x.jsx)(Ue,{text:"\u8fdb\u5165\u5e26\u770b"})})})})})})]})},Je=(n(200),n(124)),Pe=n.n(Je),We=n(125),Ve=n.n(We),ze=n(126),Ke=n.n(ze),De=n(56),He=n.n(De),qe=n(74),$e=n.n(qe),Ge=n(127),Qe=n.n(Ge),Xe=n(245),Ye=n(35),Ze=n(59),et=n(250),tt=n(120),nt=n.n(tt),rt=n(119),ct=n.n(rt),it=Ze.a.div(Te||(Te=Object(Ye.a)(["\n  max-height: 200px;\n  display: flex;\n  flex-flow: column;\n  overflow-y: auto;\n  font-size: 12px;\n  pointer-events: auto;\n"]))),at=Ze.a.div(Ae||(Ae=Object(Ye.a)(["\n  display: flex;\n  flex-flow: row wrap;\n  align-items: center;\n  padding: 4px 0;\n  pointer-events: auto;\n  \n  > span {\n    display: flex;\n  }\n  \n  & > .role {\n    padding-left: 4px;\n    padding-right: 4px;\n    border-radius: 2px;\n    background-color: #5a6268;\n    color: white;\n  }\n\n  & > .self-tag {\n    color: darkorange;\n  }\n  \n  & > .nickname {\n    color: white;\n  }\n\n  & > .nickname.self-name {\n    color: greenyellow;\n  }\n\n  & > .btn {\n    color: darkorange;\n    cursor: pointer;\n  }\n\n  & > .edit-btn-groups {\n    display: inline-flex;\n  }\n\n  & > .status {\n    display: inline-block;\n    width: 10px;\n    height: 10px;\n    border-radius: 50%;\n    background-color: #5a6268;\n\n    &.online {\n      background-color: aquamarine;\n    }\n  }\n"]))),ot=function(e){var t=c.a.useState(!1),n=Object(o.a)(t,2),r=n[0],i=n[1],a=c.a.createRef();return Object(x.jsx)("div",{className:"user-info",children:Object(x.jsx)(it,{className:"user-list-panel",children:e.list&&e.list.map((function(t,n){return function(t,n){var c=t.id,o=t.micro_status,s=t.current_ws_online,u=t.permission,l=t.extension,d=t.user_role,f=c===e.selfInfo.id,j=!f&&s&&(null===u||void 0===u?void 0:u.change_other_status),v=e.volumeLists.find((function(e){return c===e.id})),h=!!(v&&v.audioVolume>=10),p="";return"anchor"===d?p="\u4e3b\u6301\u4eba":"audience"===d&&(p="\u89c2\u4f17"),Object(x.jsxs)(at,{className:"user-list-item",children:[Object(x.jsx)("span",{onClick:function(){return e.onForbiddenMicro(c)},children:Object(x.jsx)(et.a,{sx:{display:"flex",marginRight:"2px"},children:h?Object(x.jsx)(He.a,{fontSize:"small",color:"primary"}):o?Object(x.jsx)(ct.a,{fontSize:"small"}):Object(x.jsx)($e.a,{fontSize:"small"})})}),Object(x.jsx)("span",{className:"role",children:p}),f&&Object(x.jsx)("span",{className:"self-tag",children:"[\u81ea\u5df1]"}),f&&r?Object(x.jsx)(Ie.a,{className:"nickname",autoFocus:!0,defaultValue:"",type:"text",inputRef:a}):Object(x.jsx)("span",{className:b()("nickname",{"self-name":f}),children:(null===l||void 0===l?void 0:l.nickname)||c}),Object(x.jsx)("span",{className:b()("status",{online:s})}),f&&!r&&Object(x.jsx)("span",{onClick:function(){return i(!0)},className:"edit-nickname btn",children:"[\u4fee\u6539\u6635\u79f0]"}),f&&r&&Object(x.jsxs)("span",{className:"edit-btn-groups btn",children:[Object(x.jsx)("span",{onClick:function(){var t;i(!1),e.onNickNameChange(null===(t=a.current)||void 0===t?void 0:t.value)},className:"submit-nickname btn",children:"[\u63d0\u4ea4\u4fee\u6539]"}),Object(x.jsx)("span",{onClick:function(){return i(!1)},className:"exit-edit-nickname btn",children:"[\u9000\u51fa]"})]}),j&&Object(x.jsx)("span",{onClick:function(){return e.onKickUser(c)},children:Object(x.jsx)(et.a,{sx:{display:"flex",marginLeft:"2px"},children:Object(x.jsx)(nt.a,{fontSize:"small"})})})]},n)}(t,n)}))})})},st=n(244),ut=n(247),lt=n(251),dt=n(61),ft=n(123),jt=n.n(ft),vt=n(121),bt=n.n(vt),ht=n(122),pt=n.n(ht);var mt=function(e){var t=c.a.useState(null),n=Object(o.a)(t,2),r=n[0],i=n[1],a=c.a.useState(null),s=Object(o.a)(a,2);return s[0],s[1],Object(X.useJSBridgeAction)().actionShare,Object(x.jsx)(st.a,{open:e.open,children:Object(x.jsxs)("div",{className:"modal__wrap",children:[Object(x.jsxs)("div",{className:"modal__header",children:[Object(x.jsx)("div",{className:"share",children:"\u5206\u4eab"}),Object(x.jsx)(_e.a,{onClick:function(){e.onClose()},className:"close",sx:{color:"black"},children:Object(x.jsx)(Ee.a,{fontSize:"small"})})]}),Object(x.jsxs)("div",{className:"modal__body",children:[Object(x.jsx)("div",{className:"link-icon-list",children:Object(x.jsxs)(Re.a,{children:[Object(x.jsx)(_e.a,{onClick:function(e){i(e.currentTarget)},sx:{backgroundColor:"#f1f3f4",color:"black"},children:Object(x.jsx)(jt.a,{})}),Object(x.jsx)(ut.a,{open:Boolean(r),anchorEl:r,onClose:function(){i(null)},anchorOrigin:{vertical:"center",horizontal:"center"},children:Object(x.jsx)(lt.a,{sx:{p:2},children:Object(x.jsx)(bt.a,{value:e.shareConfig.shareLink,level:"H",includeMargin:!0})})})]})}),Object(x.jsxs)(Re.a,{className:"link-copy link-content",children:[Object(x.jsx)(dt.c,{disabled:!0,className:"link",value:e.shareConfig.shareLink,sx:{padding:"0 4px"}}),Object(x.jsx)(_e.a,{onClick:function(){pt()(e.shareConfig.shareLink),C.success("\u64cd\u4f5c\u6210\u529f")},className:"copy",sx:{fontSize:"16px",color:"black"},children:"\u590d\u5236"})]})]}),Object(x.jsx)("div",{className:"modal__footer"})]})})},xt=n(128),Ot=n.n(xt),gt=Q.useSelfInfo,kt=Q.useUserList,wt=Q.useLiveAction,yt=Q.useRTCEventCallback,Ct=function(){var e=le().liveExit,t=Object(re.c)(te),n=kt(),i=r.useState(!0),a=Object(o.a)(i,2),s=a[0],u=a[1],l=r.createRef(),d=function(e){var t=we(),n=Object(o.a)(t,1)[0],r=ye().broadcast;return Ce("broadcast",(function(e){switch(e.event_id){case"greet":ke.message(e.data.message);break;default:console.log("___broadcast__bug__")}})),c.a.useCallback((function(e){var t;r({event_id:e.event_id,data:{message:"".concat((null===n||void 0===n||null===(t=n.extension)||void 0===t?void 0:t.nickname)||(null===n||void 0===n?void 0:n.id),"\u8bf4\uff1a").concat(e.message)}},[],0)}),[e,n])}(),f=gt(),j=Object(o.a)(f,2),v=j[0],b=j[1],h=r.useState(!1),p=Object(o.a)(h,2),m=p[0],O=p[1],g=wt(),k=g.kick,w=g.toggleMicro,y=g.forbidMicro,N=function(e){var t=c.a.useState([]),n=Object(o.a)(t,2),r=n[0],i=n[1];return Ne("userVolumes",(function(e){i(e)})),r}(),_=r.useState(!1),S=Object(o.a)(_,2),E=S[0],R=S[1],I=r.useState(!1),L=Object(o.a)(I,2),B=L[0],T=L[1];r.useEffect((function(){if(v&&N.length){var e=N.find((function(e){return v.id===e.userId})),t=!!(e&&e.audioVolume>=10);R(t)}}),[N]),yt("joined",(function(){console.log("rtc -- joined")})),yt("error",(function(e){console.log("rtc -- error: ",e.message)}));var A=function(){e().then((function(){C.success("\u9000\u51fa\u5e26\u770b")}))};return Object(x.jsxs)("div",{className:"default__live",children:[Object(x.jsx)("div",{className:"gui__top",children:Object(x.jsxs)("div",{className:"gui__top--bar",children:[Object(x.jsx)(_e.a,{className:"close btn",sx:{color:"white"},onClick:A,children:Object(x.jsx)(Ee.a,{})}),Object(x.jsx)(_e.a,{className:"title btn",sx:{color:"white",fontSize:"16px"},children:"\u5982\u89c6\u5f00\u53d1\u8005\u4e2d\u5fc3\u793a\u4f8b--live\u6001"}),Object(x.jsx)(_e.a,{className:"share btn",sx:{color:"white"},onClick:function(){T(!0)},children:Object(x.jsx)(Pe.a,{})})]})}),Object(x.jsx)("div",{className:"gui__overlay",children:Object(x.jsxs)("div",{className:"scene-overlay",children:[Object(x.jsx)(mt,{open:B,onClose:function(){return T(!1)},shareConfig:{shareLink:"".concat(window.location.href.split("?")[0],"?userRole=audience&roomCode=").concat(t.roomCode,"&enterLive=true")}}),m&&Object(x.jsxs)("div",{className:"overlay-modal",children:[Object(x.jsx)(_e.a,{className:"icon-close",onClick:function(){return O(!1)},children:Object(x.jsx)(Ee.a,{})}),Object(x.jsx)(ot,{list:n,selfInfo:v,volumeLists:N,onForbiddenMicro:function(e){return y("CLOSE",e)},onKickUser:function(e){return k(e)},onNickNameChange:function(e){return b({nickname:e})}})]})]})}),Object(x.jsx)("div",{className:"gui__bottom",children:Object(x.jsx)("div",{className:"controls",children:Object(x.jsx)("div",{className:"collapsible-list",children:Object(x.jsxs)("div",{className:"collapsible-item",children:[Object(x.jsx)(_e.a,{sx:{color:"white"},className:"members",onClick:function(){return O(!0)},children:Object(x.jsx)(Xe.a,{color:"primary",badgeContent:n&&n.length,children:Object(x.jsx)(Ve.a,{})})}),s?Object(x.jsx)(_e.a,{sx:{color:"white"},className:"greet",onClick:function(){return u(!1)},children:Object(x.jsx)(Ke.a,{})}):Object(x.jsxs)("div",{className:"greet",children:[Object(x.jsx)(Ie.a,{type:"text",placeholder:"\u8bf4\u70b9\u4ec0\u4e48\u5427",inputRef:l}),Object(x.jsx)(_e.a,{sx:{color:"white"},onClick:function(){var e;d({event_id:"greet",message:null===(e=l.current)||void 0===e?void 0:e.value}),u(!0)},children:Object(x.jsx)(Qe.a,{})})]}),Object(x.jsx)(_e.a,{sx:{color:"white"},className:"micro",onClick:function(){return w(!v.micro_status)},children:(null===v||void 0===v?void 0:v.micro_status)?E?Object(x.jsx)(He.a,{color:"primary"}):Object(x.jsx)(He.a,{}):Object(x.jsx)($e.a,{})}),Object(x.jsx)(_e.a,{sx:{color:"white"},className:"close",onClick:A,children:Object(x.jsx)(Ot.a,{})})]})})})})]})},Nt=(n(207),function(){var e=he()[1];return Object(x.jsx)("div",{className:"panel decoration-space-panel__bottom-user",children:Object(x.jsx)("div",{className:"bottom",children:Object(x.jsx)("div",{className:"controls",children:Object(x.jsx)("div",{className:"collapsible-list",children:Object(x.jsxs)("div",{className:"collapsible-item",children:[Object(x.jsx)("span",{children:"decoration -- user"}),Object(x.jsx)("button",{onClick:function(){return e({type:"default"})},children:"switch to default space"})]})})})})})}),_t=(n(208),function(){var e=le().liveExit,t=he()[1];return Object(x.jsx)("div",{className:"panel decoration-space-panel__bottom--live",children:Object(x.jsx)("div",{className:"bottom",children:Object(x.jsx)("div",{className:"controls",children:Object(x.jsx)("div",{className:"collapsible-list",children:Object(x.jsxs)("div",{className:"collapsible-item",children:[Object(x.jsx)("span",{children:"decoration -- live"}),Object(x.jsx)("button",{onClick:function(){return t({type:"default"})},children:"switch to default space"}),Object(x.jsx)("button",{onClick:function(){return e()},children:"exit live"})]})})})})})}),St=function(){var e=he(),t=Object(o.a)(e,1)[0];switch(t.type){case"default":return function(){switch(t.mode){case"user":return Object(x.jsx)(Me,{});case"live":return Object(x.jsx)(Ct,{});case"tour":return Object(x.jsx)("div",{className:"panel default-space-panel__bottom--tour",children:"default -- tour"});default:return null}}();case"decoration":return function(){switch(t.mode){case"user":return Object(x.jsx)(Nt,{});case"live":return Object(x.jsx)(_t,{});case"tour":return Object(x.jsx)("div",{className:"panel decoration-space-panel__bottom--tour",children:"decoration -- tour"});default:return null}}();default:return null}},Et=n(42),Rt=S.withSpace(E),It=Q.useKeyframe,Lt=(Q.useReadyState,Q.useLiveEventCallback),Bt=Q.useWebSocketEventCallback;var Tt=function(){var e=Math.ceil(Object(X.useBangsHeightState)()/window.devicePixelRatio),t=c.a.useState(),n=Object(o.a)(t,2),r=n[0],i=n[1],a=It("FiveState"),s=Object(o.a)(a,2),u=s[0],l=s[1],d=he(),f=Object(o.a)(d,2),j=f[0],v=f[1],b=Object(X.useJSBridgeAction)().closeLoading,h=le().liveConnectFromUrl,p=le().liveExit,m={position:"absolute",left:0,top:"".concat(e,"px"),width:"100%",height:"100%",pointerEvents:"none"};c.a.useEffect((function(){z?Promise.resolve().then(b).then((function(){return h(window.location.href)})).catch((function(e){C.error(e.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")})):Promise.resolve().then((function(){return h(window.location.href)})).catch((function(e){C.error(e.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")}))}),[]);var O=It("SpaceState"),g=Object(o.a)(O,1)[0],k=Object(re.b)();return c.a.useEffect((function(){g&&"live"===j.mode&&k(ie(g))}),[g,k,j.mode]),Lt("readyKeyframeSync",(function(e){if(v({mode:"live"},!1),C.success("\u8fdb\u5165\u5e26\u770b"),"{}"!==JSON.stringify(e))for(var t in e)if(e.hasOwnProperty(t))switch(t){case"FiveState":i(e[t]);break;default:return}})),Lt("kickOut",(function(){p().then((function(){ke.message("\u4f60\u88ab\u8e22\u51fa\u5e26\u770b\u623f\u95f4")}))})),Lt("builtinEvent",(function(e){switch(e.action){case Et.BuiltinActionType.RoomClose:console.log("__\u623f\u95f4\u5173\u95ed__"),v({mode:"user"}),C.success("\u623f\u95f4\u5173\u95ed");break;case Et.BuiltinActionType.UserStatus:console.log(e.data),console.log("builtinEvent: user state change");break;case Et.BuiltinActionType.UserInfo:console.log("builtinEven: user info change");break;case Et.BuiltinActionType.UserMicroStatus:console.log("builtinEvent: user micro change");break;case Et.BuiltinActionType.UserPermission:console.log("builtinEvent: user permission change");break;default:console.log("builtinEvent: \u5176\u4ed6\u4e0d\u5728\u679a\u4e3e\u5185\u7684\u53d8\u66f4\uff01")}})),Bt("ws.error",(function(e){C.error(e.error.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01"),console.log(e.error.message||"\u54ea\u91cc\u51fa\u9519\u4e86\uff0c\u8bf7\u5237\u65b0\u540e\u91cd\u8bd5\uff01")})),c.a.useEffect((function(){"live"===j.mode&&u&&i(u)}),[u,j.mode]),Object(x.jsx)("section",{id:"app-container",children:Object(x.jsxs)("main",{children:[Object(x.jsx)("div",{id:"canvas-container",children:Object(x.jsx)(S,{spaceRootId:"default-canvas",url:"/mock/testWork.json",isMain:"default"===j.type,isSplit:j.split,state:r,onStateChange:function(e){"live"===j.mode&&l(e)},children:Object(x.jsx)(Re.a,{sx:m,children:Object(x.jsx)(Rt,{})})})}),Object(x.jsx)("div",{id:"gui",style:{paddingTop:"".concat(e,"px")},children:Object(x.jsx)(St,{})})]})})},At=Object(Y.a)({reducer:{space:oe,live:ne}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ut,Ft=n(85);Ut=P?new $.JSBridgeMiniprogram:z?new K.JSBridgeApp:new q,a.a.render(Object(x.jsx)(c.a.StrictMode,{children:Object(x.jsx)(Ft.JSBridgeContext.Provider,{value:Ut,children:Object(x.jsx)(re.a,{store:At,children:Object(x.jsx)(Q.LiveProvider,{children:Object(x.jsx)(Tt,{})})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[209,1,2]]]);
//# sourceMappingURL=main.f99e63a2.chunk.js.map